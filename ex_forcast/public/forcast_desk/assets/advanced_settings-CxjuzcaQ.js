var w=Object.defineProperty,A=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var x=(t,o,e)=>o in t?w(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e,g=(t,o)=>{for(var e in o||(o={}))S.call(o,e)&&x(t,e,o[e]);if(_)for(var e of _(o))J.call(o,e)&&x(t,e,o[e]);return t},D=(t,o)=>A(t,M(o));var E=(t,o,e)=>new Promise((c,i)=>{var r=a=>{try{n(e.next(a))}catch(p){i(p)}},s=a=>{try{n(e.throw(a))}catch(p){i(p)}},n=a=>a.done?c(a.value):Promise.resolve(a.value).then(r,s);n((e=e.apply(t,o)).next())});import{h as m,O as v,q as L}from"./index-BbtVxGeo.js";function Y(t,o){const e=parseInt(t),c=parseInt(o);if(!e||!c||e>c)return[];const i=[];for(let r=e;r<=c;r++)i.push(r);return i}const q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],C=["Jan-Mar","Apr-Jun","Jul-Sep","Oct-Dec"];function G(t){return t==="monthly"?q:C}const F={"Jan-Mar":["Jan","Feb","Mar"],"Apr-Jun":["Apr","May","Jun"],"Jul-Sep":["Jul","Aug","Sep"],"Oct-Dec":["Oct","Nov","Dec"]},O=m(!1),y=m({year:"",month:"",rows:[{department:"",department_location:"",expense:"",amount:0,amountDisplay:"",category:"",costType:""}]});function W(){y.value.rows.push({department:"",department_location:"",expense:"",amount:0,amountDisplay:"",category:"",costType:""})}function B(t){y.value.rows.length>1&&y.value.rows.splice(t,1)}function j(){y.value={year:"",month:"",rows:[{department:"",department_location:"",expense:"",amount:0,amountDisplay:"",category:"",costType:""}]}}function V(){j(),O.value=!1}const N=v({url:"frappe.client.insert",makeParams({doctype:t,doc:o}){return{doc:g({doctype:t},o)}}});function b(c){return E(this,arguments,function*({year:t,month:o,expenses:e}){const i=L.value;if(!i)throw new Error("No project selected. Please select a project first.");const r=e.map(n=>D(g({department:n.department,department_location:n.department_location,expense_name:n.expense,amount:n.amount},n.costType&&{cost_type:n.costType}),{is_default_expense:!1})),s={year:t,month:o,project:i.project_name,expense_items:r};try{return{success:!0,name:(yield N.submit({doctype:"Expense Assumptions",doc:s})).name}}catch(n){return console.error("Error creating expense document:",n),console.error("Error details:",{message:n.message,stack:n.stack,response:n.response}),{success:!1,error:n}}})}const f=m(new Set);function z(t){f.value.has(t)?f.value.delete(t):f.value.add(t)}function H(t){return f.value.has(t)}function K(t,o){const e=t.find(c=>c.expense_name===o);return e?{code:e.code||"",costType:e.cost_type||"",hospitalityCategory:e.hospitality_category||""}:{code:"",costType:"",hospitalityCategory:""}}function k(t,o,e,c,i="monthly"){var r,s,n;if(i==="quarterly"&&F[c]){const p=(((r=t==null?void 0:t[e])==null?void 0:r[c])||[]).find(u=>u.expense===o);if(p)return parseFloat(p.amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});let l=0;for(const u of F[c]){const h=(((s=t==null?void 0:t[e])==null?void 0:s[u])||[]).find(T=>T.expense===o);h&&(l+=parseFloat(h.amount)||0)}return l.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}else{const p=(((n=t==null?void 0:t[e])==null?void 0:n[c])||[]).find(l=>l.expense===o);return p?parseFloat(p.amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"}}function Q(t,o,e,c,i){const r=i(e);let s=0;for(const n of r){const a=k(t,o,e,n,c),p=parseFloat(a.toString().replace(/,/g,""));isNaN(p)||(s+=p)}return s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function U(t,o,e=[]){const c=new Map;e.forEach(r=>{const s=r.department||"Other",n=r.department_location||"Default";c.has(s)||c.set(s,new Map);const a=c.get(s);a.has(n)||a.set(n,new Set),a.get(n).add({expense:r.expense,isDefault:!0,costType:r.cost_type,code:r.code||"",rootType:r.root_type||""})}),o&&o.length>0&&o.forEach(r=>{const s=t[r]||{};for(const n in s)s[n].forEach(a=>{const p=a.department||"Other",l=a.department_location||"Other";c.has(p)||c.set(p,new Map);const u=c.get(p);u.has(l)||u.set(l,new Set),u.get(l).add({expense:a.expense,isDefault:!1,costType:a.cost_type||"",code:a.code||"",rootType:a["root type"]||""})})});const i=[];for(const[r,s]of c){const n={department:r,locations:[]};for(const[a,p]of s){const l=Array.from(p).sort((u,d)=>u.isDefault&&!d.isDefault?-1:!u.isDefault&&d.isDefault?1:u.expense.localeCompare(d.expense));n.locations.push({location:a,expenses:l.map(u=>u.expense),expenseDetails:l})}n.locations.sort((a,p)=>a.location==="Default"?-1:p.location==="Default"?1:a.location.localeCompare(p.location)),i.push(n)}return i.sort((r,s)=>r.department.localeCompare(s.department)),i}function P(t,o,e){for(const c of e){const i=t[c]||{};for(const r in i){const s=i[r].find(n=>n.expense===o);if(s)return{code:s.code||"",costType:s.cost_type||"",rootType:s["root type"]||"",department:s.department||"",departmentLocation:s.department_location||""}}}return{code:"",costType:"",rootType:"",department:"",departmentLocation:""}}function X(t,o,e,c=[]){const i=c.find(r=>r.expense===o);return i?{code:i.code||"",costType:i.cost_type||"",rootType:i.root_type||"",department:i.department||"",departmentLocation:i.department_location||"Default",isDefault:!0}:P(t,o,e)}m(!1);m({});export{G as a,Y as b,b as c,U as d,Q as e,V as f,k as g,y as h,H as i,W as j,K as k,X as l,j as m,q as n,F as q,B as r,O as s,z as t};
