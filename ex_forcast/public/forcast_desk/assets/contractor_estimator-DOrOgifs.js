var Jt=Object.defineProperty;var gt=Object.getOwnPropertySymbols;var Ht=Object.prototype.hasOwnProperty,Xt=Object.prototype.propertyIsEnumerable;var ft=(x,e,t)=>e in x?Jt(x,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):x[e]=t,lt=(x,e)=>{for(var t in e||(e={}))Ht.call(e,t)&&ft(x,t,e[t]);if(gt)for(var t of gt(e))Xt.call(e,t)&&ft(x,t,e[t]);return x};var w=(x,e,t)=>new Promise((r,a)=>{var c=v=>{try{f(t.next(v))}catch(l){a(l)}},p=v=>{try{f(t.throw(v))}catch(l){a(l)}},f=v=>v.done?r(v.value):Promise.resolve(v.value).then(c,p);f((t=t.apply(x,e)).next())});import{E as G,_ as xt,h as E,l as B,p as zt,R as Qt,m as bt,c as $,i as R,o as T,b as s,e as _,u as m,t as J,d as P,B as M,N as wt,F as X,x as K,v as S,C as W,S as Kt,j as st,n as Wt,Z as Zt,G as ht,q as et,w as Yt,O as te,T as ee}from"./index-DFp4WPHj.js";import{X as mt,T as ut,c as k,_ as se,l as oe,b as ae,R as re,h as ne,e as yt,d as le}from"./SettingsModal-D-D5AQet.js";import{P as q}from"./plus-Q6-mjf1P.js";import{D as ie}from"./zap-BeFUdqHw.js";import{C as ce,a as ue}from"./circle-alert-CbaxY-0D.js";import{L as dt}from"./loader-circle-jaT7itjR.js";import{F as _t}from"./folder-open-DRdD7xRy.js";import{C as de}from"./chevron-left-Ct-jXL2q.js";import{S as me}from"./save-CWxizgNn.js";import{R as pe}from"./rotate-ccw-CVymyNdy.js";import{C as ge}from"./chart-column-CDQ4xrd1.js";import{T as vt}from"./trash-yDZuAIRr.js";import"./createLucideIcon-D8X7RiyU.js";class Z{constructor(e={}){this.id=e.id||this.generateId(),this.lineId=e.lineId||null,this.name=e.name||"",this.party=e.party||"",this.status=e.status||"Not Started",this.percentComplete=e.percentComplete||0,this.quantity=typeof e.quantity=="number"?e.quantity:1,this.unitType=e.unitType||"",this.rate=typeof e.rate=="number"?e.rate:0,this.projected=e.projected||0,this.actual=e.actual||0,this.currentPaid=e.currentPaid||0,this.comments=e.comments||"",this.variance=this.calculateVariance(),this.amountDue=this.calculateAmountDue()}generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}calculateVariance(){return(this.actual||0)-(this.projected||0)}calculateAmountDue(){return(this.actual||0)-(this.currentPaid||0)}updateCalculatedFields(){this.variance=this.calculateVariance(),this.amountDue=this.calculateAmountDue()}validate(){const e=[];return this.name.trim()||e.push("Item name is required"),(this.percentComplete<0||this.percentComplete>100)&&e.push("Percent complete must be between 0 and 100"),this.currentPaid>this.actual&&e.push("Current paid cannot exceed actual amount"),e}toJSON(){return{id:this.id,lineId:this.lineId,name:this.name,party:this.party,status:this.status,percentComplete:this.percentComplete,quantity:this.quantity,unitType:this.unitType,rate:this.rate,projected:this.projected,actual:this.actual,currentPaid:this.currentPaid,comments:this.comments,variance:this.variance,amountDue:this.amountDue}}static createEmpty(e=""){return new Z({name:e})}}class Y{constructor(e={}){this.id=e.id||this.generateId(),this.name=e.name||"",this.order=e.order||0,this.items=(e.items||[]).map(t=>t instanceof Z?t:new Z(t)),this.subtotals=this.calculateSubtotals()}generateId(){return`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}calculateSubtotals(){const e={projected:0,actual:0,variance:0,currentPaid:0,amountDue:0};return this.items.forEach(t=>{t.updateCalculatedFields(),e.projected+=t.projected||0,e.actual+=t.actual||0,e.variance+=t.variance||0,e.currentPaid+=t.currentPaid||0,e.amountDue+=t.amountDue||0}),e}addItem(e={}){const t=new Z(e);return this.items.push(t),this.updateSubtotals(),t}removeItem(e){const t=this.items.findIndex(r=>r.id===e);return t>-1?(this.items.splice(t,1),this.updateSubtotals(),!0):!1}updateSubtotals(){this.subtotals=this.calculateSubtotals()}validate(){const e=[];return this.name.trim()||e.push("Category name is required"),this.items.forEach((t,r)=>{const a=t.validate();a.length>0&&e.push(`Item ${r+1}: ${a.join(", ")}`)}),e}toJSON(){const e=this.items.filter(t=>t.projected>0||t.actual>0||t.currentPaid>0||t.comments&&t.comments.trim()!==""||t.party&&t.party.trim()!==""||t.status!=="Not Started"||t.percentComplete>0);return{id:this.id,name:this.name,order:this.order,items:e.map(t=>t.toJSON()),subtotals:this.subtotals}}static createEmpty(e="",t=0){return new Y({name:e,order:t})}}class V{constructor(e={}){this.id=e.id||this.generateId(),this.projectTitle=e.projectTitle||"",this.location=e.location||"",this.project=e.project||"",this.categories=(e.categories||[]).map(t=>t instanceof Y?t:new Y(t)),this.totals=this.calculateTotals()}generateId(){return`estimator_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}calculateTotals(){const e={projected:0,actual:0,variance:0,currentPaid:0,amountDue:0};return this.categories.forEach(t=>{t.updateSubtotals(),e.projected+=t.subtotals.projected,e.actual+=t.subtotals.actual,e.variance+=t.subtotals.variance,e.currentPaid+=t.subtotals.currentPaid,e.amountDue+=t.subtotals.amountDue}),e}addCategory(e={}){const t=new Y(e);return this.categories.push(t),this.updateTotals(),t}removeCategory(e){const t=this.categories.findIndex(r=>r.id===e);return t>-1?(this.categories.splice(t,1),this.updateTotals(),!0):!1}updateTotals(){this.totals=this.calculateTotals()}validate(){const e=[];return this.projectTitle.trim()||e.push("Project title is required"),this.categories.forEach((t,r)=>{const a=t.validate();a.length>0&&e.push(`Category ${r+1} (${t.name}): ${a.join(", ")}`)}),e}toJSON(){return{id:this.id,projectTitle:this.projectTitle,location:this.location,project:this.project,categories:this.categories.map(e=>e.toJSON()),totals:this.totals}}static createEmpty(e="",t=""){return new V({projectTitle:e,location:t})}}const fe=["Not Started","In Progress","Complete","On Hold"];class he{constructor(){this.estimators=[],this.currentProject=null,this.autoLoadGLBalances=!0}testApiConnection(){return w(this,null,function*(){try{const e=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.test_connection",{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()}});if(!e.ok)throw new Error(`API connection failed: ${e.status}`);return!0}catch(e){return console.warn("Contractor Estimator API not available, using local storage:",e.message),!1}})}fetchData(e=null){return w(this,null,function*(){try{const t=yield this.createMergedEstimator("","",e);return this.estimators=[t],this.estimators}catch(t){throw console.error("Error fetching contractor estimator data:",t),t}})}getItemsByOrderOfItemGroup(){return w(this,null,function*(){try{const e=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_items_by_order_of_category",{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=yield e.json(),r=t.message||t;if(!r.success)throw new Error(r.error||"Failed to fetch items by category");return r.data}catch(e){throw console.error("Error getting items by order of category:",e),e}})}createEstimatorFromItemGroups(e="",t="",r=""){return w(this,null,function*(){try{const a=yield this.getItemsByOrderOfItemGroup(),c=new V({projectTitle:e,location:t,project:r});return Object.keys(a).forEach((p,f)=>{const v=c.addCategory({name:p,order:f+1});(a[p]||[]).forEach(u=>{if(typeof u=="string")v.addItem({name:u});else if(u&&typeof u=="object"){const j=u.item_name||u.name||"",g=u.stock_uom||"",L=typeof u.valuation_rate=="number"?u.valuation_rate:0,N=1;v.addItem({name:j,unitType:g,rate:L,quantity:N,projected:N*L})}})}),c.updateTotals(),c}catch(a){throw console.error("Error creating estimator from item groups:",a),a}})}createMergedEstimator(e="",t="",r=""){return w(this,null,function*(){try{const a=yield this.getItemsByOrderOfItemGroup();let c=null;try{const f=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_contractor_estimator_data",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({project_name:r})});if(f.ok){const v=yield f.json(),l=v.message||v;l.success&&l.data&&l.data.length>0&&(c=new V(l.data[0]))}}catch(f){console.log("No saved estimator found, using default data only")}const p=new V({projectTitle:e,location:t,project:r,id:c==null?void 0:c.id});return Object.keys(a).forEach((f,v)=>{const l=p.addCategory({name:f,order:v+1});(a[f]||[]).forEach(j=>{if(typeof j=="string")l.addItem({name:j});else if(j&&typeof j=="object"){const g=j.item_name||j.name||"",L=j.stock_uom||"",N=typeof j.valuation_rate=="number"?j.valuation_rate:0,U=1;l.addItem({name:g,unitType:L,rate:N,quantity:U,projected:U*N})}})}),p.updateTotals(),c&&(console.log("Merging saved data with default Item Groups data"),p.totals=lt({},c.totals),c.categories.forEach(f=>{const v=p.categories.find(l=>l.name===f.name);if(v)v.subtotals=lt({},f.subtotals),f.items.forEach(l=>{const u=v.items.find(j=>j.name===l.name);u?(u.projected=l.projected,u.actual=l.actual,u.currentPaid=l.currentPaid,u.comments=l.comments,u.party=l.party,u.status=l.status,u.percentComplete=l.percentComplete,u.lineId=l.lineId,typeof l.quantity=="number"&&(u.quantity=l.quantity),typeof l.rate=="number"&&(u.rate=l.rate),l.unitType&&(u.unitType=l.unitType),u.variance=u.actual-u.projected,u.amountDue=u.actual-u.currentPaid):v.addItem({name:l.name,quantity:l.quantity,unitType:l.unitType,rate:l.rate,projected:l.projected,actual:l.actual,currentPaid:l.currentPaid,comments:l.comments,party:l.party,status:l.status,percentComplete:l.percentComplete,lineId:l.lineId})}),v.updateSubtotals();else{const l=p.addCategory({name:f.name,order:f.order});f.items.forEach(u=>{l.addItem({name:u.name,projected:u.projected,actual:u.actual,currentPaid:u.currentPaid,comments:u.comments,party:u.party,status:u.status,percentComplete:u.percentComplete,lineId:u.lineId})})}}),p.updateTotals()),p}catch(a){throw console.error("Error creating merged estimator:",a),a}})}getItemGroups(){return w(this,null,function*(){try{const e=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_item_groups",{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=yield e.json(),r=t.message||t;if(!r.success)throw new Error(r.error||"Failed to fetch item groups");return console.log("Service - Item Groups fetched:",r.data),r.data}catch(e){throw console.error("Error fetching item groups:",e),e}})}createItemGroup(e){return w(this,null,function*(){try{const t=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.create_item_group",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({item_group_name:e})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=yield t.json(),a=r.message||r;if(!a.success)throw new Error(a.error||"Failed to create item group");return console.log("Service - Item Group created:",a),a}catch(t){throw console.error("Error creating item group:",t),t}})}createItem(e,t){return w(this,null,function*(){try{const r=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.create_item",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({item_name:e,item_group:t})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const a=yield r.json(),c=a.message||a;if(!c.success)throw new Error(c.error||"Failed to create item");return console.log("Service - Item created:",c),c}catch(r){throw console.error("Error creating item:",r),r}})}saveData(e,t=null){return w(this,null,function*(){try{console.log("Service - Saving estimators:",e.length);const r=e.map(f=>f.toJSON());console.log("Service - Data being sent to API:",r),r.length>0&&r[0].categories&&(console.log("Service - First estimator categories:",r[0].categories.length),r[0].categories.forEach((f,v)=>{console.log(`Service - Category ${v}: ${f.name}, Items: ${f.items.length}`),f.items.length>0&&console.log(`Service - Category ${f.name} items:`,f.items)})),console.log("Service - Complete JSON being sent to API:",JSON.stringify(r,null,2));const a=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.save_contractor_estimator_data",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({project_name:t,data:r})});if(!a.ok){const f=yield a.text();throw new Error(`HTTP error! status: ${a.status} - ${f}`)}const c=yield a.json(),p=c.message||c;if(!p.success)throw new Error(p.error||"Failed to save contractor estimator data");return this.estimators=e,p}catch(r){throw console.error("Error saving contractor estimator data:",r),r}})}createEstimator(e){return w(this,null,function*(){try{const t=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.create_contractor_estimator",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify(e)});if(!t.ok){const c=yield t.text();throw new Error(`HTTP error! status: ${t.status} - ${c}`)}const r=yield t.json(),a=r.message||r;if(!a.success)throw new Error(a.error||"Failed to create contractor estimator");return a}catch(t){throw console.error("Error creating contractor estimator:",t),t}})}deleteEstimator(e){return w(this,null,function*(){try{const t=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.delete_contractor_estimator",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({estimator_id:e})});if(!t.ok){const c=yield t.text();throw new Error(`HTTP error! status: ${t.status} - ${c}`)}const r=yield t.json(),a=r.message||r;if(!a.success)throw new Error(a.error||"Failed to delete contractor estimator");return a}catch(t){throw console.error("Error deleting contractor estimator:",t),t}})}getAllEstimators(){return[...this.estimators]}getEstimatorById(e){return this.estimators.find(t=>t.id===e)}addEstimator(e){return e instanceof V||(e=new V(e)),this.estimators.push(e),e}removeEstimator(e){const t=this.estimators.findIndex(r=>r.id===e);return t>-1?(this.estimators.splice(t,1),!0):!1}exportData(e="csv"){if(this.estimators.length===0)return"";const t=this.estimators[0];let a=["Line ID","Category & Items","Projected Subtotal","Actual Subtotal","Variance","Party Responsible","Status","% of Task Complete","Current Paid","Amount Due","Comments"].join(",")+`
`;return a+=`"","TOTALS",${t.totals.projected},${t.totals.actual},${t.totals.variance},"","","",${t.totals.currentPaid},${t.totals.amountDue},""
`,t.categories.forEach(c=>{a+=`"","${c.name}",${c.subtotals.projected},${c.subtotals.actual},${c.subtotals.variance},"","","",${c.subtotals.currentPaid},${c.subtotals.amountDue},""
`,c.items.forEach(p=>{a+=`"${p.lineId||""}","${p.name}",${p.projected||""},${p.actual||""},${p.variance},"${p.party||""}","${p.status}","${p.percentComplete}","${p.currentPaid||""}","${p.amountDue}","${p.comments||""}"
`})}),a}importData(e){var t;try{const r=e.split(`
`).filter(v=>v.trim());if(r.length<2)throw new Error("Invalid CSV format");const a=r[0].split(",").map(v=>v.replace(/"/g,"")),c=V.createWithDefaultCategories();let p=null,f=1;for(let v=1;v<r.length;v++){const l=r[v].split(",").map(j=>j.replace(/"/g,""));if(l.length<a.length)continue;const u=(t=l[1])==null?void 0:t.trim();if(!l[0]&&u&&!isNaN(l[2])){p=c.categories.find(j=>j.name===u);continue}if(p&&l[0]){const j=p.addItem({lineId:l[0]||f++,name:l[1]||"",projected:parseFloat(l[2])||0,actual:parseFloat(l[3])||0,party:l[5]||"",status:l[6]||"Not Started",percentComplete:parseFloat(l[7])||0,currentPaid:parseFloat(l[8])||0,comments:l[10]||""})}}return c.updateTotals(),this.estimators=[c],c}catch(r){throw console.error("Error importing CSV data:",r),r}}clearData(){this.estimators=[]}getDataSummary(){if(this.estimators.length===0)return{totalEstimators:0,totalCategories:0,totalItems:0,totalProjected:0,totalActual:0,totalVariance:0};const e=this.estimators[0],t=e.categories.length,r=e.categories.reduce((a,c)=>a+c.items.length,0);return{totalEstimators:this.estimators.length,totalCategories:t,totalItems:r,totalProjected:e.totals.projected,totalActual:e.totals.actual,totalVariance:e.totals.variance}}deleteItem(e,t){return w(this,null,function*(){var r;try{const c=yield(yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.delete_contractor_estimator_item",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({estimator_id:e,item_line_id:t})})).json();return c.message&&c.message.success?{success:!0,message:c.message.message}:{success:!1,error:((r=c.message)==null?void 0:r.error)||"Failed to delete item"}}catch(a){return console.error("Error deleting item:",a),{success:!1,error:a.message||"Network error occurred"}}})}simpleHash(e){let t=0;for(let r=0;r<e.length;r++){const a=e.charCodeAt(r);t=(t<<5)-t+a,t=t&t}return Math.abs(t)}getItemGLBalance(r){return w(this,arguments,function*(e,t={}){var a;try{const c=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_item_gl_balance",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({item_name:e,from_date:t.fromDate,to_date:t.toDate,company:t.company})});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const p=yield c.json();if(p.message&&p.message.success)return p.message.data;throw new Error(((a=p.message)==null?void 0:a.error)||"Failed to fetch GL balance")}catch(c){throw console.error("Error fetching GL balance:",c),c}})}populateActualSubtotalFromGL(r){return w(this,arguments,function*(e,t={}){try{try{const a=yield this.getItemGLBalance(e.name,t);if(a&&a.primary_account){const c=a.primary_account.total_balance||0;return c>0?(e.actual=Math.abs(c),e._unsaved=!0,{success:!0,balance:c,account:a.primary_account.account_name,company:a.company,method:a.method_used||"item_specific"}):{success:!1,message:"No GL transactions found for this item"}}}catch(a){console.warn("Item-specific GL balance failed:",a.message)}try{const a=yield this.getGeneralAccountBalances(t);if(a&&a.accounts&&a.accounts.length>0){const c=e.name.toLowerCase(),p=a.accounts.find(f=>f.account_name.toLowerCase().includes(c)||c.includes(f.account_name.toLowerCase()));if(p&&p.total_balance>0)return e.actual=Math.abs(p.total_balance),e._unsaved=!0,{success:!0,balance:p.total_balance,account:p.account_name,company:a.company,method:"exact_account_match"}}}catch(a){console.warn("General account lookup failed:",a.message)}return{success:!1,message:"No GL transactions found for this item"}}catch(a){return console.error("Error populating actual subtotal:",a),{success:!1,error:a.message}}})}getGeneralAccountBalances(){return w(this,arguments,function*(e={}){var t;try{const r=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_general_account_balances",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({from_date:e.fromDate,to_date:e.toDate,company:e.company})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const a=yield r.json();if(a.message&&a.message.success)return a.message.data;throw new Error(((t=a.message)==null?void 0:t.error)||"Failed to fetch general account balances")}catch(r){throw console.error("Error fetching general account balances:",r),r}})}getDefaultCompany(){return w(this,null,function*(){var e;try{const t=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_default_company",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=yield t.json();if(r.message&&r.message.success)return r.message.data;throw new Error(((e=r.message)==null?void 0:e.error)||"Failed to fetch default company")}catch(t){throw console.error("Error fetching default company:",t),t}})}setAutoLoadGLBalances(e){this.autoLoadGLBalances=e,console.log(`Auto-loading GL balances ${e?"enabled":"disabled"}`)}debugGLBalance(e){return w(this,null,function*(){console.log(`=== Debugging GL Balance for: ${e} ===`);try{console.log("1. Testing item-specific GL balance...");const t=yield this.getItemGLBalance(e);console.log("Item-specific result:",t),console.log("2. Testing general account balances...");const r=yield this.getGeneralAccountBalances();console.log("General result:",r),console.log("3. Testing debug accounts API...");const a=yield this.debugAccounts(e);return console.log("Debug accounts result:",a),{itemSpecific:t,general:r,debug:a}}catch(t){return console.error("Debug error:",t),{error:t.message}}})}debugAccounts(e){return w(this,null,function*(){try{const t=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.debug_accounts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({search_term:e})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return yield t.json()}catch(t){throw console.error("Error debugging accounts:",t),t}})}autoLoadGLBalancesForEstimator(r){return w(this,arguments,function*(e,t={}){try{if(!this.autoLoadGLBalances)return{success:!0,total:0,successful:0,failed:0,results:[],message:"Auto-loading GL balances is disabled"};const a=[];for(const v of e.categories)for(const l of v.items)l.name&&l.name.trim()&&a.push(this.populateActualSubtotalFromGL(l,t).catch(u=>(console.warn(`Failed to load GL balance for item "${l.name}":`,u.message),{success:!1,item:l.name,error:u.message})));const c=yield Promise.all(a),p=c.filter(v=>v.success).length,f=c.filter(v=>!v.success).length;return{success:!0,total:a.length,successful:p,failed:f,results:c}}catch(a){return console.error("Error auto-loading GL balances:",a),{success:!1,error:a.message}}})}}const A=new he,ye={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},ve={class:"relative z-10 w-full max-w-md bg-white rounded-xl shadow-2xl border border-violet-200"},xe={class:"px-5 py-4 border-b border-gray-200 flex items-center justify-between"},be={class:"flex items-center gap-2"},we={class:"w-8 h-8 bg-gradient-to-br from-violet-500 to-violet-600 rounded-lg flex items-center justify-center"},_e={class:"p-5 space-y-4"},Ce={class:"flex gap-2"},je={key:0},Te=["value"],Se={key:1},$e={key:2,class:"mt-1 text-sm text-red-600 flex items-center gap-1"},ke={class:"px-5 py-4 border-t border-gray-200 flex items-center justify-end gap-2 bg-gray-50 rounded-b-xl"},Pe=["disabled"],Ee={__name:"AddCategoryModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","create"],setup(x,{expose:e,emit:t}){const r=x,a=t,c=E("select"),p=E(""),f=E(""),v=E([]),l=E(""),u=E(!1),j=E(null),g=B(()=>c.value==="select"?f.value.trim()!=="":p.value.trim()!==""&&p.value.trim().length>=2),L=()=>{l.value=""},N=I=>{c.value=I,L(),I==="select"?p.value="":f.value=""},U=()=>w(this,null,function*(){try{u.value=!0;const I=yield A.getItemGroups();v.value=I}catch(I){console.error("Failed to load item groups:",I),I.value="Failed to load existing Item Groups"}finally{u.value=!1}}),H=()=>{u.value||(p.value="",f.value="",l.value="",u.value=!1,c.value="select",a("close"))},tt=()=>w(this,null,function*(){if(u.value)return;let I="";if(c.value==="select"){if(!f.value.trim()){l.value="Please select an Item Group";return}I=f.value.trim()}else{const b=p.value.trim();if(!b){l.value="Category name is required";return}if(b.length<2){l.value="Category name must be at least 2 characters";return}I=b}u.value=!0,l.value="";try{a("create",I,c.value)}catch(b){l.value=b.message||"Failed to process category"}finally{u.value=!1}});return zt(()=>r.isVisible,I=>{I&&(U(),Qt(()=>{var b;c.value==="create"&&((b=j.value)==null||b.focus())}))}),bt(()=>{r.isVisible&&U()}),e({closeModal:H,setError:I=>{l.value=I},setLoading:I=>{u.value=I}}),(I,b)=>x.isVisible?(T(),$("div",ye,[s("div",{class:"absolute inset-0 bg-black/30",onClick:H}),s("div",ve,[s("div",xe,[s("div",be,[s("div",we,[_(m(q),{class:"w-4 h-4 text-white"})]),b[4]||(b[4]=s("h3",{class:"text-base font-semibold text-gray-800"},"Add New Category",-1))]),s("button",{onClick:H,class:"text-gray-400 hover:text-gray-600 transition-colors"},[_(m(mt),{class:"w-5 h-5"})])]),s("div",_e,[s("div",null,[b[7]||(b[7]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Add Category From ",-1)),s("div",Ce,[s("button",{onClick:b[0]||(b[0]=O=>N("select")),class:J(["flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-all",c.value==="select"?"bg-violet-100 text-violet-700 border-2 border-violet-300":"bg-gray-100 text-gray-600 border-2 border-transparent hover:bg-gray-200"])},[_(m(ie),{class:"w-4 h-4 inline mr-2"}),b[5]||(b[5]=P(" Select Existing ",-1))],2),s("button",{onClick:b[1]||(b[1]=O=>N("create")),class:J(["flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-all",c.value==="create"?"bg-violet-100 text-violet-700 border-2 border-violet-300":"bg-gray-100 text-gray-600 border-2 border-transparent hover:bg-gray-200"])},[_(m(q),{class:"w-4 h-4 inline mr-2"}),b[6]||(b[6]=P(" Create New ",-1))],2)])]),c.value==="select"?(T(),$("div",je,[b[9]||(b[9]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Select Item Group ",-1)),M(s("select",{"onUpdate:modelValue":b[2]||(b[2]=O=>f.value=O),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent transition-all",onChange:L},[b[8]||(b[8]=s("option",{value:""},"Choose an existing Item Group...",-1)),(T(!0),$(X,null,K(v.value,O=>(T(),$("option",{key:O.name,value:O.item_group_name},S(O.item_group_name),9,Te))),128))],544),[[wt,f.value]]),b[10]||(b[10]=s("p",{class:"mt-1 text-xs text-gray-500"}," Select from existing Item Groups in the system ",-1))])):R("",!0),c.value==="create"?(T(),$("div",Se,[b[11]||(b[11]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Category Name ",-1)),M(s("input",{"onUpdate:modelValue":b[3]||(b[3]=O=>p.value=O),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent transition-all",placeholder:"Enter category name (e.g., Planning, Site Prep)",onKeyup:Kt(tt,["enter"]),onInput:L,ref_key:"categoryNameInput",ref:j},null,544),[[W,p.value]]),b[12]||(b[12]=s("p",{class:"mt-1 text-xs text-gray-500"}," This will create a new Item Group in the system ",-1))])):R("",!0),l.value?(T(),$("p",$e,[_(m(ce),{class:"w-4 h-4"}),P(" "+S(l.value),1)])):R("",!0)]),s("div",ke,[s("button",{onClick:H,class:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors"}," Cancel "),s("button",{onClick:tt,disabled:u.value||!g.value,class:"px-4 py-2 rounded-md bg-gradient-to-r from-violet-600 to-violet-700 text-white hover:from-violet-700 hover:to-violet-800 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all flex items-center gap-2"},[u.value?(T(),st(m(dt),{key:0,class:"w-4 h-4 animate-spin"})):(T(),st(m(q),{key:1,class:"w-4 h-4"})),P(" "+S(u.value?"Processing...":c.value==="select"?"Add Category":"Create Category"),1)],8,Pe)])])])):R("",!0)}},Ie=xt(Ee,[["__scopeId","data-v-7106fec4"]]),Fe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},De={class:"relative z-10 w-full max-w-md bg-white rounded-xl shadow-2xl border border-violet-200"},Ae={class:"px-5 py-4 border-b border-gray-200 flex items-center justify-between"},Le={class:"flex items-center gap-2"},Ne={__name:"SelectProjectModal",props:{isVisible:{type:Boolean,default:!1}},setup(x){return(e,t)=>x.isVisible?(T(),$("div",Fe,[s("div",{class:"absolute inset-0 bg-black/30",onClick:t[0]||(t[0]=r=>e.$emit("close"))}),s("div",De,[s("div",Ae,[s("div",Le,[_(m(ut),{class:"w-5 h-5 text-orange-600"}),t[2]||(t[2]=s("h3",{class:"text-base font-semibold text-gray-800"},"Project Required",-1))]),s("button",{onClick:t[1]||(t[1]=r=>e.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[_(m(mt),{class:"w-5 h-5"})])]),t[3]||(t[3]=s("div",{class:"p-5 space-y-3"},[s("p",{class:"text-sm text-gray-700"}," Please select a project to continue. Use the Project dropdown on the left. ")],-1))])])):R("",!0)}},Ge={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Oe={class:"relative z-10 w-full max-w-md bg-white rounded-xl shadow-2xl border border-violet-200"},Re={class:"px-5 py-4 border-b border-gray-200 flex items-center justify-between"},Ve={class:"flex items-center gap-2"},Be={class:"px-5 py-4 border-t border-gray-200 flex items-center justify-between gap-2 bg-gray-50 rounded-b-xl"},Me={__name:"NoCategoriesModal",props:{isVisible:{type:Boolean,default:!1}},setup(x){return(e,t)=>x.isVisible?(T(),$("div",Ge,[s("div",{class:"absolute inset-0 bg-black/30",onClick:t[0]||(t[0]=r=>e.$emit("close"))}),s("div",Oe,[s("div",Re,[s("div",Ve,[_(m(_t),{class:"w-5 h-5 text-violet-600"}),t[4]||(t[4]=s("h3",{class:"text-base font-semibold text-gray-800"},"No Categories",-1))]),s("button",{onClick:t[1]||(t[1]=r=>e.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[_(m(mt),{class:"w-5 h-5"})])]),t[6]||(t[6]=s("div",{class:"p-5 space-y-3"},[s("p",{class:"text-sm text-gray-700"}," There are no categories for the selected project. Add a category to get started. ")],-1)),s("div",Be,[s("button",{onClick:t[2]||(t[2]=r=>e.$emit("close")),class:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-100"},"Close"),s("button",{onClick:t[3]||(t[3]=r=>e.$emit("add-category")),class:"px-4 py-2 rounded-md bg-gradient-to-r from-violet-600 to-violet-700 text-white hover:from-violet-700 hover:to-violet-800 inline-flex items-center gap-2"},[_(m(q),{class:"w-4 h-4"}),t[5]||(t[5]=P(" Add Category ",-1))])])])])):R("",!0)}},D=x=>x==null||isNaN(x)?"0.00":new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(x),Q=x=>{if(x==null||x==="")return"";const e=parseFloat(x);return isNaN(e)?x.toString():new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).format(e)},it=x=>{if(!x)return 0;const e=x.toString().replace(/[,\s]/g,""),t=parseFloat(e);return isNaN(t)?0:t},ct=x=>x>0?"text-red-600 bg-red-50":x<0?"text-green-600 bg-green-50":"text-gray-600 bg-gray-50",qe=(x,e)=>`${x.toString().padStart(2,"0")}.${(e+1).toString().padStart(2,"0")}`,Ue={class:"flex"},Je={class:"flex-1 min-h-screen bg-gradient-to-br from-white to-violet-50"},He={class:"flex"},Xe={key:2,class:"text-violet-700 text-sm font-medium dark:text-white"},ze={class:"mb-8"},Qe={class:"flex items-center gap-3 mb-2"},Ke={class:"w-12 h-12 bg-gradient-to-br from-violet-500 to-violet-600 rounded-xl flex items-center justify-center shadow-lg"},We={key:0,class:"mt-3"},Ze={class:"flex items-center gap-2 text-xs font-medium text-violet-600 bg-violet-50 px-3 py-2 rounded-lg border border-violet-200"},Ye={key:1,class:"mt-3"},ts={class:"flex items-center gap-2 text-xs font-medium text-blue-600 bg-blue-50 px-3 py-2 rounded-lg border border-blue-200"},es={class:"mb-6"},ss={class:"text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},os=["value"],as=["value"],rs={class:"bg-white rounded-xl p-4 mb-6 border border-gray-200 shadow-sm"},ns={class:"flex items-center justify-between"},ls={class:"flex items-center gap-2"},is={key:0,class:"flex items-center gap-2 text-sm font-medium text-red-600 bg-red-50 px-3 py-2 rounded-lg border border-red-200"},cs={key:1,class:"flex items-center gap-2 text-sm font-medium text-green-600 bg-green-50 px-3 py-2 rounded-lg border border-green-200"},us=["disabled"],ds={key:1,class:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg cursor-not-allowed"},ms={class:"mb-8"},ps={class:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2"},gs={class:"flex gap-2"},fs={class:"mt-2 space-y-2"},hs={class:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm"},ys={class:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"},vs={class:"space-y-3"},xs={class:"flex justify-between items-center"},bs={class:"font-semibold text-violet-600"},ws={class:"flex justify-between items-center"},_s={class:"font-semibold text-violet-600"},Cs={class:"flex justify-between items-center"},js={class:"font-semibold text-blue-600"},Ts={class:"flex justify-between items-center"},Ss={class:"font-semibold text-green-600"},$s={class:"flex justify-between items-center"},ks={class:"flex justify-between items-center"},Ps={class:"font-semibold text-purple-600"},Es={class:"flex justify-between items-center"},Is={class:"font-semibold text-orange-600"},Fs={class:"flex-1 p-4 min-w-0"},Ds={class:"flex items-center gap-2 mb-4"},As={class:"w-6 h-6 bg-gradient-to-br from-violet-500 to-violet-600 rounded-lg flex items-center justify-center"},Ls={key:0,class:"bg-white rounded-lg border border-violet-200 shadow-sm p-12"},Ns={class:"text-center"},Gs={class:"w-24 h-24 bg-gradient-to-br from-orange-100 to-orange-200 rounded-full flex items-center justify-center mx-auto mb-6"},Os={key:1,class:"bg-white rounded-lg border border-violet-200 shadow-sm p-12"},Rs={class:"text-center"},Vs={class:"w-24 h-24 bg-gradient-to-br from-violet-100 to-violet-200 rounded-full flex items-center justify-center mx-auto mb-6"},Bs={key:2,class:"bg-white rounded-2xl border border-gray-200 shadow-xl overflow-hidden"},Ms={class:"overflow-x-auto"},qs={class:"w-full"},Us={class:"bg-white divide-y divide-gray-100"},Js={class:"bg-gradient-to-r from-violet-100 to-purple-100 border-b border-violet-200 hover:from-violet-200 hover:to-purple-200 transition-all duration-200"},Hs={class:"px-6 py-4 text-sm text-violet-800 font-bold",colspan:"15"},Xs={class:"flex items-center justify-between"},zs={class:"flex items-center gap-3 text-violet-900"},Qs=["value","onInput"],Ks={class:"flex items-center gap-2"},Ws=["onClick"],Zs=["onClick","title"],Ys={class:"bg-gradient-to-r from-violet-50 to-purple-50 border-b-2 border-violet-300 font-bold shadow-sm"},to={class:"px-6 py-3 text-sm font-bold text-blue-900 text-right bg-blue-50/50"},eo={class:"px-6 py-3 text-sm font-bold text-green-900 text-right bg-green-50/50"},so={class:"px-6 py-3 text-sm font-bold text-purple-900 text-right bg-purple-50/50"},oo={class:"px-6 py-3 text-sm font-bold text-orange-900 text-right bg-orange-50/50"},ao={class:"px-2 py-3 text-sm text-gray-600 text-center"},ro={class:"p-0 text-sm"},no=["onUpdate:modelValue","onInput"],lo={class:"p-0 text-sm"},io=["value","onInput"],co={class:"p-0 text-sm"},uo=["value"],mo={class:"p-0 text-sm"},po=["value","onInput"],go={class:"p-0 text-sm"},fo=["value","onInput"],ho={class:"p-0 text-sm"},yo=["value","onInput"],vo={class:"p-0 text-sm"},xo=["onUpdate:modelValue"],bo={class:"p-0 text-sm"},wo=["onUpdate:modelValue"],_o=["value"],Co={class:"p-0 text-sm"},jo=["onUpdate:modelValue"],To={class:"p-0 text-sm"},So=["value","onInput"],$o={class:"px-2 py-3 text-sm font-medium text-orange-600 text-right"},ko={class:"p-0 text-sm"},Po=["onUpdate:modelValue"],Eo={class:"px-2 py-3 text-sm"},Io=["onClick"],Fo={class:"bg-gradient-to-r from-violet-50 to-purple-50 border-t-2 border-violet-200 font-bold"},Do={class:"px-6 py-4 text-sm font-bold text-blue-800 text-right"},Ao={class:"px-6 py-4 text-sm font-bold text-green-800 text-right"},Lo={class:"px-6 py-4 text-sm font-bold text-purple-800 text-right"},No={class:"px-6 py-4 text-sm font-bold text-orange-800 text-right"},Go={__name:"contractor_estimator",setup(x){const e=E(!1),t=E(!0),r=E(!1),a=E(""),c=E(!1),p=E(!1),f=E(!1),v=E(!1),l=E(""),u=E([]),j=E([]),g=E(null),L=E(null),N=E(!1),U=E(null),H=fe,tt=B(()=>{var n,o;return((o=(n=g.value)==null?void 0:n.categories)==null?void 0:o.length)||0}),I=B(()=>{var n;return(n=g.value)!=null&&n.categories?g.value.categories.reduce((o,i)=>o+i.items.length,0):0}),b=B(()=>{var n,o;return((o=(n=g.value)==null?void 0:n.totals)==null?void 0:o.projected)||0}),O=B(()=>{var n,o;return((o=(n=g.value)==null?void 0:n.totals)==null?void 0:o.actual)||0}),pt=B(()=>{var n,o;return((o=(n=g.value)==null?void 0:n.totals)==null?void 0:o.variance)||0}),Ct=B(()=>{var n,o;return((o=(n=g.value)==null?void 0:n.totals)==null?void 0:o.currentPaid)||0}),jt=B(()=>{var n,o;return((o=(n=g.value)==null?void 0:n.totals)==null?void 0:o.amountDue)||0}),ot=(n=!1)=>w(this,null,function*(){var o;try{r.value=!0;const i=(o=et.value)==null?void 0:o.name;if(!i){j.value=[],g.value=null,t.value=!0,a.value="";return}if(yield A.fetchData(i),j.value=[...A.getAllEstimators()],g.value=j.value[0]||null,g.value)if(g.value.categories.some(d=>d.items.length>0))t.value=!0;else{const d=g.value.projectTitle||"New Project Estimate",C=g.value.location||"";try{const y=yield A.createMergedEstimator(d,C,i);y.id=g.value.id,j.value=[y],g.value=y,t.value=!1}catch(y){console.error("Error creating estimator from API data:",y),t.value=!0}}else{const h=i||"New Project Estimate",d="";try{const C=yield A.createMergedEstimator(h,d,i);j.value=[C],g.value=C,t.value=!!C.id}catch(C){console.error("Error creating estimator from API data:",C);const y=V.createEmpty(h,d);y.project=i,j.value=[y],g.value=y,t.value=!1}}a.value=""}catch(i){console.error("Load data error:",i),a.value=i.message,k.error(`Failed to load data: ${i.message}`)}finally{r.value=!1}yield Vt(),yield Bt()}),F=()=>{t.value=!1,a.value="",g.value&&g.value.updateTotals()},at=(n,o,i)=>{const h=n.target.value,d=it(h);o[i]=d,i==="projected"&&typeof o.quantity=="number"&&typeof o.rate=="number"&&(o.projected=o.quantity*o.rate),F()},Tt=()=>w(this,null,function*(){var n;r.value=!0,a.value="";try{const o=(n=et.value)==null?void 0:n.name;yield St(),yield A.saveData(j.value,o),t.value=!0,k.success("Contractor estimate saved successfully")}catch(o){a.value=o.message,k.error(`Failed to save changes: ${o.message}`)}finally{r.value=!1}}),St=()=>w(this,null,function*(){if(!g.value)return;const n=[];if(g.value.categories.forEach(i=>{i.items.forEach(h=>{h.name&&h.name.trim()&&n.push({itemName:h.name.trim(),itemGroup:i.name,item:h})})}),n.length===0)return;const o=n.map(C=>w(this,[C],function*({itemName:i,itemGroup:h,item:d}){try{yield A.createItem(i,h),console.log(`Item "${i}" created in Frappe under group "${h}"`)}catch(y){console.warn(`Failed to create item "${i}":`,y.message)}}));yield Promise.allSettled(o)}),$t=(n,o)=>{const i=n.target.value;o.name=i||"Untitled Category",F()},kt=n=>{var i;const o=(i=g.value)==null?void 0:i.categories.find(h=>h.id===n);o&&(o.addItem(),g.value.updateTotals(),F())},Pt=n=>w(this,null,function*(){n.name&&n.name.trim()&&setTimeout(()=>w(this,null,function*(){try{try{const i=yield fetch(`/api/resource/Item/${encodeURIComponent(n.name)}?fields=["name","item_name","stock_uom","valuation_rate"]`);if(i.ok){const d=(yield i.json()).data||{};d.stock_uom&&(n.unitType=d.stock_uom),typeof d.valuation_rate=="number"&&(n.rate=d.valuation_rate),typeof n.quantity=="number"&&typeof n.rate=="number"&&(n.projected=n.quantity*n.rate)}}catch(i){}(yield A.populateActualSubtotalFromGL(n,{fromDate:"2025-01-01",toDate:"2025-12-31"})).success&&F()}catch(o){console.warn(`Failed to load GL balance for "${n.name}":`,o.message)}}),1500)}),Et=(n,o)=>{const i=n.target.value,h=it(i);o.quantity=h,typeof o.rate=="number"&&(o.projected=(o.quantity||0)*(o.rate||0)),F()},It=(n,o)=>{const i=n.target.value,h=it(i);o.rate=h,typeof o.quantity=="number"&&(o.projected=(o.quantity||0)*(o.rate||0)),F()},Ft=(n,o)=>w(this,null,function*(){var i,h;if(confirm("Are you sure you want to delete this item?"))try{const d=(i=g.value)==null?void 0:i.categories.find(C=>C.id===n);if(d){const C=d.items.find(y=>y.id===o);if(C){if((C.projected>0||C.actual>0||C.currentPaid>0||C.comments&&C.comments.trim()!==""||C.party!==""||C.status!=="Not Started"||C.percentComplete>0)&&((h=g.value)!=null&&h.id)){console.log(`Item '${C.name}' has data, deleting from database...`);const z=yield A.deleteItem(g.value.id,C.lineId);z.success?console.log("Successfully deleted item"):console.warn("Failed to delete item:",z.error)}else console.log(`Item '${C.name}' has no data, removing locally only`);d.removeItem(o),g.value.updateTotals(),F(),k.success("Item deleted successfully")}}}catch(d){k.error(`Failed to delete item: ${d.message}`)}}),Dt=n=>w(this,null,function*(){var d;const o=(d=g.value)==null?void 0:d.categories.find(C=>C.id===n);if(!o)return;const i=o.items.length,h=i>0?`Are you sure you want to delete the category "${o.name}" and all ${i} items within it?`:`Are you sure you want to delete the category "${o.name}"?`;if(confirm(h))try{g.value&&(g.value.removeCategory(n),F(),k.success(`Category "${o.name}" deleted successfully`))}catch(C){k.error(`Failed to delete category: ${C.message}`)}}),At=()=>w(this,null,function*(){var n,o,i;if(confirm("Are you sure you want to restore all categories from API? This will replace your current categories and items."))try{const h=((n=g.value)==null?void 0:n.projectTitle)||"New Project Estimate",d=((o=g.value)==null?void 0:o.location)||"",C=(i=et.value)==null?void 0:i.name,y=yield A.createMergedEstimator(h,d,C);j.value=[y],g.value=y,F(),k.success("Categories restored successfully")}catch(h){k.error(`Failed to restore categories from API: ${h.message}`)}}),Lt=()=>w(this,null,function*(){try{yield ot(!0),k.success("Data refreshed successfully")}catch(n){k.error(`Failed to refresh data: ${n.message}`)}}),Nt=()=>{try{if(!g.value){k.error("No data to export");return}const n=A.exportData("csv"),o=new Blob([n],{type:"text/csv"}),i=window.URL.createObjectURL(o),h=document.createElement("a");h.href=i,h.download=`contractor_estimate_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(i),k.success("Data exported successfully")}catch(n){k.error(`Failed to export data: ${n.message}`)}},Gt=()=>{c.value=!0},Ot=()=>{c.value=!1},rt=()=>{v.value=!0},nt=()=>{v.value=!1},Rt=(n,o)=>w(this,null,function*(){if(!g.value){k.error("Please create an estimator first");return}try{o==="create"&&(yield A.createItemGroup(n));const i=g.value.addCategory({name:n,order:g.value.categories.length+1});nt(),F(),o==="create"?k.success(`Category "${n}" added successfully and Category created`):k.success(`Category "${n}" added successfully from existing Category`)}catch(i){if(o==="create"){console.warn("Failed to create Category, adding category locally:",i.message);try{const h=g.value.addCategory({name:n,order:g.value.categories.length+1});nt(),F(),k.warning(`Category "${n}" added locally, but Cate creation failed: ${i.message}`)}catch(h){k.error(`Failed to add category: ${h.message}`)}}else k.error(`Failed to add category: ${i.message}`)}}),Vt=()=>w(this,null,function*(){try{const n=yield A.getDefaultCompany();L.value=n}catch(n){console.warn("Failed to load default company:",n.message),L.value=null}}),Bt=()=>w(this,null,function*(){if(g.value)try{N.value=!0;const n=yield A.autoLoadGLBalancesForEstimator(g.value,{fromDate:"2025-01-01",toDate:"2025-12-31"});U.value=n,n.success&&n.successful>0?(F(),k.success(`GL balances loaded: ${n.successful} items updated`+(n.failed>0?`, ${n.failed} failed`:""))):n.success&&n.failed>0&&k.warning(`GL balance loading completed with ${n.failed} failures`)}catch(n){console.error("Error auto-loading GL balances:",n),k.warning("Failed to auto-load GL balances: "+n.message)}finally{N.value=!1}});bt(()=>w(this,null,function*(){var i,h,d;try{yield Wt()}catch(C){}yield A.testApiConnection();try{const C=yield fetch('/api/resource/Project?limit_page_length=1000&fields=["name","project_name"]');if(C.ok){const y=yield C.json();u.value=(y.data||[]).map(z=>({name:z.name,project_name:z.project_name}))}}catch(C){}const n=((i=Zt)==null?void 0:i())||null;n&&n.name?(ht(n),l.value=n.name):l.value="",yield ot();const o=(d=(h=et)==null?void 0:h.value)==null?void 0:d.project_name;o&&k.success(`Switched to project: ${o}`)}));const Mt=n=>w(this,null,function*(){try{const o=n.target.value;if(l.value=o,!o){l.value="",j.value=[],g.value=null,p.value=!0;return}const i=u.value?u.value.find(h=>h.name===o):null;i&&(ht(i),k.success(`Switched to project: ${i.project_name||i.name}`)),yield ot(!0)}catch(o){k.error("Failed to switch project")}}),qt=()=>{if(!l.value){p.value=!0;return}rt()},Ut=()=>{f.value=!1,rt()};return(n,o)=>(T(),$("div",Ue,[_(se,{onOpenSettings:Gt}),s("div",Je,[s("div",He,[s("div",{class:J(["bg-gradient-to-b from-white to-gray-50 border-r border-gray-200 min-h-screen flex flex-col shadow-sm transition-all duration-300",e.value?"w-14 p-2":"w-80 p-6"])},[s("button",{onClick:o[0]||(o[0]=i=>e.value=!e.value),class:"mb-4 flex items-center gap-2 px-2 py-1 bg-violet-100 hover:bg-violet-200 rounded transition-all dark:bg-violet-900/30 dark:hover:bg-violet-800/40"},[e.value?(T(),st(m(ue),{key:1,class:"w-5 h-5 text-violet-700 dark:text-white"})):(T(),st(m(de),{key:0,class:"w-5 h-5 text-violet-700 dark:text-white"})),e.value?R("",!0):(T(),$("span",Xe,"Collapse"))]),_(ee,{name:"fade"},{default:Yt(()=>[M(s("div",null,[s("div",ze,[s("div",Qe,[s("div",Ke,[_(m(oe),{class:"w-7 h-7 mx-2 text-white"})]),o[4]||(o[4]=s("h1",{class:"text-2xl font-bold text-gray-900"},"Contractor Estimator",-1))]),o[7]||(o[7]=s("p",{class:"text-sm text-gray-500"},"Manage and track your construction project estimates",-1)),L.value?(T(),$("div",We,[s("div",Ze,[o[5]||(o[5]=s("div",{class:"w-2 h-2 bg-violet-500 rounded-full"},null,-1)),P(" Company: "+S(L.value.company_name)+" ("+S(L.value.abbr)+") ",1)])])):R("",!0),N.value?(T(),$("div",Ye,[s("div",ts,[_(m(dt),{class:"w-3 h-3 animate-spin"}),o[6]||(o[6]=P(" Loading GL balances... ",-1))])])):R("",!0)]),s("div",es,[s("h3",ss,[_(m(_t),{class:"w-4 h-4 text-violet-600"}),o[8]||(o[8]=P(" Project ",-1))]),s("select",{value:l.value,onChange:o[1]||(o[1]=i=>Mt(i)),class:"w-full px-3 py-2 bg-white border border-violet-200 rounded-lg text-gray-800 focus:ring-2 focus:ring-violet-500 focus:border-violet-400 text-sm shadow-sm hover:border-violet-300 transition-colors"},[o[9]||(o[9]=s("option",{value:""},"Select Project",-1)),(T(!0),$(X,null,K(u.value,i=>(T(),$("option",{key:i.name,value:i.name},S(i.project_name||i.name),9,as))),128))],40,os)]),s("div",rs,[s("div",ns,[s("div",ls,[t.value?(T(),$("div",cs,[_(m(ae),{class:"w-4 h-4 text-green-600"}),o[11]||(o[11]=P(" All Saved ",-1))])):(T(),$("div",is,[_(m(ut),{class:"w-4 h-4 text-red-600"}),o[10]||(o[10]=P(" Unsaved ",-1))]))]),!r.value&&!t.value?(T(),$("button",{key:0,disabled:r.value,onClick:Tt,class:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-600 to-violet-700 text-white rounded-lg hover:from-violet-700 hover:to-violet-800 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105"},[_(m(me),{class:"w-4 h-4"}),o[12]||(o[12]=P(" Save ",-1))],8,us)):R("",!0),r.value?(T(),$("button",ds,[_(m(dt),{class:"w-4 h-4 animate-spin"}),o[13]||(o[13]=P(" Saving... ",-1))])):R("",!0)])]),s("div",ms,[s("h3",ps,[_(m(q),{class:"w-4 h-4 text-violet-600"}),o[14]||(o[14]=P(" Quick Actions ",-1))]),s("div",gs,[s("button",{onClick:Lt,class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-violet-200 text-violet-700 rounded-lg hover:bg-violet-50 transition-all text-sm font-medium"},[_(m(re),{class:"w-4 h-4"}),o[15]||(o[15]=P(" Refresh ",-1))]),s("button",{onClick:Nt,class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-green-200 text-green-700 rounded-lg hover:bg-green-50 transition-all text-sm font-medium"},[_(m(ne),{class:"w-4 h-4"}),o[16]||(o[16]=P(" Export ",-1))])]),s("div",fs,[s("button",{onClick:rt,class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-violet-200 text-violet-700 rounded-lg hover:bg-violet-50 transition-all text-sm font-medium"},[_(m(q),{class:"w-4 h-4"}),o[17]||(o[17]=P(" Add Category ",-1))]),s("button",{onClick:At,class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-orange-200 text-orange-700 rounded-lg hover:bg-orange-50 transition-all text-sm font-medium"},[_(m(pe),{class:"w-4 h-4"}),o[18]||(o[18]=P(" Restore ",-1))])])]),s("div",hs,[s("h3",ys,[_(m(ge),{class:"w-5 h-5 text-violet-600"}),o[19]||(o[19]=P(" Project Summary ",-1))]),s("div",vs,[s("div",xs,[o[20]||(o[20]=s("span",{class:"text-sm text-gray-600"},"Total Categories:",-1)),s("span",bs,S(tt.value),1)]),s("div",ws,[o[21]||(o[21]=s("span",{class:"text-sm text-gray-600"},"Total Items:",-1)),s("span",_s,S(I.value),1)]),s("div",Cs,[o[22]||(o[22]=s("span",{class:"text-sm text-gray-600"},"Projected Total:",-1)),s("span",js,S(m(D)(b.value)),1)]),s("div",Ts,[o[23]||(o[23]=s("span",{class:"text-sm text-gray-600"},"Actual Total:",-1)),s("span",Ss,S(m(D)(O.value)),1)]),s("div",$s,[o[24]||(o[24]=s("span",{class:"text-sm text-gray-600"},"Variance:",-1)),s("span",{class:J(["font-semibold",pt.value>=0?"text-red-600":"text-green-600"])},S(m(D)(pt.value)),3)]),s("div",ks,[o[25]||(o[25]=s("span",{class:"text-sm text-gray-600"},"Current Paid:",-1)),s("span",Ps,S(m(D)(Ct.value)),1)]),s("div",Es,[o[26]||(o[26]=s("span",{class:"text-sm text-gray-600"},"Amount Due:",-1)),s("span",Is,S(m(D)(jt.value)),1)])])])],512),[[te,!e.value]])]),_:1})],2),s("div",Fs,[s("div",Ds,[s("div",As,[_(m(yt),{class:"w-3 h-3 text-white"})]),o[27]||(o[27]=s("h2",{class:"text-lg font-bold text-gray-800"},"Contractor Estimate Overview",-1))]),l.value?!g.value||g.value.categories.length===0?(T(),$("div",Os,[s("div",Rs,[s("div",Vs,[_(m(yt),{class:"w-12 h-12 text-violet-600"})]),o[31]||(o[31]=s("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"No Categories",-1)),o[32]||(o[32]=s("p",{class:"text-gray-600 mb-8 max-w-md mx-auto"}," Add your first category to begin building this contractor estimate. ",-1)),s("button",{onClick:qt,class:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-violet-600 to-violet-700 text-white rounded-xl hover:from-violet-700 hover:to-violet-800 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 font-medium"},[_(m(q),{class:"w-5 h-5"}),o[30]||(o[30]=P(" Add Category ",-1))])])])):(T(),$("div",Bs,[s("div",Ms,[s("table",qs,[o[47]||(o[47]=s("thead",{class:"bg-violet-500 text-white shadow-lg"},[s("tr",{class:"border-b border-white/20"},[s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-16"},"Line ID"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-80"},"Category & Items"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-24"},"Qty"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-28"},"Unit Type"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Rate"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Projected Subtotal"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Actual Subtotal"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Variance"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-48"},"Party Responsible"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Status"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-24"},"% Complete"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Current Paid"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Amount Due"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-48"},"Comments"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-16"},"Actions")])],-1)),s("tbody",Us,[(T(!0),$(X,null,K(g.value.categories,(i,h)=>(T(),$(X,{key:`category-${i.id}`},[s("tr",Js,[s("td",Hs,[s("div",Xs,[s("div",zs,[o[33]||(o[33]=s("div",{class:"w-4 h-4 bg-gradient-to-r from-violet-600 to-purple-600 rounded-full shadow-sm"},null,-1)),s("input",{value:i.name,onInput:d=>$t(d,i),type:"text",class:"font-bold text-lg bg-transparent border-0 focus:ring-2 focus:ring-violet-500 focus:bg-white focus:shadow-sm px-2 py-1 rounded transition-all duration-200 min-w-0 flex-1 text-violet-900",placeholder:"Category name"},null,40,Qs)]),s("div",Ks,[s("button",{onClick:d=>kt(i.id),class:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-600 to-violet-700 text-white rounded-lg hover:from-violet-700 hover:to-violet-800 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105"},[_(m(q),{class:"w-4 h-4"}),o[34]||(o[34]=P(" Add Item ",-1))],8,Ws),s("button",{onClick:d=>Dt(i.id),class:"inline-flex items-center justify-center w-10 h-10 rounded-lg text-red-600 hover:text-white hover:bg-red-600 transition-all duration-200 shadow-sm hover:shadow-md",title:`Delete category: ${i.name}`},[_(m(vt),{class:"w-4 h-4"})],8,Zs)])])])]),s("tr",Ys,[o[35]||(o[35]=s("td",{class:"px-6 py-3 text-sm text-violet-700 font-bold",colspan:"5"},[s("div",{class:"flex items-center gap-2"},[s("div",{class:"w-2 h-2 bg-violet-500 rounded-full"}),P(" SUBTOTAL ")])],-1)),s("td",to,S(m(D)(i.subtotals.projected)),1),s("td",eo,S(m(D)(i.subtotals.actual)),1),s("td",{class:J(["px-6 py-3 text-sm font-bold text-right bg-gray-50/50",m(ct)(i.subtotals.variance)])},S(m(D)(i.subtotals.variance)),3),o[36]||(o[36]=s("td",{class:"px-6 py-3 text-sm text-gray-500 bg-gray-50/30"},null,-1)),o[37]||(o[37]=s("td",{class:"px-6 py-3 text-sm text-gray-500 bg-gray-50/30"},null,-1)),o[38]||(o[38]=s("td",{class:"px-6 py-3 text-sm text-gray-500 bg-gray-50/30"},null,-1)),s("td",so,S(m(D)(i.subtotals.currentPaid)),1),s("td",oo,S(m(D)(i.subtotals.amountDue)),1),o[39]||(o[39]=s("td",{class:"px-6 py-3 text-sm text-gray-500 bg-gray-50/30"},null,-1)),o[40]||(o[40]=s("td",{class:"px-6 py-3 text-sm text-gray-500 bg-gray-50/30"},null,-1))]),(T(!0),$(X,null,K(i.items,(d,C)=>(T(),$("tr",{key:`item-${i.id}-${d.id}`,class:"transition-all duration-200 h-12 align-middle hover:bg-slate-50/50 border-b border-gray-100"},[s("td",ao,S(d.lineId||m(qe)(h+1,C)),1),s("td",ro,[M(s("input",{"onUpdate:modelValue":y=>d.name=y,type:"text",class:"w-full h-full px-4 py-0 border-0 bg-transparent text-sm focus:ring-2 focus:ring-violet-500 focus:bg-white focus:shadow-sm font-medium transition-all duration-200",placeholder:"Enter item name",onInput:y=>{F(),Pt(d)}},null,40,no),[[W,d.name]])]),s("td",lo,[s("input",{value:m(Q)(d.quantity),onInput:y=>Et(y,d),type:"text",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-violet-500 focus:border-transparent",placeholder:"0"},null,40,io)]),s("td",co,[s("input",{value:d.unitType,type:"text",readonly:"",class:"w-full h-full px-4 py-0 border-0 bg-transparent text-sm text-gray-600 cursor-not-allowed",placeholder:"UOM",tabindex:"-1"},null,8,uo)]),s("td",mo,[s("input",{value:m(Q)(d.rate),onInput:y=>It(y,d),type:"text",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-violet-500 focus:border-transparent",placeholder:"0"},null,40,po)]),s("td",go,[s("input",{value:m(Q)(d.projected),onInput:y=>at(y,d,"projected"),type:"text",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"},null,40,fo)]),s("td",ho,[s("input",{value:m(Q)(d.actual),onInput:y=>at(y,d,"actual"),type:"text",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"0"},null,40,yo)]),s("td",{class:J(["px-2 py-3 text-sm font-medium text-right",m(ct)(d.variance)])},S(m(D)(d.variance)),3),s("td",vo,[M(s("input",{"onUpdate:modelValue":y=>d.party=y,type:"text",class:"w-full h-full px-4 py-0 border-0 bg-transparent text-sm focus:ring-2 focus:ring-violet-500 focus:bg-white focus:shadow-sm transition-all duration-200",placeholder:"Vendor/Contractor",onInput:F},null,40,xo),[[W,d.party]])]),s("td",bo,[M(s("select",{"onUpdate:modelValue":y=>d.status=y,class:"w-full h-full px-4 py-0 border-0 bg-transparent text-sm focus:ring-2 focus:ring-violet-500 focus:bg-white focus:shadow-sm transition-all duration-200",onChange:F},[(T(!0),$(X,null,K(m(H),y=>(T(),$("option",{key:y,value:y},S(y),9,_o))),128))],40,wo),[[wt,d.status]])]),s("td",Co,[M(s("input",{"onUpdate:modelValue":y=>d.percentComplete=y,type:"number",min:"0",max:"100",step:"1",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-violet-500 focus:border-transparent",onInput:F},null,40,jo),[[W,d.percentComplete,void 0,{number:!0}]])]),s("td",To,[s("input",{value:m(Q)(d.currentPaid),onInput:y=>at(y,d,"currentPaid"),type:"text",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0"},null,40,So)]),s("td",$o,S(m(D)(d.amountDue)),1),s("td",ko,[M(s("input",{"onUpdate:modelValue":y=>d.comments=y,type:"text",class:"w-full h-full px-4 py-0 border-0 bg-transparent text-sm focus:ring-2 focus:ring-violet-500 focus:bg-white focus:shadow-sm transition-all duration-200",placeholder:"Comments",onInput:F},null,40,Po),[[W,d.comments]])]),s("td",Eo,[s("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-md text-red-600 hover:text-white hover:bg-red-600 transition-colors",onClick:y=>Ft(i.id,d.id),title:"Delete item"},[_(m(vt),{class:"w-4 h-4"})],8,Io)])]))),128))],64))),128)),s("tr",Fo,[o[41]||(o[41]=s("td",{class:"px-6 py-4 text-sm text-violet-800 font-bold",colspan:"5"},[s("div",{class:"flex items-center gap-2"},[s("div",{class:"w-3 h-3 bg-gradient-to-r from-violet-500 to-purple-500 rounded-full"}),P(" TOTALS ")])],-1)),s("td",Do,S(m(D)(g.value.totals.projected)),1),s("td",Ao,S(m(D)(g.value.totals.actual)),1),s("td",{class:J(["px-6 py-4 text-sm font-bold text-right",m(ct)(g.value.totals.variance)])},S(m(D)(g.value.totals.variance)),3),o[42]||(o[42]=s("td",{class:"px-6 py-4 text-sm text-gray-600"},null,-1)),o[43]||(o[43]=s("td",{class:"px-6 py-4 text-sm text-gray-600"},null,-1)),o[44]||(o[44]=s("td",{class:"px-6 py-4 text-sm text-gray-600"},null,-1)),s("td",Lo,S(m(D)(g.value.totals.currentPaid)),1),s("td",No,S(m(D)(g.value.totals.amountDue)),1),o[45]||(o[45]=s("td",{class:"px-6 py-4 text-sm text-gray-600"},null,-1)),o[46]||(o[46]=s("td",{class:"px-6 py-4 text-sm text-gray-600"},null,-1))])])])])])):(T(),$("div",Ls,[s("div",Ns,[s("div",Gs,[_(m(ut),{class:"w-12 h-12 text-orange-600"})]),o[28]||(o[28]=s("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"Project Required",-1)),o[29]||(o[29]=s("p",{class:"text-gray-600 mb-8 max-w-md mx-auto"}," Please select a project from the Project dropdown to view or edit estimates. ",-1))])]))])])]),_(le,{"is-visible":c.value,onClose:Ot},null,8,["is-visible"]),_(Ie,{"is-visible":v.value,onClose:nt,onCreate:Rt},null,8,["is-visible"]),_(Ne,{"is-visible":p.value,onClose:o[2]||(o[2]=()=>p.value=!1)},null,8,["is-visible"]),_(Me,{"is-visible":f.value,onClose:o[3]||(o[3]=()=>f.value=!1),onAddCategory:Ut},null,8,["is-visible"])]))}},Zo=xt(Go,[["__scopeId","data-v-db020b74"]]);export{Zo as default};
