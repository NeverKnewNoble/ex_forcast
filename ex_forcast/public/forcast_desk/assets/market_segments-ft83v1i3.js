var E=(e,r,t)=>new Promise((o,a)=>{var s=i=>{try{d(t.next(i))}catch(p){a(p)}},g=i=>{try{d(t.throw(i))}catch(p){a(p)}},d=i=>i.done?o(i.value):Promise.resolve(i.value).then(s,g);d((t=t.apply(e,r)).next())});import{n as O,x as y,h as j}from"./index-BwGj6WF3.js";import{a as A}from"./useCalculationCache-CShkTzc7.js";function P(){return E(this,null,function*(){try{const e=O.value;if(!e)return{status:"no_project_selected",message:"No project selected"};const o=(yield(yield fetch(`/api/v2/method/ex_forcast.api.room_revenue_display.room_revenue_display?project=${encodeURIComponent(e.project_name)}`,{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":y()}})).json()).data||{};return Object.keys(o).length>0?o:{status:"no_data",message:`No room revenue data found for project: ${e.project_name}`,project:e.project_name}}catch(e){return console.error("Error fetching room revenue data:",e),{status:"error",message:"Failed to load room revenue data"}}})}function F(e){return E(this,null,function*(){try{const r=new URLSearchParams;r.append("category_name",e);const t=yield fetch("/api/v2/method/ex_forcast.api.segment_category_api.create_segment_category",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Frappe-CSRF-Token":y()},body:r});if(!t.ok){const a=yield t.text();throw console.error("API Error Response:",a),new Error(`API call failed with status ${t.status}: ${a}`)}return yield t.json()}catch(r){throw console.error("Error creating segment category:",r),r}})}function I(){return E(this,null,function*(){try{const e=yield fetch("/api/v2/method/ex_forcast.api.segment_category_api.get_segment_categories",{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":y()}});if(!e.ok){const t=yield e.text();throw console.error("API Error Response:",t),new Error(`API call failed with status ${e.status}: ${t}`)}return yield e.json()}catch(e){throw console.error("Error fetching segment categories:",e),e}})}function M(){return E(this,null,function*(){try{const e=yield fetch("/api/v2/method/ex_forcast.api.segment_category_api.get_default_segment_categories",{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":y()}});if(!e.ok){const t=yield e.text();throw console.error("API Error Response:",t),new Error(`API call failed with status ${e.status}: ${t}`)}return yield e.json()}catch(e){throw console.error("Error fetching default segment categories:",e),e}})}function x(e){return E(this,null,function*(){try{const r=new URLSearchParams;r.append("category_name",e);const t=yield fetch("/api/v2/method/ex_forcast.api.segment_category_api.delete_segment_category",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Frappe-CSRF-Token":y()},body:r});if(!t.ok){const a=yield t.text();throw console.error("API Error Response:",a),new Error(`API call failed with status ${t.status}: ${a}`)}return yield t.json()}catch(r){throw console.error("Error deleting segment category:",r),r}})}function N(e){return E(this,null,function*(){try{const r=O.value;if(!r)throw new Error("No project selected. Please select a project first.");const t=new URLSearchParams;t.append("changes",JSON.stringify(e)),t.append("project",r.project_name);const o=yield fetch("/api/v2/method/ex_forcast.api.room_revenue_display.upsert_room_revenue_items",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Frappe-CSRF-Token":y()},body:t});if(!o.ok){const s=yield o.text();throw console.error("Room revenue API Error Response:",s),new Error(`API call failed with status ${o.status}: ${s}`)}return yield o.json()}catch(r){throw console.error("Error saving room revenue changes:",r),r}})}function U(e,r){return E(this,null,function*(){try{const t=new URLSearchParams;t.append("market_segment",e),t.append("segment_category",r);const o=yield fetch("/api/v2/method/ex_forcast.api.room_market_segment_api.create_room_market_segment",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Frappe-CSRF-Token":y()},body:t});if(!o.ok){const s=yield o.text();throw console.error("API Error Response:",s),new Error(`API call failed with status ${o.status}: ${s}`)}return yield o.json()}catch(t){throw console.error("Error creating room market segment:",t),t}})}function D(){return E(this,null,function*(){try{const e=yield fetch("/api/v2/method/ex_forcast.api.room_market_segment_api.get_room_market_segments",{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":y()}});if(!e.ok){const t=yield e.text();throw console.error("API Error Response:",t),new Error(`API call failed with status ${e.status}: ${t}`)}return yield e.json()}catch(e){throw console.error("Error fetching room market segments:",e),e}})}function L(){return E(this,null,function*(){try{const e=yield fetch("/api/v2/method/ex_forcast.api.room_market_segment_api.get_default_room_market_segments",{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":y()}});if(!e.ok){const t=yield e.text();throw console.error("API Error Response:",t),new Error(`API call failed with status ${e.status}: ${t}`)}return yield e.json()}catch(e){throw console.error("Error fetching default room market segments:",e),e}})}function G(e){return E(this,null,function*(){try{const r=new URLSearchParams;r.append("market_segment",e);const t=yield fetch("/api/v2/method/ex_forcast.api.room_market_segment_api.delete_room_market_segment",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Frappe-CSRF-Token":y()},body:r});if(!t.ok){const a=yield t.text();throw console.error("API Error Response:",a),new Error(`API call failed with status ${t.status}: ${a}`)}return yield t.json()}catch(r){throw console.error("Error deleting room market segment:",r),r}})}function $(){return E(this,null,function*(){try{const e=O.value;if(!e)return{status:"no_project_selected",message:"No project selected"};const o=(yield(yield fetch(`/api/v2/method/ex_forcast.api.room_revenue_display.market_segment_display?project=${encodeURIComponent(e.project_name)}`,{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":y()}})).json()).data||{};return Object.keys(o).length>0?o:{status:"no_data",message:`No market segment data found for project: ${e.project_name}`,project:e.project_name}}catch(e){return console.error("Error fetching market segment data:",e),{status:"error",message:"Failed to load market segment data"}}})}function q(e){return E(this,null,function*(){try{const r=O.value;if(!r)throw new Error("No project selected. Please select a project first.");const t=new URLSearchParams;t.append("changes",JSON.stringify(e)),t.append("project",r.project_name);const o=yield fetch("/api/v2/method/ex_forcast.api.room_revenue_display.upsert_market_segment_items",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Frappe-CSRF-Token":y()},body:t});if(!o.ok){const s=yield o.text();throw console.error("API Error Response:",s),new Error(`API call failed with status ${o.status}: ${s}`)}return yield o.json()}catch(r){throw console.error("Error saving market segment changes:",r),r}})}const B=Object.freeze(Object.defineProperty({__proto__:null,createRoomMarketSegment:U,createSegmentCategory:F,deleteRoomMarketSegment:G,deleteSegmentCategory:x,getDefaultRoomMarketSegments:L,getDefaultSegmentCategories:M,getMarketSegmentList:$,getRoomMarketSegments:D,getRoomRevenueList:P,getSegmentCategories:I,saveMarketSegmentChanges:q,saveRoomRevenueChanges:N},Symbol.toStringTag,{value:"Module"})),b=["Standard","Superior","Deluxe","Suite","Presidential"];let S=[...b];function H(e){if(e&&e.length>0){const r=[...b];e.forEach(t=>{const o=t.package_name||t.name;b.includes(o)||r.push(o)}),S=r}else S=[...b]}const C=j(new Set);function W(e){C.value.has(e)?C.value.delete(e):C.value.add(e)}function Y(e){return C.value.has(e)}function z(e,r){if(!e||!r)return[];const t=parseInt(e),o=parseInt(r);if(t>o)return[];const a=[];for(let s=t;s<=o;s++)a.push(s.toString());return a}function v(e="monthly"){return e==="quarterly"?["Jan-Mar","Apr-Jun","Jul-Sep","Oct-Dec"]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}const _={"Jan-Mar":["Jan","Feb","Mar"],"Apr-Jun":["Apr","May","Jun"],"Jul-Sep":["Jul","Aug","Sep"],"Oct-Dec":["Oct","Nov","Dec"]};function f(e,r){const o={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[r];return o===void 0?0:new Date(parseInt(e),o+1,0).getDate()}function k(e,r,t,o,a="monthly"){var s,g,d;if(a==="quarterly"&&_[o]){const p=(((s=e==null?void 0:e[t])==null?void 0:s[o])||[]).find(c=>c.room_package===r);if(p)return{number_of_rooms:parseFloat(p.number_of_rooms)||0,rate:parseFloat(p.rate)||0,occupied_beds:parseFloat(p.occupied_beds)||0};const n={number_of_rooms:0,rate:0,occupied_beds:0,count:0};for(const c of _[o]){const u=(((g=e==null?void 0:e[t])==null?void 0:g[c])||[]).find(h=>h.room_package===r);u&&(n.number_of_rooms+=parseFloat(u.number_of_rooms)||0,n.rate+=parseFloat(u.rate)||0,n.occupied_beds+=parseFloat(u.occupied_beds)||0,n.count++)}return n.count>0?{number_of_rooms:n.number_of_rooms/n.count,rate:n.rate/n.count,occupied_beds:n.occupied_beds/n.count}:{number_of_rooms:0,rate:0,occupied_beds:0}}else{const p=(((d=e==null?void 0:e[t])==null?void 0:d[o])||[]).find(n=>n.room_package===r);return p?{number_of_rooms:parseFloat(p.number_of_rooms)||0,rate:parseFloat(p.rate)||0,occupied_beds:parseFloat(p.occupied_beds)||0}:{number_of_rooms:0,rate:0,occupied_beds:0}}}function R(e,r="number"){return r==="percentage"?e.toFixed(1)+"%":r==="currency"?e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}function K(e,r,t,o,a="monthly",s=[]){k(e,r,t,o,a);const g=T(s,r,e);if(a==="quarterly"&&_[o]){let d=0;for(const p of _[o])d+=f(t,p);const i=g*d;return R(i,"number")}else{const d=f(t,o),i=g*d;return R(i,"number")}}function Q(e,r,t,o,a="monthly"){const s=k(e,r,t,o,a);return R(s.occupied_beds,"percentage")}function Z(e,r,t,o,a="monthly"){const s=k(e,r,t,o,a);return R(s.rate,"currency")}function ee(e,r,t,o,a="monthly",s=[]){var n;const g=k(e,r,t,o,a),d=T(s,r,e);let i;if(a==="quarterly"&&_[o]){let c=0;for(const l of _[o])c+=f(t,l);i=d*c}else{const c=f(t,o);i=d*c}const p=i*(g.occupied_beds/100)*g.rate;try{const c=A(),l=((n=O.value)==null?void 0:n.project_name)||"default",u=`Room Type:${r}`;c.setValue(l,"Room Revenue Assumptions",u,t,o,p)}catch(c){}return R(p,"currency")}function te(e,r,t,o,a="revenue",s=[]){var p;const g=v(o);let d=0;for(const n of g){let c=0;const l=k(e,r,t,n,o),u=T(s,r,e);switch(a){case"available_beds":if(o==="quarterly"&&_[n]){let m=0;for(const w of _[n])m+=f(t,w);c=u*m}else{const m=f(t,n);c=u*m}break;case"occupied_beds":c=l.occupied_beds;break;case"rate":c=l.rate;break;case"revenue":let h;if(o==="quarterly"&&_[n]){let m=0;for(const w of _[n])m+=f(t,w);h=u*m}else{const m=f(t,n);h=u*m}c=h*(l.occupied_beds/100)*l.rate;break}d+=c}const i=a==="occupied_beds"?"percentage":a==="rate"||a==="revenue"?"currency":"number";try{if(a==="revenue"){const n=A(),c=((p=O.value)==null?void 0:p.project_name)||"default",l=`Room Type Year:${r}`;n.setValue(c,"Room Revenue Assumptions",l,t,"ALL",d)}}catch(n){}return R(d,i)}function re(e,r,t,o,a="revenue",s=[]){let g=0,d=0;const i=s&&s.length>0?s.map(n=>n.package_name||n.name):S;for(const n of i){const c=k(e,n,r,t,o),l=T(s,n,e);let u=0;switch(a){case"available_beds":if(o==="quarterly"&&_[t]){let m=0;for(const w of _[t])m+=f(r,w);u=l*m}else{const m=f(r,t);u=l*m}break;case"occupied_beds":u=c.occupied_beds;break;case"rate":u=c.rate;break;case"revenue":let h;if(o==="quarterly"&&_[t]){let m=0;for(const w of _[t])m+=f(r,w);h=l*m}else{const m=f(r,t);h=l*m}u=h*(c.occupied_beds/100)*c.rate;break}g+=u,d++}return(a==="occupied_beds"||a==="rate")&&(g=d>0?g/d:0),R(g,a==="occupied_beds"?"percentage":a==="rate"||a==="revenue"?"currency":"number")}function oe(e,r,t,o="revenue",a=[]){let s=0;const g=a&&a.length>0?a.map(i=>i.package_name||i.name):S;for(const i of g){const p=v(t);for(const n of p){const c=k(e,i,r,n,t),l=T(a,i,e);let u=0;switch(o){case"available_beds":if(t==="quarterly"&&_[n]){let m=0;for(const w of _[n])m+=f(r,w);u=l*m}else{const m=f(r,n);u=l*m}break;case"occupied_beds":u=c.occupied_beds;break;case"rate":u=c.rate;break;case"revenue":let h;if(t==="quarterly"&&_[n]){let m=0;for(const w of _[n])m+=f(r,w);h=l*m}else{const m=f(r,n);h=l*m}u=h*(c.occupied_beds/100)*c.rate;break}s+=u}}return R(s,o==="occupied_beds"?"percentage":o==="rate"||o==="revenue"?"currency":"number")}function T(e,r,t=null){if(t&&t.room_packages){const a=t.room_packages.find(s=>s.name===r);if(a)return a.number_of_rooms}const o=e.find(a=>(a.package_name||a.name)===r);return o?o.number_of_rooms:0}function ae(e,r=null){let t=0;for(const o of S)t+=T(e,o,r);return t}const ne=[{market_segment:"NO-SHOW /DAY USE / EXTRA BED / LATE CHECK OUT",segment_category:"OTHER ROOMS REVENUE"},{market_segment:"HOUSE USE ROOMS",segment_category:"OTHER ROOMS REVENUE"},{market_segment:"COMPLIMENTERY ROOMS",segment_category:"OTHER ROOMS REVENUE"},{market_segment:"Long Term Stays",segment_category:"CONTRACT ROOMS REVENUE"},{market_segment:"Crew",segment_category:"CONTRACT ROOMS REVENUE"},{market_segment:"Groups S.M.E.R.F",segment_category:"GROUP ROOMS REVENUE"},{market_segment:"Groups Tours / Wholesalers",segment_category:"GROUP ROOMS REVENUE"},{market_segment:"Groups Sports",segment_category:"GROUP ROOMS REVENUE"},{market_segment:"Groups Association / Conventions / Events",segment_category:"GROUP ROOMS REVENUE"},{market_segment:"Groups Government",segment_category:"GROUP ROOMS REVENUE"},{market_segment:"Groups Corporate",segment_category:"GROUP ROOMS REVENUE"},{market_segment:"Transient Tours / Travel",segment_category:"WHOLESALE"},{market_segment:"Wholesale Allotment / Static",segment_category:"WHOLESALE"},{market_segment:"Wholesale Dynamic",segment_category:"WHOLESALE"},{market_segment:"TMC / Consortia",segment_category:"NEGOTIATED (CORPORATE)"},{market_segment:"Government Global / Local",segment_category:"NEGOTIATED (CORPORATE)"},{market_segment:"Negotiated Local",segment_category:"NEGOTIATED (CORPORATE)"},{market_segment:"Negotiated Global",segment_category:"NEGOTIATED (CORPORATE)"},{market_segment:"Members Discount - Government Mandated",segment_category:"QUALIFIED"},{market_segment:"Staff Rate Discount / Management Discretion Discount",segment_category:"QUALIFIED"},{market_segment:"Loyalty",segment_category:"DISCOUNT"},{market_segment:"Hotel Discount",segment_category:"DISCOUNT"},{market_segment:"OTA Promotion / OTA Package",segment_category:"DISCOUNT"},{market_segment:"Local Promotion",segment_category:"DISCOUNT"},{market_segment:"Global Promotion",segment_category:"DISCOUNT"},{market_segment:"OTA Retail",segment_category:"RETAIL"},{market_segment:"Direct Retail",segment_category:"RETAIL"}];//! Function To Get Average Daily Rate Calculation
function se(e,r,t,o){return!e>0?0:(e*(1+r/100)+t)*o}export{se as A,B,b as D,ne as M,S as R,D as a,M as b,L as c,F as d,U as e,x as f,I as g,G as h,$ as i,f as j,z as k,ae as l,P as m,T as n,Y as o,K as p,te as q,re as r,oe as s,W as t,H as u,Q as v,Z as w,ee as x,q as y,v as z};
