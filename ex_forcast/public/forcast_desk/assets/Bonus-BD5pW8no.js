var dt=Object.defineProperty;var le=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable;var ue=(l,a,n)=>a in l?dt(l,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[a]=n,ie=(l,a)=>{for(var n in a||(a={}))ct.call(a,n)&&ue(l,n,a[n]);if(le)for(var n of le(a))gt.call(a,n)&&ue(l,n,a[n]);return l};var O=(l,a,n)=>new Promise((i,r)=>{var u=c=>{try{d(n.next(c))}catch(w){r(w)}},v=c=>{try{d(n.throw(c))}catch(w){r(w)}},d=c=>c.done?i(c.value):Promise.resolve(c.value).then(u,v);d((n=n.apply(l,a)).next())});import{h as k,W as Pe,_ as vt,l as U,J as ft,p as $,m as bt,n as pt,q as j,I as mt,S as xt,c as y,e as B,b as t,t as de,j as K,u as p,i as N,w as ht,T as yt,F as P,d as C,v as _,x as A,o as h,B as X,K as _t,L as ce,M as ge,N as wt,C as Bt}from"./index-DSYnFDpC.js";import{u as Ct,C as St,a as kt,b as Tt,R as ve,c as fe,T as Et}from"./yearSettingsStore-BCg8jws5.js";import{c as W,_ as Pt,E as At,T as Mt,a as Dt,P as Vt,X as jt,S as Lt,B as Ft,F as z,b as be,e as Rt}from"./alertService-y5V6STep.js";import{g as qt}from"./index-BIXvTuUj.js";import"./advanced_settings-hmArpyU9.js";import{l as It}from"./data_service-U0RVGBq2.js";import{aj as Ae,ak as D,o as oe,q as pe,N as Nt,s as me,t as xe,u as he,v as ye,w as _e,x as we,f as $t,B as Yt,ac as Ot,ad as Be,ah as Ce,ai as Ut}from"./LoadingState.vue_vue_type_style_index_0_scoped_3ea85f6c_lang-B8kQ29WF.js";import{u as Ht}from"./useCalculationCache-Bp6wAm8x.js";import{P as Jt,p as x,f as G,a as L,t as Kt}from"./payroll_data_service-ByN0VmkP.js";import{h as Wt,g as zt,a as Qt,c as Xt,d as Gt,D as Zt,F as eo,j as to,k as oo,l as ao,m as so,p as no,q as ro,t as lo,u as uo,x as io,z as co}from"./payroll_data_utils-B75nlPpu.js";import{c as Q}from"./cloneDeep-c7fjsde5.js";import{L as go}from"./loader-circle-DJhqmGNZ.js";import{C as vo}from"./chart-column-DM6PNj88.js";import{U as fo}from"./users-Dkp9bKfO.js";import"./createLucideIcon-D_T9sLlP.js";class bo extends Jt{constructor(){super(),this.bonusFields={bonus:{payroll_unique_id:null,fields:["bonus_percentage"]}},this.bonusValidationRules={required:["payroll_unique_id"],numeric:["bonus_percentage"],minValues:{bonus_percentage:0},maxValues:{bonus_percentage:100}}}transformBonusApiToFrontend(a,n,i=null,r=null){try{if(!a||!a.message)throw new Error("Invalid bonus API response structure");const u={};return Object.keys(a.message).forEach(v=>{if(i&&r){const c=parseInt(v),w=parseInt(i),T=parseInt(r);if(c<w||c>T)return}u[v]||(u[v]={});const d=a.message[v];d&&d.bonus&&Object.keys(d.bonus).forEach(c=>{const w=d.bonus[c];u[v][c]={bonusPercentage:w.bonus_percentage||0,payroll_unique_id:c}})}),{bonusData:u,projectName:n,totalBonusEntries:Object.keys(u).reduce((v,d)=>v+Object.keys(u[d]).length,0)}}catch(u){throw console.error("Error transforming bonus API to frontend:",u),new Error(`Failed to transform bonus API data: ${u.message}`)}}transformBonusFrontendToApi(a,n){try{if(!n)throw new Error("Project name is required");return{changes:a.map(r=>({year:r.year,bonus:Object.keys(r.bonus).reduce((u,v)=>(u[v]={bonus_percentage:parseFloat(r.bonus[v].bonus_percentage)||0},u),{})})),project:n}}catch(i){throw console.error("Error transforming bonus frontend to API:",i),new Error(`Failed to transform bonus frontend data: ${i.message}`)}}transformBonusItem(a,n){try{return a.payroll_unique_id?{id:a.unique_id||`bonus_${a.payroll_unique_id}_${n}`,payroll_unique_id:a.payroll_unique_id,year:n,unique_id:a.unique_id,bonusPercentage:a.bonus_percentage||0}:(console.warn("Bonus item missing payroll_unique_id:",a),null)}catch(i){return console.error("Error transforming bonus item:",i,a),null}}transformBonusRowToApiFormat(a,n,i){try{const r={payroll_unique_id:a.payroll_unique_id,year:n,bonus_percentage:parseFloat(a.bonusPercentage)||0};return a.unique_id&&(r.unique_id=a.unique_id),r}catch(r){return console.error("Error transforming bonus row to API format:",r,a),null}}validateBonusData(a,n="frontend"){const i=[],r=[];try{return n==="frontend"?this.validateBonusFrontendData(a,i,r):this.validateBonusApiData(a,i,r)}catch(u){return i.push(`Bonus validation error: ${u.message}`),{isValid:!1,errors:i,warnings:r}}}validateBonusFrontendData(a,n,i){return!a||typeof a!="object"?(n.push("Bonus data must be an object"),{isValid:!1,errors:n,warnings:i}):(Object.keys(a).forEach(r=>{if(!a[r]||typeof a[r]!="object"){n.push(`Year ${r}: Bonus data must be an object`);return}Object.keys(a[r]).forEach(u=>{const v=a[r][u];v.payroll_unique_id||n.push(`Row ${u}: payroll_unique_id is required`);const d=parseFloat(v.bonusPercentage);(isNaN(d)||d<0)&&n.push(`Row ${u}: bonus_percentage must be a positive number`),d>100&&n.push(`Row ${u}: bonus_percentage cannot exceed 100%`)})}),{isValid:n.length===0,errors:n,warnings:i})}validateBonusApiData(a,n,i){return a.message?(Object.keys(a.message).forEach(r=>{const u=a.message[r];if(!u||!u.bonus||typeof u.bonus!="object"){n.push(`Year ${r}: Bonus data must be an object with 'bonus' property`);return}Object.keys(u.bonus).forEach(v=>{const d=u.bonus[v];if(!d||typeof d!="object"){n.push(`Year ${r}, Row ${v}: Invalid bonus item structure`);return}isNaN(parseFloat(d.bonus_percentage))&&n.push(`Year ${r}, Row ${v}: Invalid bonus_percentage value`),parseFloat(d.bonus_percentage)>100&&n.push(`Year ${r}, Row ${v}: bonus_percentage cannot exceed 100%`)})}),{isValid:n.length===0,errors:n,warnings:i}):(n.push("Bonus API response must contain message property"),{isValid:!1,errors:n,warnings:i})}createDefaultBonusRow(a=null){const n={id:this.generateRowId(),year:new Date().getFullYear().toString(),bonusPercentage:0};return a&&(n.payroll_unique_id=a.unique_id),n}getBonusFieldDefinitions(){return this.bonusFields}getBonusValidationRules(){return this.bonusValidationRules}}const Me=new bo,M=k({}),H=k([]),Se=k(!1),ke=k("");function Z(l,a=null,n=null){return O(this,null,function*(){try{const i=new URLSearchParams;l&&i.append("project",l),a&&i.append("fromYear",a.toString()),n&&i.append("toYear",n.toString());const r=`/api/v2/method/ex_forcast.api.call_and_save_bonus_data.bonus_data_display?${i.toString()}`,u=yield Pe(r);if(u.error)throw new Error(u.error);const v=u.data||u,d=Me.transformBonusApiToFrontend({message:v},l,a,n);return M.value=d.bonusData||{},d}catch(i){throw console.error("Error fetching bonus data:",i),new Error(`Failed to fetch bonus data: ${i.message}`)}})}function po(l,a){return O(this,null,function*(){try{Se.value=!0,ke.value="";const n=Me.transformBonusFrontendToApi(l,a),r=yield Pe("/api/v2/method/ex_forcast.api.call_and_save_bonus_data.upsert_bonus_data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({changes:n.changes,project:a})});if(r.success===!1)throw new Error(r.error||"Failed to save bonus data");return H.value=[],r}catch(n){throw console.error("Error saving bonus changes:",n),ke.value=n.message,n}finally{Se.value=!1}})}function Te(l,a,n,i){H.value=H.value.filter(r=>!(r.rowId===l&&r.fieldType===a&&r.year===n)),H.value.push({rowId:l,fieldType:a,year:n,newValue:i,timestamp:Date.now()})}function Ee(){return H.value.length>0}function ae(){H.value=[]}function mo(){const l={};return H.value.forEach(a=>{l[a.year]||(l[a.year]={}),l[a.year][a.rowId]||(l[a.year][a.rowId]={}),a.fieldType==="bonus_percentage"&&(l[a.year][a.rowId].bonus_percentage=a.newValue)}),Object.keys(l).map(a=>({year:a,bonus:l[a]}))}function F(l,a){if(!M.value[a]||!M.value[a][l.id])return"0.00";const n=M.value[a][l.id].bonusPercentage||0;return Ae(n)}function xo(l,a,n,i){const r=F(l,n).replace(/[^\d.-]/g,"")/100,u=i(l.id,"count",n,a),v=l.salary||0,d=(u||0)*v*r;return D(d)}function ho(l,a,n,i){let r=0;const u=F(l,a).replace(/[^\d.-]/g,"")/100,v=l.salary||0;return n.forEach(d=>{const c=i(l.id,"count",a,d);r+=(c||0)*v*u}),D(r)}function yo(l,a,n,i,r,u){const v=l.filter(c=>c.position==="Manager");let d=0;return v.forEach(c=>{const w=F(c,r).replace(/[^\d.-]/g,"")/100,T=u(c.id,"count",r,i),R=c.salary||0;d+=(T||0)*R*w}),D(d)}function _o(l,a,n,i,r,u){const v=l.filter(c=>c.position==="Manager");let d=0;return v.forEach(c=>{const w=F(c,i).replace(/[^\d.-]/g,"")/100,T=c.salary||0;r.forEach(R=>{const V=u(c.id,"count",i,R);d+=(V||0)*T*w})}),D(d)}function wo(l,a,n,i,r,u){const v=l.filter(c=>c.position!=="Manager");let d=0;return v.forEach(c=>{const w=F(c,r).replace(/[^\d.-]/g,"")/100,T=u(c.id,"count",r,i),R=c.salary||0;d+=(T||0)*R*w}),D(d)}function Bo(l,a,n,i,r,u){const v=l.filter(c=>c.position!=="Manager");let d=0;return v.forEach(c=>{const w=F(c,i).replace(/[^\d.-]/g,"")/100,T=c.salary||0;r.forEach(R=>{const V=u(c.id,"count",i,R);d+=(V||0)*T*w})}),D(d)}function Co(l,a,n,i,r,u){let v=0;return l.forEach(d=>{const c=F(d,r).replace(/[^\d.-]/g,"")/100,w=u(d.id,"count",r,i),T=d.salary||0;v+=(w||0)*T*c}),D(v)}function So(l,a,n,i,r,u){let v=0;return l.forEach(d=>{const c=F(d,i).replace(/[^\d.-]/g,"")/100,w=d.salary||0;r.forEach(T=>{const R=u(d.id,"count",i,T);v+=(R||0)*w*c})}),D(v)}function ko(l,a,n,i){if(!l||!Array.isArray(l)||l.length===0)return D(0);let r=0;return l.forEach(u=>{const v=F(u,n).replace(/[^\d.-]/g,"")/100,d=i(u.id,"count",n,a),c=u.salary||0;r+=(d||0)*c*v}),D(r)}function To(l,a,n,i){if(!l||!Array.isArray(l)||l.length===0)return D(0);let r=0;return l.forEach(u=>{const v=F(u,a).replace(/[^\d.-]/g,"")/100,d=u.salary||0;n.forEach(c=>{const w=i(u.id,"count",a,c);r+=(w||0)*d*v})}),D(r)}function Eo(l,a,n,i,r){if(!l||!Array.isArray(l)||l.length===0||!a)return D(0);let u=0;return l.forEach(v=>{const d=F(v,i).replace(/[^\d.-]/g,"")/100,c=r(v.id,"count",i,n),w=v.salary||0;u+=(c||0)*w*d}),D(u/a)}function Po(l,a,n,i,r){if(!l||!Array.isArray(l)||l.length===0||!a)return D(0);let u=0;return l.forEach(v=>{const d=F(v,n).replace(/[^\d.-]/g,"")/100,c=v.salary||0;i.forEach(w=>{const T=r(v.id,"count",n,w);u+=(T||0)*c*d})}),D(u/a)}const Ao={class:"flex"},Mo={class:"flex-1 min-h-screen bg-gradient-to-br from-white to-violet-50"},Do={class:"flex"},Vo={key:2,class:"text-violet-700 text-sm font-medium"},jo={class:"mb-8"},Lo={class:"flex items-center gap-3 mb-2"},Fo={class:"w-12 h-12 bg-gradient-to-br from-violet-500 to-violet-600 rounded-xl flex items-center justify-center shadow-lg"},Ro={class:"bg-white rounded-xl p-4 mb-6 border border-gray-200 shadow-sm"},qo={class:"flex items-center justify-between"},Io={class:"flex items-center gap-2"},No={key:0,class:"flex items-center gap-2 text-sm font-medium text-red-600 bg-red-50 px-3 py-2 rounded-lg border border-red-200"},$o={key:1,class:"flex items-center gap-2 text-sm font-medium text-green-600 bg-green-50 px-3 py-2 rounded-lg border border-green-200"},Yo=["disabled"],Oo={key:1,class:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg cursor-not-allowed"},Uo={key:0,class:"mt-2 text-xs text-red-500 flex items-center gap-1"},Ho={class:"mb-8"},Jo={class:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2"},Ko={class:"flex gap-2 mt-3"},Wo={class:"flex-1"},zo={class:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm"},Qo={class:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"},Xo={class:"space-y-4"},Go={class:"grid grid-cols-2 gap-3"},Zo={class:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-1"},ea=["value"],ta={class:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-1"},oa=["value"],aa={class:"flex gap-2"},sa={class:"mt-4"},na={class:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm"},ra={class:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"},la={class:"space-y-3"},ua={class:"relative"},ia={class:"bg-gray-50 rounded-lg p-4 border border-gray-100"},da={class:"text-xs text-gray-500 mt-2 text-center"},ca={class:"flex-1 p-4"},ga={class:"mb-4"},va={class:"flex items-center gap-2"},fa={class:"w-6 h-6 bg-gradient-to-br from-violet-500 to-violet-600 rounded-lg flex items-center justify-center"},ba={key:1,class:"bg-white rounded-lg border border-violet-200 shadow-sm overflow-hidden md:max-w-[1800px] lg:max-w-[1800px] xl:max-w-[2000px] 2xl:max-w-[2000px]"},pa={class:"overflow-x-auto max-w-[100%] md:max-w-[1800px] lg:max-w-[1800px] xl:max-w-[2000px] 2xl:max-w-[2000px]"},ma={class:"min-w-full w-max"},xa={class:"w-full"},ha={class:"bg-gradient-to-r from-violet-600 to-violet-700 text-white"},ya={rowspan:"3",class:"px-3 py-2 text-left align-middle border-r border-violet-400 font-semibold text-sm"},_a={class:"flex items-center gap-1"},wa={rowspan:"3",class:"px-3 py-2 text-left align-middle border-r border-violet-400 font-semibold text-sm"},Ba={class:"flex items-center gap-1"},Ca={rowspan:"3",class:"px-3 py-2 text-center align-middle border-r border-violet-400 font-semibold text-sm"},Sa={class:"flex items-center gap-1"},ka={rowspan:"3",class:"px-3 py-2 text-center align-middle border-r border-violet-400 font-semibold text-sm"},Ta={class:"flex items-center gap-1"},Ea={rowspan:"3",class:"px-3 py-2 text-center align-middle border-r border-violet-400 font-semibold text-sm"},Pa={class:"flex items-center gap-1"},Aa={key:0,colspan:"12",class:"px-2 py-2 text-center border-x-2 border-white font-semibold text-sm"},Ma={class:"flex items-center justify-center gap-1"},Da={class:"font-semibold"},Va={class:"bg-violet-500/90 text-xs"},ja={key:0,colspan:"12",class:"px-2 py-1 text-center border border-violet-300 font-medium"},La={class:"bg-violet-400/90 text-xs"},Fa={class:"text-gray-700 bg-white text-sm"},Ra={class:"bg-violet-100 border-b-2 border-violet-300"},qa=["colspan"],Ia={class:"bg-violet-50 border-b border-violet-200"},Na=["colspan"],$a={class:"px-3 py-2 font-medium border-r border-violet-200 text-gray-700"},Ya={class:"px-3 py-2 font-medium border-r border-violet-200 text-gray-700"},Oa={class:"px-3 py-2 text-right border-r border-violet-200 font-mono text-sm"},Ua=["onInput","onFocus","onBlur"],Ha={class:"font-mono text-xs text-violet-700"},Ja={class:"font-mono text-xs"},Ka={class:"font-mono text-xs text-orange-700"},Wa={class:"font-mono text-xs text-orange-700"},za={class:"border-b border-gray-300 bg-gradient-to-r from-violet-100 to-purple-100 shadow-sm"},Qa={colspan:3,class:"px-3 py-2.5 font-semibold border-r border-violet-300 text-violet-900"},Xa={class:"flex items-center gap-2"},Ga={class:"px-3 py-2.5 text-right border-r border-violet-300"},Za={class:"font-mono text-sm font-semibold text-violet-900"},es={class:"font-mono text-xs text-violet-900"},ts={class:"font-mono text-xs text-orange-900"},os={class:"px-2 py-1.5 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-semibold"},as={class:"font-mono text-xs text-orange-900"},ss={class:"border-b border-gray-300 bg-gradient-to-r from-violet-100 to-purple-100 shadow-sm"},ns={colspan:3,class:"px-3 py-2.5 font-semibold border-r border-violet-300 text-violet-900"},rs={class:"flex items-center gap-2"},ls={class:"px-3 py-2.5 text-right border-r border-violet-300"},us={class:"font-mono text-sm font-semibold text-violet-900"},is={class:"font-mono text-xs text-violet-900"},ds={class:"font-mono text-xs text-orange-900"},cs={class:"px-2 py-1.5 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-semibold"},gs={class:"font-mono text-xs text-orange-900"},vs={class:"border-b-2 border-violet-400 bg-gradient-to-r from-violet-100 to-purple-100 shadow-sm"},fs={colspan:3,class:"px-3 py-3 font-bold border-r border-violet-300 text-violet-900"},bs={class:"flex items-center gap-2"},ps={class:"px-3 py-3 text-right border-r border-violet-300"},ms={class:"font-mono text-sm font-bold text-violet-900"},xs={class:"font-mono text-xs text-violet-900"},hs={class:"font-mono text-xs text-orange-900"},ys={class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},_s={class:"font-mono text-xs text-orange-900"},ws={class:"border-b-2 border-violet-400 bg-gradient-to-r from-violet-100 to-indigo-100 shadow-sm"},Bs={colspan:3,class:"px-3 py-3 font-bold border-r border-violet-300 text-violet-900"},Cs={class:"flex items-center gap-2"},Ss={class:"px-3 py-3 text-right border-r border-violet-300"},ks={class:"font-mono text-sm font-bold text-violet-900"},Ts={class:"font-mono text-xs text-violet-900"},Es={class:"font-mono text-xs text-orange-900"},Ps={class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},As={class:"font-mono text-xs text-orange-900"},Ms={class:"border-b-2 border-green-400 bg-gradient-to-r from-green-100 to-emerald-100 shadow-sm"},Ds={colspan:3,class:"px-3 py-3 font-bold border-r border-green-300 text-green-900"},Vs={class:"flex items-center gap-2"},js={class:"px-3 py-3 text-right border-r border-green-300"},Ls={class:"font-mono text-sm font-bold text-green-900"},Fs={class:"font-mono text-xs text-green-900"},Rs={class:"font-mono text-xs text-orange-900"},qs={class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},Is={class:"font-mono text-xs text-orange-900"},Ns={__name:"Bonus",setup(l){const a=k([]),n=k("monthly"),i=k(!1),r=k({}),u=k(!1),v=k({}),d=k([]),c=k(!1),w=k(""),T=k(!1),R=k(!1);k(""),k(""),k(""),k(!1),k(!1),k(!1),k(!1);const V=k(0),ee=U(()=>pe(V.value)),S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Ht();const te=Ct(),{fromYear:q,toYear:I,advancedModes:se}=ft(te),{setFromYear:$s,setToYear:Ys,setAdvancedModes:Os,clearYearSettings:Us,getFilteredToYears:De}=te,b=U(()=>qt(q.value,I.value)),Ve=U(()=>De(a.value)),je=U(()=>Wt(x.value)),ne=U(()=>d.value.length>0||Ee());U(()=>{if(!b.value.length||!x.value.length)return 0;const s=b.value[0];let e=0;return x.value.forEach(o=>{S.forEach(f=>{const g=E(o.id,"count",s,f);e+=g||0})}),e}),U(()=>{if(!b.value.length||!x.value.length)return 0;const s=b.value[0];let e=0;return x.value.forEach(o=>{S.forEach(f=>{const g=E(o.id,"count",s,f),m=o.salary||0;e+=(g||0)*m})}),e}),$(b,()=>{b.value.forEach(s=>{se.value[s]||te.setAdvancedMode(s,n.value)}),window.__currentVisibleYears=b.value}),$(L,(s,e)=>{},{deep:!0,immediate:!0}),$(M,(s,e)=>{window.__bonusData=s},{deep:!0,immediate:!0}),$(x,(s,e)=>{if(!s||!Array.isArray(s)){x.value=[];return}s&&e&&s.forEach((o,f)=>{const g=e[f];if(g&&(o.salary!==g.salary||o.count!==g.count)&&b.value.length>0){const m=b.value[0];L.value[m]||(L.value[m]={}),L.value[m][o.id]||(L.value[m][o.id]={}),Ot(o.id,m,L),Be(o.id,m,L),L.value[m][o.id]._lastUpdate=Date.now(),o.salary!==g.salary&&S.forEach(J=>{const it=(E(o.id,"count",m,J)||0)*(o.salary||0);Be(o.id,m,L),L.value[m][o.id].salary[J]=it})}})},{deep:!0}),$(i,s=>{s&&(r.value=ie({},se.value))}),bt(()=>O(this,null,function*(){try{yield pt(),yield new Promise(e=>setTimeout(e,100)),a.value=yield It(),(!x.value||!Array.isArray(x.value))&&(x.value=[]),j.value&&(yield G(j.value.project_name,q.value,I.value),yield Z(j.value.project_name,q.value,I.value),window.__currentVisibleYears=b.value,window.__bonusData=M.value),v.value=Q(x.value),u.value=!0,R.value=!0;const s=localStorage.getItem("totalRooms");s&&(V.value=parseInt(s)||100),localStorage.getItem("showRefreshSuccess")==="true"&&(localStorage.removeItem("showRefreshSuccess"),W.success("Page refreshed successfully"))}catch(s){console.error("Error loading data:",s)}})),$(j,(s,e)=>O(this,null,function*(){if(s)try{yield G(s.project_name,q.value,I.value),v.value=Q(x.value),yield Z(s.project_name,q.value,I.value),window.__currentVisibleYears=b.value,window.__bonusData=M.value,d.value=[],ae(),u.value=!0,w.value="",W.success(`Switched to project: ${s.project_name}`)}catch(o){console.error("Error reloading Payroll data for new project:",o),W.error("Failed to load project data. Please try again.")}else x.value=[],v.value=Q(x.value),d.value=[],ae(),u.value=!0,w.value=""}),{deep:!0}),$([q,I],(g,m)=>O(this,[g,m],function*([s,e],[o,f]){if(j.value&&s&&e&&(s!==o||e!==f))try{yield G(j.value.project_name,s,e),yield Z(j.value.project_name,s,e),v.value=Q(x.value),window.__currentVisibleYears=b.value,window.__bonusData=M.value,d.value=[],u.value=!0,w.value=""}catch(J){console.error("Error reloading Payroll data for new year range:",J),W.error("Failed to load data for selected year range. Please try again.")}}),{deep:!0});const Le=()=>O(this,null,function*(){var s,e,o,f;try{c.value=!0,w.value="";let g=!1;if(d.value.length>0){const m=yield Kt(d.value,(s=j.value)==null?void 0:s.project_name);d.value=[],g=!0}if(Ee()){const m=mo();yield po(m,(e=j.value)==null?void 0:e.project_name),ae(),g=!0}if(!g){c.value=!1;return}yield G((o=j.value)==null?void 0:o.project_name,q.value,I.value),yield Z((f=j.value)==null?void 0:f.project_name,q.value,I.value),v.value=Q(x.value),window.__currentVisibleYears=b.value,window.__bonusData=M.value,u.value=!0,W.success("Changes saved successfully"),c.value=!1}catch(g){w.value=g.message||"Failed to save changes",W.error(w.value),c.value=!1}});$(u,s=>{s?window.removeEventListener("beforeunload",oe):window.addEventListener("beforeunload",oe)}),mt(()=>{window.removeEventListener("beforeunload",oe)}),$(V,s=>{localStorage.setItem("totalRooms",s.toString())}),setInterval(()=>{const s=localStorage.getItem(xt("totalNumberOfRooms"));if(s&&parseInt(s)>0){const e=parseInt(s);e!==V.value&&pe.value&&(V.value=e,localStorage.setItem("totalRooms",e.toString()))}},1e3);function E(s,e,o,f){if(e==="count"&&f)return me(s,o,f,x,L);if(e==="salary"&&f){const g=me(s,o,f,x,L),m=x.value.find(J=>J.id===s);return m?(g||0)*(m.salary||0):0}return zt(x.value,L,s,e,o,f)}function Fe(){return Qt(x.value)}function Re(s){return to(x.value,s)}function Y(s,e){return oo(x.value,s,e)}function qe(s,e){return ao(x.value,s,e)}function Ie(s,e,o,f){return so(x.value,s,e,o,f,E)}function Ne(s,e){return no(x.value,s,e)}function $e(s,e,o,f){return ro(x.value,s,e,o,f,E)}function Ye(s,e){return lo(x.value,s,e)}function Oe(s,e,o,f){return uo(x.value,s,e,o,f,E)}function Ue(){return!x.value||!Array.isArray(x.value)?0:Xt(x.value)}function He(s,e){return!x.value||!Array.isArray(x.value)?0:io(x.value,s,e,E)}function Je(){return!x.value||!Array.isArray(x.value)?0:Gt(x.value,V.value)}function Ke(s,e){return!x.value||!Array.isArray(x.value)?0:co(x.value,s,e,E,V.value)}function re(s){return F(s,b.value[0])}function We(s,e){return xo(s,e,b.value[0],E)}function ze(s,e,o,f){const g=parseFloat(e.target.textContent.replace(/[^\d.-]/g,""))||0,m=f[0];M.value[m]||(M.value[m]={}),M.value[m][s.id]||(M.value[m][s.id]={}),M.value[m][s.id].bonusPercentage=g,Te(s.id,"bonus_percentage",m,g)}function Qe(s,e){e.target.textContent=re(s).replace(/[^\d.-]/g,"")}function Xe(s,e,o,f){const g=parseFloat(e.target.textContent.replace(/[^\d.-]/g,""))||0;e.target.textContent=Ae(g);const m=f[0];M.value[m]||(M.value[m]={}),M.value[m][s.id]||(M.value[m][s.id]={}),M.value[m][s.id].bonusPercentage=g,Te(s.id,"bonus_percentage",m,g)}function Ge(s){return ho(s,b.value[0],S,E)}function Ze(s,e,o,f){return yo(s,e,o,f,b.value[0],E)}function et(s,e,o){return _o(s,e,o,b.value[0],S,E)}function tt(s,e,o,f){return wo(s,e,o,f,b.value[0],E)}function ot(s,e,o){return Bo(s,e,o,b.value[0],S,E)}function at(s,e,o,f){return Co(s,e,o,f,b.value[0],E)}function st(s,e,o){return So(s,e,o,b.value[0],S,E)}function nt(s){return ko(x.value,s,b.value[0],E)}function rt(){return To(x.value,b.value[0],S,E)}function lt(s,e,o){return Eo(s,e,o,b.value[0],E)}function ut(s,e){return Po(s,e,b.value[0],S,E)}return(s,e)=>(h(),y("div",Ao,[B(Pt),t("div",Mo,[t("div",Do,[t("div",{class:de(["bg-gradient-to-b from-white to-gray-50 border-r border-gray-200 min-h-screen flex flex-col shadow-sm transition-all duration-300",T.value?"w-14 p-2":"w-80 p-6"])},[t("button",{onClick:e[0]||(e[0]=o=>T.value=!T.value),class:"mb-4 flex items-center gap-2 px-2 py-1 bg-violet-100 hover:bg-violet-200 rounded transition-all"},[T.value?(h(),K(p(kt),{key:1,class:"w-5 h-5 text-violet-700"})):(h(),K(p(St),{key:0,class:"w-5 h-5 text-violet-700"})),T.value?N("",!0):(h(),y("span",Vo,"Collapse"))]),B(yt,{name:"fade"},{default:ht(()=>[X(t("div",null,[t("div",jo,[t("div",Lo,[t("div",Fo,[B(p(At),{class:"w-7 h-7 mx-2 text-white"})]),e[12]||(e[12]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Bonus",-1))]),e[13]||(e[13]=t("p",{class:"text-sm text-gray-500"},"Manage and configure your bonus data",-1))]),t("div",Ro,[t("div",qo,[t("div",Io,[ne.value?(h(),y("div",No,[B(p(Mt),{class:"w-4 h-4 text-red-600"}),e[14]||(e[14]=C(" Unsaved "))])):(h(),y("div",$o,[B(p(Dt),{class:"w-4 h-4 text-green-600"}),e[15]||(e[15]=C(" All Saved "))]))]),!c.value&&ne.value?(h(),y("button",{key:0,disabled:c.value,onClick:Le,class:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-600 to-violet-700 text-white rounded-lg hover:from-violet-700 hover:to-violet-800 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105"},[B(p(Zt),{class:"w-4 h-4"}),e[16]||(e[16]=C(" Save "))],8,Yo)):N("",!0),c.value?(h(),y("button",Oo,[B(p(go),{class:"w-4 h-4 animate-spin"}),e[17]||(e[17]=C(" Saving... "))])):N("",!0)]),w.value?(h(),y("span",Uo,[B(p(Tt),{class:"w-3 h-3"}),C(" "+_(w.value),1)])):N("",!0)]),t("div",Ho,[t("h3",Jo,[B(p(Vt),{class:"w-4 h-4 text-violet-600"}),e[18]||(e[18]=C(" Quick Actions "))]),t("div",Ko,[t("button",{onClick:e[1]||(e[1]=(...o)=>p(xe)&&p(xe)(...o)),class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-violet-200 text-violet-700 rounded-lg hover:bg-violet-50 transition-all text-sm font-medium"},[B(p(ve),{class:"w-4 h-4"}),e[19]||(e[19]=C(" Refresh "))])])]),t("div",Wo,[t("div",zo,[t("h3",Qo,[B(p(eo),{class:"w-5 h-5 text-violet-600"}),e[20]||(e[20]=C(" Year Range Filter "))]),t("div",Xo,[t("div",Go,[t("div",null,[t("label",Zo,[B(p(fe),{class:"w-3 h-3 text-gray-500"}),e[21]||(e[21]=C(" From Year "))]),X(t("select",{disabled:"","onUpdate:modelValue":e[2]||(e[2]=o=>ce(q)?q.value=o:null),class:"w-full px-3 py-2.5 rounded-lg border border-gray-300 focus:border-violet-500 focus:ring-2 focus:ring-violet-200 transition-all bg-gray-100 text-sm"},[e[22]||(e[22]=t("option",{value:""},"Select Year",-1)),(h(!0),y(P,null,A(a.value,o=>(h(),y("option",{key:"from-"+o,value:o},_(o),9,ea))),128))],512),[[ge,p(q)]])]),t("div",null,[t("label",ta,[B(p(fe),{class:"w-3 h-3 text-gray-500"}),e[23]||(e[23]=C(" To Year "))]),X(t("select",{disabled:"","onUpdate:modelValue":e[3]||(e[3]=o=>ce(I)?I.value=o:null),class:"w-full px-3 py-2.5 rounded-lg border border-gray-300 focus:border-violet-500 focus:ring-2 focus:ring-violet-200 transition-all bg-gray-100 text-sm"},[e[24]||(e[24]=t("option",{value:""},"Select Year",-1)),(h(!0),y(P,null,A(Ve.value,o=>(h(),y("option",{key:"to-"+o,value:o},_(o),9,oa))),128))],512),[[ge,p(I)]])])]),t("div",aa,[t("button",{onClick:e[4]||(e[4]=(...o)=>p(he)&&p(he)(...o)),class:"flex-1 flex items-center justify-center gap-2 px-3 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200 text-sm font-medium"},[B(p(jt),{class:"w-4 h-4"}),e[25]||(e[25]=C(" Clear "))]),t("button",{disabled:"",onClick:e[5]||(e[5]=o=>i.value=!0),class:"flex-1 flex items-center justify-center gap-2 px-3 py-2.5 bg-gray-200 border border-violet-500 text-violet-700 rounded-lg hover:bg-violet-50 transition-all duration-200 text-sm font-medium"},[B(p(Lt),{class:"w-4 h-4"}),e[26]||(e[26]=C(" Advanced "))])])])]),t("div",sa,[t("div",na,[t("h3",ra,[B(p(Ft),{class:"w-5 h-5 text-violet-600"}),e[27]||(e[27]=C(" Total Number of Rooms "))]),t("div",la,[t("div",null,[t("div",ua,[X(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>V.value=o),type:"number",disabled:"",min:"1",class:"w-full px-4 py-3 rounded-lg border bg-gray-100 border-gray-300 focus:border-violet-500 focus:ring-2 focus:ring-violet-200 transition-all text-lg font-semibold text-gray-900 rooms-input",placeholder:"Enter total number of rooms",onInput:e[7]||(e[7]=(...o)=>p(ye)&&p(ye)(...o)),onBlur:e[8]||(e[8]=(...o)=>p(_e)&&p(_e)(...o)),onKeyup:e[9]||(e[9]=wt(o=>o.target.blur(),["enter"]))},null,544),[[Bt,V.value]]),e[28]||(e[28]=t("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3"},[t("span",{class:"text-gray-400 text-sm mr-8 font-medium"},"rooms")],-1))])]),t("div",ia,[t("button",{onClick:e[10]||(e[10]=(...o)=>p(we)&&p(we)(...o)),class:de(["w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg transition-all duration-200 text-sm font-medium shadow-sm",ee.value?"bg-green-500 hover:bg-green-600 text-white shadow-green-200":"bg-violet-500 hover:bg-violet-600 text-white shadow-violet-200"])},[B(p(ve),{class:"w-4 h-4"}),C(" "+_(ee.value?"Synced":"Unsynced"),1)],2),t("p",da,_(ee.value?"Your total rooms are synchronized with the Room Revenue page":"Click to sync with the total rooms from Room Revenue page"),1)])])])])])],512),[[_t,!T.value]])]),_:1})],2),t("div",ca,[p(j)?b.value.length&&R.value?(h(),y(P,{key:1},[t("div",ga,[t("div",va,[t("div",fa,[B(p(Et),{class:"w-3 h-3 text-white"})]),e[29]||(e[29]=t("h2",{class:"text-lg font-bold text-gray-800"},"Bonus Overview",-1))])]),je.value?(h(),y("div",ba,[t("div",pa,[t("div",ma,[t("table",xa,[t("thead",ha,[t("tr",null,[t("th",ya,[t("div",_a,[B(p(z),{class:"w-3 h-3"}),e[30]||(e[30]=C(" Position "))])]),t("th",wa,[t("div",Ba,[B(p(z),{class:"w-3 h-3"}),e[31]||(e[31]=C(" Designation "))])]),t("th",Ca,[t("div",Sa,[B(p(z),{class:"w-3 h-3"}),e[32]||(e[32]=C(" Salary "))])]),t("th",ka,[t("div",Ta,[B(p(z),{class:"w-3 h-3"}),e[33]||(e[33]=C(" Count "))])]),t("th",Ea,[t("div",Pa,[B(p(z),{class:"w-3 h-3"}),e[34]||(e[34]=C(" Bonus % "))])]),b.value.length>0?(h(),y("th",Aa,[t("div",Ma,[t("span",Da,_(b.value[0]),1)])])):N("",!0),e[35]||(e[35]=t("th",{colspan:13,rowspan:2,class:"px-2 py-1 text-center border border-orange-300 font-medium bg-orange-500/90"}," Bonus Details ",-1))]),t("tr",Va,[b.value.length>0?(h(),y("th",ja," Monthly Count ")):N("",!0)]),t("tr",La,[(h(),y(P,null,A(S,o=>t("th",{key:"count-"+o,class:"px-2 py-1 text-center border border-violet-300 min-w-[80px] font-medium"},_(o),1)),64)),(h(),y(P,null,A(S,o=>t("th",{key:"bonus-"+o,class:"px-2 py-1 text-center border border-orange-300 min-w-[80px] font-medium bg-orange-400/90"},_(o),1)),64)),e[36]||(e[36]=t("th",{class:"px-2 py-1 text-center border border-orange-300 min-w-[80px] font-medium bg-orange-400/90"}," Total ",-1))])]),t("tbody",Fa,[(h(!0),y(P,null,A(Fe(),o=>(h(),y(P,{key:o},[t("tr",Ra,[t("td",{colspan:5+(b.value.length>0?25:0)+(b.value.length>1?b.value.length-1:0)+13,class:"px-3 py-2 font-bold text-violet-800 text-left"},_(o),9,qa)]),(h(!0),y(P,null,A(Re(o),f=>(h(),y(P,{key:"location-"+f},[t("tr",Ia,[t("td",{colspan:5+(b.value.length>0?25:0)+(b.value.length>1?b.value.length-1:0)+13,class:"px-3 py-1.5 font-semibold text-violet-700 text-left text-sm"},_(f),9,Na)]),(h(!0),y(P,null,A(Y(o,f),g=>(h(),y("tr",{key:g.id,class:"border-b border-gray-200 hover:bg-violet-50 transition-all duration-200"},[t("td",$a,_(g.position),1),t("td",Ya,_(g.designation),1),(h(),y("td",{class:"px-3 py-2 text-right border-r border-violet-200 font-mono text-sm",key:g.id+"-salary"},_(p($t)(g.salary)),1)),t("td",Oa,_(g.count),1),(h(),y("td",{class:"px-3 py-2 text-right border-r border-violet-200 font-mono text-sm",contenteditable:"true",key:g.id+"-bonus-percentage",onInput:m=>ze(g,m,u.value,b.value),onFocus:m=>Qe(g,m),onBlur:m=>Xe(g,m,u.value,b.value),onKeypress:e[11]||(e[11]=m=>p(Yt)(m))},[t("span",Ha,_(re(g)||"0.00")+"%",1)],40,Ua)),b.value.length>0?(h(),y(P,{key:0},A(S,m=>t("td",{key:"count-cell-"+m+"-"+(E(g.id,"count",b.value[0],m)||0),class:"px-2 py-1 text-right border border-violet-200 hover:bg-violet-50 outline-none focus:ring-2 focus:ring-violet-500 transition-all duration-200"},[t("span",Ja,_(E(g.id,"count",b.value[0],m)),1)])),64)):N("",!0),(h(),y(P,null,A(S,m=>t("td",{key:"bonus-cell-"+m+"-"+g.id,class:"px-2 py-1 text-right border border-orange-200 bg-orange-50"},[t("span",Ka,_(We(g,m)||"0.00"),1)])),64)),(h(),y("td",{class:"px-2 py-1 text-right border border-orange-200 bg-orange-50",key:g.id+"-bonus-total"},[t("span",Wa,_(Ge(g)||"0.00"),1)]))]))),128)),t("tr",za,[t("td",Qa,[t("div",Xa,[B(p(be),{class:"w-4 h-4 text-violet-700"}),e[37]||(e[37]=C(" Sub-Total Management "))])]),t("td",Ga,[t("span",Za,_(qe(o,f)),1)]),e[38]||(e[38]=t("td",{class:"px-3 py-2.5 text-right border-r border-violet-300"},[t("span",{class:"font-mono text-sm font-semibold text-violet-900"})],-1)),b.value.length>0?(h(),y(P,{key:0},A(S,g=>t("td",{key:"subtotal-mgmt-count-"+g,class:"px-2 py-1.5 text-right border border-violet-300 bg-gradient-to-r from-violet-100 to-purple-100 font-semibold"},[t("span",es,_(Ie(o,f,b.value[0],g)),1)])),64)):N("",!0),(h(),y(P,null,A(S,g=>t("td",{key:"subtotal-mgmt-bonus-"+g,class:"px-2 py-1.5 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-semibold"},[t("span",ts,_(Ze(Y(o,f),o,f,g)),1)])),64)),t("td",os,[t("span",as,_(et(Y(o,f),o,f)),1)])]),t("tr",ss,[t("td",ns,[t("div",rs,[B(p(be),{class:"w-4 h-4 text-violet-700"}),e[39]||(e[39]=C(" Sub-Total Non-Management "))])]),t("td",ls,[t("span",us,_(Ne(o,f)),1)]),e[40]||(e[40]=t("td",{class:"px-3 py-2.5 text-right border-r border-violet-300"},[t("span",{class:"font-mono text-sm font-semibold text-violet-900"})],-1)),b.value.length>0?(h(),y(P,{key:0},A(S,g=>t("td",{key:"subtotal-nonmgmt-count-"+g,class:"px-2 py-1.5 text-right border border-violet-300 bg-gradient-to-r from-violet-100 to-purple-100 font-semibold"},[t("span",is,_($e(o,f,b.value[0],g)),1)])),64)):N("",!0),(h(),y(P,null,A(S,g=>t("td",{key:"subtotal-nonmgmt-bonus-"+g,class:"px-2 py-1.5 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-semibold"},[t("span",ds,_(tt(Y(o,f),o,f,g)),1)])),64)),t("td",cs,[t("span",gs,_(ot(Y(o,f),o,f)),1)])]),t("tr",vs,[t("td",fs,[t("div",bs,[B(p(vo),{class:"w-5 h-5 text-violet-700"}),e[41]||(e[41]=C(" Total "))])]),t("td",ps,[t("span",ms,_(Ye(o,f)),1)]),e[42]||(e[42]=t("td",{class:"px-3 py-3 text-right border-r border-violet-300"},[t("span",{class:"font-mono text-sm font-bold text-violet-900"})],-1)),b.value.length>0?(h(),y(P,{key:0},A(S,g=>t("td",{key:"total-count-"+g,class:"px-2 py-2 text-right border border-violet-300 bg-gradient-to-r from-violet-100 to-purple-100 font-bold"},[t("span",xs,_(Oe(o,f,b.value[0],g)),1)])),64)):N("",!0),(h(),y(P,null,A(S,g=>t("td",{key:"total-bonus-"+g,class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},[t("span",hs,_(at(Y(o,f),o,f,g)),1)])),64)),t("td",ys,[t("span",_s,_(st(Y(o,f),o,f)),1)])])],64))),128))],64))),128)),e[47]||(e[47]=t("tr",{class:"h-4 bg-gradient-to-r from-violet-100 to-indigo-100"},null,-1)),e[48]||(e[48]=t("tr",{class:"h-4 bg-gradient-to-r from-violet-100 to-indigo-100"},null,-1)),t("tr",ws,[t("td",Bs,[t("div",Cs,[B(p(Rt),{class:"w-5 h-5 text-violet-700"}),e[43]||(e[43]=C(" Total Hotel "))])]),t("td",Ss,[t("span",ks,_(Ue()),1)]),e[44]||(e[44]=t("td",{class:"px-3 py-3 text-right border-r border-violet-300"},[t("span",{class:"font-mono text-sm font-bold text-violet-900"})],-1)),b.value.length>0?(h(),y(P,{key:0},A(S,o=>t("td",{key:"hotel-count-"+o,class:"px-2 py-2 text-right border border-violet-300 bg-gradient-to-r from-violet-100 to-indigo-100 font-bold"},[t("span",Ts,_(He(b.value[0],o)),1)])),64)):N("",!0),(h(),y(P,null,A(S,o=>t("td",{key:"hotel-bonus-"+o,class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},[t("span",Es,_(nt(o)),1)])),64)),t("td",Ps,[t("span",As,_(rt()),1)])]),t("tr",Ms,[t("td",Ds,[t("div",Vs,[B(p(fo),{class:"w-5 h-5 text-green-700"}),e[45]||(e[45]=C(" Employee/Room Ratio "))])]),t("td",js,[t("span",Ls,_(Je()),1)]),e[46]||(e[46]=t("td",{class:"px-3 py-3 text-right border-r border-green-300"},[t("span",{class:"font-mono text-sm font-bold text-green-900"})],-1)),b.value.length>0?(h(),y(P,{key:0},A(S,o=>t("td",{key:"ratio-count-"+o,class:"px-2 py-2 text-right border border-green-300 bg-gradient-to-r from-green-100 to-emerald-100 font-bold"},[t("span",Fs,_(Ke(b.value[0],o)),1)])),64)):N("",!0),(h(),y(P,null,A(S,o=>t("td",{key:"ratio-bonus-"+o,class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},[t("span",Rs,_(lt(p(x),V.value,o)),1)])),64)),t("td",qs,[t("span",Is,_(ut(p(x),V.value)),1)])])])])])])])):(h(),K(Ut,{key:0}))],64)):p(j)?(h(),K(Nt,{key:2,"from-year":p(q),"to-year":p(I)},null,8,["from-year","to-year"])):(h(),K(Ce,{key:3})):(h(),K(Ce,{key:0}))])])])]))}},un=vt(Ns,[["__scopeId","data-v-5d9193d2"]]);export{un as default};
