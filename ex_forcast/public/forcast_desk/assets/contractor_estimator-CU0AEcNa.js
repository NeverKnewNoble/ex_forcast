var zt=Object.defineProperty;var ht=Object.getOwnPropertySymbols;var Kt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable;var yt=(w,t,e)=>t in w?zt(w,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):w[t]=e,lt=(w,t)=>{for(var e in t||(t={}))Kt.call(t,e)&&yt(w,e,t[e]);if(ht)for(var e of ht(t))Qt.call(t,e)&&yt(w,e,t[e]);return w};var x=(w,t,e)=>new Promise((n,a)=>{var c=y=>{try{f(e.next(y))}catch(i){a(i)}},p=y=>{try{f(e.throw(y))}catch(i){a(i)}},f=y=>y.done?n(y.value):Promise.resolve(y.value).then(c,p);f((e=e.apply(w,t)).next())});import{E as G,_ as bt,h as $,l as M,p as Wt,R as Yt,m as wt,c as k,i as V,o as j,b as s,e as C,u as g,t as H,d as P,B as R,N as _t,F as Q,x as Y,v as S,C as J,S as dt,j as ot,n as Zt,Z as te,G as vt,q as K,w as ee,O as oe,T as se}from"./index-ZSaFeStz.js";import{X as Ct,c as T,_ as ae,l as re,T as ne,b as le,R as ie,h as ce,e as it,d as ue}from"./SettingsModal-CkmocsMj.js";import{P as X}from"./plus-CeYa1GKE.js";import{D as de}from"./zap-C5sVj9GT.js";import{C as me,a as pe}from"./circle-alert-CRlonPQM.js";import{L as mt}from"./loader-circle-C7JmCli_.js";import{C as ge}from"./chevron-left-DEHdKNR-.js";import{F as fe}from"./folder-open-Dz0FFDMm.js";import{S as he}from"./save-DIHTh90y.js";import{R as ye}from"./rotate-ccw-CvC1aoVt.js";import{C as ve}from"./chart-column-CRvhJrkA.js";import{T as xt}from"./trash-CE4lk39x.js";import"./createLucideIcon-Diyw-P4a.js";class Z{constructor(t={}){this.id=t.id||this.generateId(),this.lineId=t.lineId||null,this.name=t.name||"",this.party=t.party||"",this.status=t.status||"Not Started",this.percentComplete=t.percentComplete||0,this.quantity=typeof t.quantity=="number"?t.quantity:1,this.unitType=t.unitType||"",this.rate=typeof t.rate=="number"?t.rate:0,this.projected=t.projected||0,this.actual=t.actual||0,this.currentPaid=t.currentPaid||0,this.comments=t.comments||"",this.variance=this.calculateVariance(),this.amountDue=this.calculateAmountDue()}generateId(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}calculateVariance(){return(this.actual||0)-(this.projected||0)}calculateAmountDue(){return(this.actual||0)-(this.currentPaid||0)}updateCalculatedFields(){this.variance=this.calculateVariance(),this.amountDue=this.calculateAmountDue()}validate(){const t=[];return this.name.trim()||t.push("Item name is required"),(this.percentComplete<0||this.percentComplete>100)&&t.push("Percent complete must be between 0 and 100"),this.currentPaid>this.actual&&t.push("Current paid cannot exceed actual amount"),t}toJSON(){return{id:this.id,lineId:this.lineId,name:this.name,party:this.party,status:this.status,percentComplete:this.percentComplete,quantity:this.quantity,unitType:this.unitType,rate:this.rate,projected:this.projected,actual:this.actual,currentPaid:this.currentPaid,comments:this.comments,variance:this.variance,amountDue:this.amountDue}}static createEmpty(t=""){return new Z({name:t})}}class tt{constructor(t={}){this.id=t.id||this.generateId(),this.name=t.name||"",this.order=t.order||0,this.items=(t.items||[]).map(e=>e instanceof Z?e:new Z(e)),this.subtotals=this.calculateSubtotals()}generateId(){return`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}calculateSubtotals(){const t={projected:0,actual:0,variance:0,currentPaid:0,amountDue:0};return this.items.forEach(e=>{e.updateCalculatedFields(),t.projected+=e.projected||0,t.actual+=e.actual||0,t.variance+=e.variance||0,t.currentPaid+=e.currentPaid||0,t.amountDue+=e.amountDue||0}),t}addItem(t={}){const e=new Z(t);return this.items.push(e),this.updateSubtotals(),e}removeItem(t){const e=this.items.findIndex(n=>n.id===t);return e>-1?(this.items.splice(e,1),this.updateSubtotals(),!0):!1}updateSubtotals(){this.subtotals=this.calculateSubtotals()}validate(){const t=[];return this.name.trim()||t.push("Category name is required"),this.items.forEach((e,n)=>{const a=e.validate();a.length>0&&t.push(`Item ${n+1}: ${a.join(", ")}`)}),t}toJSON(){const t=this.items.filter(e=>e.projected>0||e.actual>0||e.currentPaid>0||e.comments&&e.comments.trim()!==""||e.party&&e.party.trim()!==""||e.status!=="Not Started"||e.percentComplete>0);return{id:this.id,name:this.name,order:this.order,items:t.map(e=>e.toJSON()),subtotals:this.subtotals}}static createEmpty(t="",e=0){return new tt({name:t,order:e})}}class B{constructor(t={}){this.id=t.id||this.generateId(),this.projectTitle=t.projectTitle||"",this.location=t.location||"",this.project=t.project||"",this.categories=(t.categories||[]).map(e=>e instanceof tt?e:new tt(e)),this.totals=this.calculateTotals()}generateId(){return`estimator_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}calculateTotals(){const t={projected:0,actual:0,variance:0,currentPaid:0,amountDue:0};return this.categories.forEach(e=>{e.updateSubtotals(),t.projected+=e.subtotals.projected,t.actual+=e.subtotals.actual,t.variance+=e.subtotals.variance,t.currentPaid+=e.subtotals.currentPaid,t.amountDue+=e.subtotals.amountDue}),t}addCategory(t={}){const e=new tt(t);return this.categories.push(e),this.updateTotals(),e}removeCategory(t){const e=this.categories.findIndex(n=>n.id===t);return e>-1?(this.categories.splice(e,1),this.updateTotals(),!0):!1}updateTotals(){this.totals=this.calculateTotals()}validate(){const t=[];return this.projectTitle.trim()||t.push("Project title is required"),this.categories.forEach((e,n)=>{const a=e.validate();a.length>0&&t.push(`Category ${n+1} (${e.name}): ${a.join(", ")}`)}),t}toJSON(){return{id:this.id,projectTitle:this.projectTitle,location:this.location,project:this.project,categories:this.categories.map(t=>t.toJSON()),totals:this.totals}}static createEmpty(t="",e=""){return new B({projectTitle:t,location:e})}}const xe=["Not Started","In Progress","Complete","On Hold"];class be{constructor(){this.estimators=[],this.currentProject=null,this.autoLoadGLBalances=!0}testApiConnection(){return x(this,null,function*(){try{const t=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.test_connection",{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()}});if(!t.ok)throw new Error(`API connection failed: ${t.status}`);return!0}catch(t){return console.warn("Contractor Estimator API not available, using local storage:",t.message),!1}})}fetchData(t=null){return x(this,null,function*(){try{const e=yield this.createMergedEstimator("","",t);return this.estimators=[e],this.estimators}catch(e){throw console.error("Error fetching contractor estimator data:",e),e}})}getItemsByOrderOfItemGroup(){return x(this,null,function*(){try{const t=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_items_by_order_of_category",{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=yield t.json(),n=e.message||e;if(!n.success)throw new Error(n.error||"Failed to fetch items by category");return n.data}catch(t){throw console.error("Error getting items by order of category:",t),t}})}createEstimatorFromItemGroups(t="",e="",n=""){return x(this,null,function*(){try{const a=yield this.getItemsByOrderOfItemGroup(),c=new B({projectTitle:t,location:e,project:n});return Object.keys(a).forEach((p,f)=>{const y=c.addCategory({name:p,order:f+1});(a[p]||[]).forEach(d=>{if(typeof d=="string")y.addItem({name:d});else if(d&&typeof d=="object"){const E=d.item_name||d.name||"",L=d.stock_uom||"",m=typeof d.valuation_rate=="number"?d.valuation_rate:0,A=1;y.addItem({name:E,unitType:L,rate:m,quantity:A,projected:A*m})}})}),c.updateTotals(),c}catch(a){throw console.error("Error creating estimator from item groups:",a),a}})}createMergedEstimator(t="",e="",n=""){return x(this,null,function*(){try{const a=yield this.getItemsByOrderOfItemGroup();let c=null;try{const f=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_contractor_estimator_data",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({project_name:n})});if(f.ok){const y=yield f.json(),i=y.message||y;i.success&&i.data&&i.data.length>0&&(c=new B(i.data[0]))}}catch(f){console.log("No saved estimator found, using default data only")}const p=new B({projectTitle:t,location:e,project:n,id:c==null?void 0:c.id});return Object.keys(a).forEach((f,y)=>{const i=p.addCategory({name:f,order:y+1});(a[f]||[]).forEach(E=>{if(typeof E=="string")i.addItem({name:E});else if(E&&typeof E=="object"){const L=E.item_name||E.name||"",m=E.stock_uom||"",A=typeof E.valuation_rate=="number"?E.valuation_rate:0,U=1;i.addItem({name:L,unitType:m,rate:A,quantity:U,projected:U*A})}})}),p.updateTotals(),c&&(console.log("Merging saved data with default Item Groups data"),p.totals=lt({},c.totals),c.categories.forEach(f=>{const y=p.categories.find(i=>i.name===f.name);if(y)y.subtotals=lt({},f.subtotals),f.items.forEach(i=>{const d=y.items.find(E=>E.name===i.name);d?(d.projected=i.projected,d.actual=i.actual,d.currentPaid=i.currentPaid,d.comments=i.comments,d.party=i.party,d.status=i.status,d.percentComplete=i.percentComplete,d.lineId=i.lineId,typeof i.quantity=="number"&&(d.quantity=i.quantity),typeof i.rate=="number"&&(d.rate=i.rate),i.unitType&&(d.unitType=i.unitType),d.variance=d.actual-d.projected,d.amountDue=d.actual-d.currentPaid):y.addItem({name:i.name,quantity:i.quantity,unitType:i.unitType,rate:i.rate,projected:i.projected,actual:i.actual,currentPaid:i.currentPaid,comments:i.comments,party:i.party,status:i.status,percentComplete:i.percentComplete,lineId:i.lineId})}),y.updateSubtotals();else{const i=p.addCategory({name:f.name,order:f.order});f.items.forEach(d=>{i.addItem({name:d.name,projected:d.projected,actual:d.actual,currentPaid:d.currentPaid,comments:d.comments,party:d.party,status:d.status,percentComplete:d.percentComplete,lineId:d.lineId})})}}),p.updateTotals()),p}catch(a){throw console.error("Error creating merged estimator:",a),a}})}getItemGroups(){return x(this,null,function*(){try{const t=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_item_groups",{method:"GET",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=yield t.json(),n=e.message||e;if(!n.success)throw new Error(n.error||"Failed to fetch item groups");return console.log("Service - Item Groups fetched:",n.data),n.data}catch(t){throw console.error("Error fetching item groups:",t),t}})}createItemGroup(t){return x(this,null,function*(){try{const e=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.create_item_group",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({item_group_name:t})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=yield e.json(),a=n.message||n;if(!a.success)throw new Error(a.error||"Failed to create item group");return console.log("Service - Item Group created:",a),a}catch(e){throw console.error("Error creating item group:",e),e}})}createItem(t,e){return x(this,null,function*(){try{const n=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.create_item",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({item_name:t,item_group:e})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const a=yield n.json(),c=a.message||a;if(!c.success)throw new Error(c.error||"Failed to create item");return console.log("Service - Item created:",c),c}catch(n){throw console.error("Error creating item:",n),n}})}saveData(t,e=null){return x(this,null,function*(){try{console.log("Service - Saving estimators:",t.length);const n=t.map(f=>f.toJSON());console.log("Service - Data being sent to API:",n),n.length>0&&n[0].categories&&(console.log("Service - First estimator categories:",n[0].categories.length),n[0].categories.forEach((f,y)=>{console.log(`Service - Category ${y}: ${f.name}, Items: ${f.items.length}`),f.items.length>0&&console.log(`Service - Category ${f.name} items:`,f.items)})),console.log("Service - Complete JSON being sent to API:",JSON.stringify(n,null,2));const a=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.save_contractor_estimator_data",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({project_name:e,data:n})});if(!a.ok){const f=yield a.text();throw new Error(`HTTP error! status: ${a.status} - ${f}`)}const c=yield a.json(),p=c.message||c;if(!p.success)throw new Error(p.error||"Failed to save contractor estimator data");return this.estimators=t,p}catch(n){throw console.error("Error saving contractor estimator data:",n),n}})}createEstimator(t){return x(this,null,function*(){try{const e=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.create_contractor_estimator",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify(t)});if(!e.ok){const c=yield e.text();throw new Error(`HTTP error! status: ${e.status} - ${c}`)}const n=yield e.json(),a=n.message||n;if(!a.success)throw new Error(a.error||"Failed to create contractor estimator");return a}catch(e){throw console.error("Error creating contractor estimator:",e),e}})}deleteEstimator(t){return x(this,null,function*(){try{const e=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.delete_contractor_estimator",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({estimator_id:t})});if(!e.ok){const c=yield e.text();throw new Error(`HTTP error! status: ${e.status} - ${c}`)}const n=yield e.json(),a=n.message||n;if(!a.success)throw new Error(a.error||"Failed to delete contractor estimator");return a}catch(e){throw console.error("Error deleting contractor estimator:",e),e}})}getAllEstimators(){return[...this.estimators]}getEstimatorById(t){return this.estimators.find(e=>e.id===t)}addEstimator(t){return t instanceof B||(t=new B(t)),this.estimators.push(t),t}removeEstimator(t){const e=this.estimators.findIndex(n=>n.id===t);return e>-1?(this.estimators.splice(e,1),!0):!1}exportData(t="csv"){if(this.estimators.length===0)return"";const e=this.estimators[0];let a=["Line ID","Category & Items","Projected Subtotal","Actual Subtotal","Variance","Party Responsible","Status","% of Task Complete","Current Paid","Amount Due","Comments"].join(",")+`
`;return a+=`"","TOTALS",${e.totals.projected},${e.totals.actual},${e.totals.variance},"","","",${e.totals.currentPaid},${e.totals.amountDue},""
`,e.categories.forEach(c=>{a+=`"","${c.name}",${c.subtotals.projected},${c.subtotals.actual},${c.subtotals.variance},"","","",${c.subtotals.currentPaid},${c.subtotals.amountDue},""
`,c.items.forEach(p=>{a+=`"${p.lineId||""}","${p.name}",${p.projected||""},${p.actual||""},${p.variance},"${p.party||""}","${p.status}","${p.percentComplete}","${p.currentPaid||""}","${p.amountDue}","${p.comments||""}"
`})}),a}importData(t){var e;try{const n=t.split(`
`).filter(y=>y.trim());if(n.length<2)throw new Error("Invalid CSV format");const a=n[0].split(",").map(y=>y.replace(/"/g,"")),c=B.createWithDefaultCategories();let p=null,f=1;for(let y=1;y<n.length;y++){const i=n[y].split(",").map(E=>E.replace(/"/g,""));if(i.length<a.length)continue;const d=(e=i[1])==null?void 0:e.trim();if(!i[0]&&d&&!isNaN(i[2])){p=c.categories.find(E=>E.name===d);continue}if(p&&i[0]){const E=p.addItem({lineId:i[0]||f++,name:i[1]||"",projected:parseFloat(i[2])||0,actual:parseFloat(i[3])||0,party:i[5]||"",status:i[6]||"Not Started",percentComplete:parseFloat(i[7])||0,currentPaid:parseFloat(i[8])||0,comments:i[10]||""})}}return c.updateTotals(),this.estimators=[c],c}catch(n){throw console.error("Error importing CSV data:",n),n}}clearData(){this.estimators=[]}getDataSummary(){if(this.estimators.length===0)return{totalEstimators:0,totalCategories:0,totalItems:0,totalProjected:0,totalActual:0,totalVariance:0};const t=this.estimators[0],e=t.categories.length,n=t.categories.reduce((a,c)=>a+c.items.length,0);return{totalEstimators:this.estimators.length,totalCategories:e,totalItems:n,totalProjected:t.totals.projected,totalActual:t.totals.actual,totalVariance:t.totals.variance}}deleteItem(t,e){return x(this,null,function*(){var n;try{const c=yield(yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.delete_contractor_estimator_item",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({estimator_id:t,item_line_id:e})})).json();return c.message&&c.message.success?{success:!0,message:c.message.message}:{success:!1,error:((n=c.message)==null?void 0:n.error)||"Failed to delete item"}}catch(a){return console.error("Error deleting item:",a),{success:!1,error:a.message||"Network error occurred"}}})}simpleHash(t){let e=0;for(let n=0;n<t.length;n++){const a=t.charCodeAt(n);e=(e<<5)-e+a,e=e&e}return Math.abs(e)}getItemGLBalance(n){return x(this,arguments,function*(t,e={}){var a;try{const c=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_item_gl_balance",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({item_name:t,from_date:e.fromDate,to_date:e.toDate,company:e.company})});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const p=yield c.json();if(p.message&&p.message.success)return p.message.data;throw new Error(((a=p.message)==null?void 0:a.error)||"Failed to fetch GL balance")}catch(c){throw console.error("Error fetching GL balance:",c),c}})}populateActualSubtotalFromGL(n){return x(this,arguments,function*(t,e={}){try{try{const a=yield this.getItemGLBalance(t.name,e);if(a&&a.primary_account){const c=a.primary_account.total_balance||0;return c>0?(t.actual=Math.abs(c),t._unsaved=!0,{success:!0,balance:c,account:a.primary_account.account_name,company:a.company,method:a.method_used||"item_specific"}):{success:!1,message:"No GL transactions found for this item"}}}catch(a){console.warn("Item-specific GL balance failed:",a.message)}try{const a=yield this.getGeneralAccountBalances(e);if(a&&a.accounts&&a.accounts.length>0){const c=t.name.toLowerCase(),p=a.accounts.find(f=>f.account_name.toLowerCase().includes(c)||c.includes(f.account_name.toLowerCase()));if(p&&p.total_balance>0)return t.actual=Math.abs(p.total_balance),t._unsaved=!0,{success:!0,balance:p.total_balance,account:p.account_name,company:a.company,method:"exact_account_match"}}}catch(a){console.warn("General account lookup failed:",a.message)}return{success:!1,message:"No GL transactions found for this item"}}catch(a){return console.error("Error populating actual subtotal:",a),{success:!1,error:a.message}}})}getGeneralAccountBalances(){return x(this,arguments,function*(t={}){var e;try{const n=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_general_account_balances",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()},body:JSON.stringify({from_date:t.fromDate,to_date:t.toDate,company:t.company})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const a=yield n.json();if(a.message&&a.message.success)return a.message.data;throw new Error(((e=a.message)==null?void 0:e.error)||"Failed to fetch general account balances")}catch(n){throw console.error("Error fetching general account balances:",n),n}})}getDefaultCompany(){return x(this,null,function*(){var t;try{const e=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.get_default_company",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":G()}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=yield e.json();if(n.message&&n.message.success)return n.message.data;throw new Error(((t=n.message)==null?void 0:t.error)||"Failed to fetch default company")}catch(e){throw console.error("Error fetching default company:",e),e}})}setAutoLoadGLBalances(t){this.autoLoadGLBalances=t,console.log(`Auto-loading GL balances ${t?"enabled":"disabled"}`)}debugGLBalance(t){return x(this,null,function*(){console.log(`=== Debugging GL Balance for: ${t} ===`);try{console.log("1. Testing item-specific GL balance...");const e=yield this.getItemGLBalance(t);console.log("Item-specific result:",e),console.log("2. Testing general account balances...");const n=yield this.getGeneralAccountBalances();console.log("General result:",n),console.log("3. Testing debug accounts API...");const a=yield this.debugAccounts(t);return console.log("Debug accounts result:",a),{itemSpecific:e,general:n,debug:a}}catch(e){return console.error("Debug error:",e),{error:e.message}}})}debugAccounts(t){return x(this,null,function*(){try{const e=yield fetch("/api/method/ex_forcast.api.call_and_save_contractor_estimator.debug_accounts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({search_term:t})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return yield e.json()}catch(e){throw console.error("Error debugging accounts:",e),e}})}autoLoadGLBalancesForEstimator(n){return x(this,arguments,function*(t,e={}){try{if(!this.autoLoadGLBalances)return{success:!0,total:0,successful:0,failed:0,results:[],message:"Auto-loading GL balances is disabled"};const a=[];for(const y of t.categories)for(const i of y.items)i.name&&i.name.trim()&&a.push(this.populateActualSubtotalFromGL(i,e).catch(d=>(console.warn(`Failed to load GL balance for item "${i.name}":`,d.message),{success:!1,item:i.name,error:d.message})));const c=yield Promise.all(a),p=c.filter(y=>y.success).length,f=c.filter(y=>!y.success).length;return{success:!0,total:a.length,successful:p,failed:f,results:c}}catch(a){return console.error("Error auto-loading GL balances:",a),{success:!1,error:a.message}}})}}const N=new be,we={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},_e={class:"relative z-10 w-full max-w-md bg-white rounded-xl shadow-2xl border border-violet-200"},Ce={class:"px-5 py-4 border-b border-gray-200 flex items-center justify-between"},je={class:"flex items-center gap-2"},Te={class:"w-8 h-8 bg-gradient-to-br from-violet-500 to-violet-600 rounded-lg flex items-center justify-center"},Se={class:"p-5 space-y-4"},Ee={class:"flex gap-2"},ke={key:0},$e=["value"],Pe={key:1},Ie={key:2,class:"mt-1 text-sm text-red-600 flex items-center gap-1"},Fe={class:"px-5 py-4 border-t border-gray-200 flex items-center justify-end gap-2 bg-gray-50 rounded-b-xl"},De=["disabled"],Ne={__name:"AddCategoryModal",props:{isVisible:{type:Boolean,default:!1}},emits:["close","create"],setup(w,{expose:t,emit:e}){const n=w,a=e,c=$("select"),p=$(""),f=$(""),y=$([]),i=$(""),d=$(!1),E=$(null),L=M(()=>c.value==="select"?f.value.trim()!=="":p.value.trim()!==""&&p.value.trim().length>=2),m=()=>{i.value=""},A=I=>{c.value=I,m(),I==="select"?p.value="":f.value=""},U=()=>x(this,null,function*(){try{d.value=!0;const I=yield N.getItemGroups();y.value=I}catch(I){console.error("Failed to load item groups:",I),I.value="Failed to load existing Item Groups"}finally{d.value=!1}}),z=()=>{d.value||(p.value="",f.value="",i.value="",d.value=!1,c.value="select",a("close"))},et=()=>x(this,null,function*(){if(d.value)return;let I="";if(c.value==="select"){if(!f.value.trim()){i.value="Please select an Item Group";return}I=f.value.trim()}else{const b=p.value.trim();if(!b){i.value="Category name is required";return}if(b.length<2){i.value="Category name must be at least 2 characters";return}I=b}d.value=!0,i.value="";try{a("create",I,c.value)}catch(b){i.value=b.message||"Failed to process category"}finally{d.value=!1}});return Wt(()=>n.isVisible,I=>{I&&(U(),Yt(()=>{var b;c.value==="create"&&((b=E.value)==null||b.focus())}))}),wt(()=>{n.isVisible&&U()}),t({closeModal:z,setError:I=>{i.value=I},setLoading:I=>{d.value=I}}),(I,b)=>w.isVisible?(j(),k("div",we,[s("div",{class:"absolute inset-0 bg-black/30",onClick:z}),s("div",_e,[s("div",Ce,[s("div",je,[s("div",Te,[C(g(X),{class:"w-4 h-4 text-white"})]),b[4]||(b[4]=s("h3",{class:"text-base font-semibold text-gray-800"},"Add New Category",-1))]),s("button",{onClick:z,class:"text-gray-400 hover:text-gray-600 transition-colors"},[C(g(Ct),{class:"w-5 h-5"})])]),s("div",Se,[s("div",null,[b[7]||(b[7]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Add Category From ",-1)),s("div",Ee,[s("button",{onClick:b[0]||(b[0]=O=>A("select")),class:H(["flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-all",c.value==="select"?"bg-violet-100 text-violet-700 border-2 border-violet-300":"bg-gray-100 text-gray-600 border-2 border-transparent hover:bg-gray-200"])},[C(g(de),{class:"w-4 h-4 inline mr-2"}),b[5]||(b[5]=P(" Select Existing ",-1))],2),s("button",{onClick:b[1]||(b[1]=O=>A("create")),class:H(["flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-all",c.value==="create"?"bg-violet-100 text-violet-700 border-2 border-violet-300":"bg-gray-100 text-gray-600 border-2 border-transparent hover:bg-gray-200"])},[C(g(X),{class:"w-4 h-4 inline mr-2"}),b[6]||(b[6]=P(" Create New ",-1))],2)])]),c.value==="select"?(j(),k("div",ke,[b[9]||(b[9]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Select Item Group ",-1)),R(s("select",{"onUpdate:modelValue":b[2]||(b[2]=O=>f.value=O),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent transition-all",onChange:m},[b[8]||(b[8]=s("option",{value:""},"Choose an existing Item Group...",-1)),(j(!0),k(Q,null,Y(y.value,O=>(j(),k("option",{key:O.name,value:O.item_group_name},S(O.item_group_name),9,$e))),128))],544),[[_t,f.value]]),b[10]||(b[10]=s("p",{class:"mt-1 text-xs text-gray-500"}," Select from existing Item Groups in the system ",-1))])):V("",!0),c.value==="create"?(j(),k("div",Pe,[b[11]||(b[11]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Category Name ",-1)),R(s("input",{"onUpdate:modelValue":b[3]||(b[3]=O=>p.value=O),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent transition-all",placeholder:"Enter category name (e.g., Planning, Site Prep)",onKeyup:dt(et,["enter"]),onInput:m,ref_key:"categoryNameInput",ref:E},null,544),[[J,p.value]]),b[12]||(b[12]=s("p",{class:"mt-1 text-xs text-gray-500"}," This will create a new Item Group in the system ",-1))])):V("",!0),i.value?(j(),k("p",Ie,[C(g(me),{class:"w-4 h-4"}),P(" "+S(i.value),1)])):V("",!0)]),s("div",Fe,[s("button",{onClick:z,class:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors"}," Cancel "),s("button",{onClick:et,disabled:d.value||!L.value,class:"px-4 py-2 rounded-md bg-gradient-to-r from-violet-600 to-violet-700 text-white hover:from-violet-700 hover:to-violet-800 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all flex items-center gap-2"},[d.value?(j(),ot(g(mt),{key:0,class:"w-4 h-4 animate-spin"})):(j(),ot(g(X),{key:1,class:"w-4 h-4"})),P(" "+S(d.value?"Processing...":c.value==="select"?"Add Category":"Create Category"),1)],8,De)])])])):V("",!0)}},Le=bt(Ne,[["__scopeId","data-v-7106fec4"]]),D=w=>w==null||isNaN(w)?"0.00":new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(w),W=w=>{if(w==null||w==="")return"";const t=parseFloat(w);return isNaN(t)?w.toString():new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}).format(t)},ct=w=>{if(!w)return 0;const t=w.toString().replace(/[,\s]/g,""),e=parseFloat(t);return isNaN(e)?0:e},ut=w=>w>0?"text-red-600 bg-red-50":w<0?"text-green-600 bg-green-50":"text-gray-600 bg-gray-50",Ae=(w,t)=>`${w.toString().padStart(2,"0")}.${(t+1).toString().padStart(2,"0")}`,Ge={class:"flex"},Oe={class:"flex-1 min-h-screen bg-gradient-to-br from-white to-violet-50"},Re={class:"flex"},Ve={key:2,class:"text-violet-700 text-sm font-medium dark:text-white"},Ue={class:"mb-8"},Be={class:"flex items-center gap-3 mb-2"},Me={class:"w-12 h-12 bg-gradient-to-br from-violet-500 to-violet-600 rounded-xl flex items-center justify-center shadow-lg"},qe={key:0,class:"mt-3"},Je={class:"flex items-center gap-2 text-xs font-medium text-violet-600 bg-violet-50 px-3 py-2 rounded-lg border border-violet-200"},He={key:1,class:"mt-3"},Xe={class:"flex items-center gap-2 text-xs font-medium text-blue-600 bg-blue-50 px-3 py-2 rounded-lg border border-blue-200"},ze={class:"mb-6"},Ke={class:"text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},Qe=["value"],We=["value"],Ye={class:"bg-white rounded-xl p-4 mb-6 border border-gray-200 shadow-sm"},Ze={class:"flex items-center justify-between"},to={class:"flex items-center gap-2"},eo={key:0,class:"flex items-center gap-2 text-sm font-medium text-red-600 bg-red-50 px-3 py-2 rounded-lg border border-red-200"},oo={key:1,class:"flex items-center gap-2 text-sm font-medium text-green-600 bg-green-50 px-3 py-2 rounded-lg border border-green-200"},so=["disabled"],ao={key:1,class:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg cursor-not-allowed"},ro={class:"mb-8"},no={class:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2"},lo={class:"flex gap-2"},io={class:"mt-2 space-y-2"},co={class:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm"},uo={class:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"},mo={class:"space-y-3"},po={class:"flex justify-between items-center"},go={class:"font-semibold text-violet-600"},fo={class:"flex justify-between items-center"},ho={class:"font-semibold text-violet-600"},yo={class:"flex justify-between items-center"},vo={class:"font-semibold text-blue-600"},xo={class:"flex justify-between items-center"},bo={class:"font-semibold text-green-600"},wo={class:"flex justify-between items-center"},_o={class:"flex justify-between items-center"},Co={class:"font-semibold text-purple-600"},jo={class:"flex justify-between items-center"},To={class:"font-semibold text-orange-600"},So={class:"flex-1 p-4 min-w-0"},Eo={class:"flex items-center gap-2 mb-4"},ko={class:"w-6 h-6 bg-gradient-to-br from-violet-500 to-violet-600 rounded-lg flex items-center justify-center"},$o={key:0,class:"bg-white rounded-lg border border-violet-200 shadow-sm p-12"},Po={class:"text-center"},Io={class:"w-24 h-24 bg-gradient-to-br from-violet-100 to-violet-200 rounded-full flex items-center justify-center mx-auto mb-6"},Fo={key:1,class:"bg-white rounded-2xl border border-gray-200 shadow-xl overflow-hidden"},Do={class:"overflow-x-auto"},No={class:"w-full"},Lo={class:"bg-white divide-y divide-gray-100"},Ao={class:"bg-gradient-to-r from-violet-100 to-purple-100 border-b border-violet-200 hover:from-violet-200 hover:to-purple-200 transition-all duration-200"},Go={class:"px-6 py-4 text-sm text-violet-800 font-bold",colspan:"15"},Oo={class:"flex items-center justify-between"},Ro={class:"flex items-center gap-3 text-violet-900"},Vo=["value","onInput"],Uo={class:"flex items-center gap-2"},Bo=["onClick"],Mo=["onClick","title"],qo={class:"bg-gradient-to-r from-violet-50 to-purple-50 border-b-2 border-violet-300 font-bold shadow-sm"},Jo={class:"px-6 py-3 text-sm font-bold text-blue-900 text-right bg-blue-50/50"},Ho={class:"px-6 py-3 text-sm font-bold text-green-900 text-right bg-green-50/50"},Xo={class:"px-6 py-3 text-sm font-bold text-purple-900 text-right bg-purple-50/50"},zo={class:"px-6 py-3 text-sm font-bold text-orange-900 text-right bg-orange-50/50"},Ko={class:"px-2 py-3 text-sm text-gray-600 text-center"},Qo={class:"p-0 text-sm"},Wo=["onUpdate:modelValue","onInput"],Yo={class:"p-0 text-sm"},Zo=["value","onInput"],ts={class:"p-0 text-sm"},es=["value"],os={class:"p-0 text-sm"},ss=["value","onInput"],as={class:"p-0 text-sm"},rs=["value","onInput"],ns={class:"p-0 text-sm"},ls=["value","onInput"],is={class:"p-0 text-sm"},cs=["onUpdate:modelValue"],us={class:"p-0 text-sm"},ds=["onUpdate:modelValue"],ms=["value"],ps={class:"p-0 text-sm"},gs=["onUpdate:modelValue"],fs={class:"p-0 text-sm"},hs=["value","onInput"],ys={class:"px-2 py-3 text-sm font-medium text-orange-600 text-right"},vs={class:"p-0 text-sm"},xs=["onUpdate:modelValue"],bs={class:"px-2 py-3 text-sm"},ws=["onClick"],_s={class:"bg-gradient-to-r from-violet-50 to-purple-50 border-t-2 border-violet-200 font-bold"},Cs={class:"px-6 py-4 text-sm font-bold text-blue-800 text-right"},js={class:"px-6 py-4 text-sm font-bold text-green-800 text-right"},Ts={class:"px-6 py-4 text-sm font-bold text-purple-800 text-right"},Ss={class:"px-6 py-4 text-sm font-bold text-orange-800 text-right"},Es={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},ks={class:"relative z-10 w-full max-w-md bg-white rounded-xl shadow-2xl border border-violet-200"},$s={class:"px-5 py-4 border-b border-gray-200 flex items-center justify-between"},Ps={class:"flex items-center gap-2"},Is={class:"p-5 space-y-3"},Fs={__name:"contractor_estimator",setup(w){const t=$(!1),e=$(!0),n=$(!1),a=$(""),c=$(!1),p=$(!1),f=$(!1),y=$(""),i=$(""),d=$(""),E=$([]),L=$([]),m=$(null),A=$(null),U=$(!1),z=$(null),et=xe,I=M(()=>{var r,o;return((o=(r=m.value)==null?void 0:r.categories)==null?void 0:o.length)||0}),b=M(()=>{var r;return(r=m.value)!=null&&r.categories?m.value.categories.reduce((o,l)=>o+l.items.length,0):0}),O=M(()=>{var r,o;return((o=(r=m.value)==null?void 0:r.totals)==null?void 0:o.projected)||0}),jt=M(()=>{var r,o;return((o=(r=m.value)==null?void 0:r.totals)==null?void 0:o.actual)||0}),pt=M(()=>{var r,o;return((o=(r=m.value)==null?void 0:r.totals)==null?void 0:o.variance)||0}),Tt=M(()=>{var r,o;return((o=(r=m.value)==null?void 0:r.totals)==null?void 0:o.currentPaid)||0}),St=M(()=>{var r,o;return((o=(r=m.value)==null?void 0:r.totals)==null?void 0:o.amountDue)||0}),st=(r=!1)=>x(this,null,function*(){var o;try{n.value=!0;const l=(o=K.value)==null?void 0:o.name;if(yield N.fetchData(l),L.value=[...N.getAllEstimators()],m.value=L.value[0]||null,m.value)if(m.value.categories.some(u=>u.items.length>0))e.value=!0;else{const u=m.value.projectTitle||"New Project Estimate",_=m.value.location||"";try{const v=yield N.createMergedEstimator(u,_,l);v.id=m.value.id,L.value=[v],m.value=v,e.value=!1}catch(v){console.error("Error creating estimator from API data:",v),e.value=!0}}else{const h=l||"New Project Estimate",u="";try{const _=yield N.createMergedEstimator(h,u,l);L.value=[_],m.value=_,e.value=!!_.id}catch(_){console.error("Error creating estimator from API data:",_);const v=B.createEmpty(h,u);v.project=l,L.value=[v],m.value=v,e.value=!1}}a.value=""}catch(l){console.error("Load data error:",l),a.value=l.message,T.error(`Failed to load data: ${l.message}`)}finally{n.value=!1}yield qt(),yield Jt()}),F=()=>{e.value=!1,a.value="",m.value&&m.value.updateTotals()},at=(r,o,l)=>{const h=r.target.value,u=ct(h);o[l]=u,l==="projected"&&typeof o.quantity=="number"&&typeof o.rate=="number"&&(o.projected=o.quantity*o.rate),F()},Et=()=>x(this,null,function*(){var r;n.value=!0,a.value="";try{const o=(r=K.value)==null?void 0:r.name;yield kt(),yield N.saveData(L.value,o),e.value=!0,T.success("Contractor estimate saved successfully")}catch(o){a.value=o.message,T.error(`Failed to save changes: ${o.message}`)}finally{n.value=!1}}),kt=()=>x(this,null,function*(){if(!m.value)return;const r=[];if(m.value.categories.forEach(l=>{l.items.forEach(h=>{h.name&&h.name.trim()&&r.push({itemName:h.name.trim(),itemGroup:l.name,item:h})})}),r.length===0)return;const o=r.map(_=>x(this,[_],function*({itemName:l,itemGroup:h,item:u}){try{yield N.createItem(l,h),console.log(`Item "${l}" created in Frappe under group "${h}"`)}catch(v){console.warn(`Failed to create item "${l}":`,v.message)}}));yield Promise.allSettled(o)}),$t=(r,o)=>{const l=r.target.value;o.name=l||"Untitled Category",F()},Pt=r=>{var l;const o=(l=m.value)==null?void 0:l.categories.find(h=>h.id===r);o&&(o.addItem(),m.value.updateTotals(),F())},It=r=>x(this,null,function*(){r.name&&r.name.trim()&&setTimeout(()=>x(this,null,function*(){try{try{const l=yield fetch(`/api/resource/Item/${encodeURIComponent(r.name)}?fields=["name","item_name","stock_uom","valuation_rate"]`);if(l.ok){const u=(yield l.json()).data||{};u.stock_uom&&(r.unitType=u.stock_uom),typeof u.valuation_rate=="number"&&(r.rate=u.valuation_rate),typeof r.quantity=="number"&&typeof r.rate=="number"&&(r.projected=r.quantity*r.rate)}}catch(l){}(yield N.populateActualSubtotalFromGL(r,{fromDate:"2025-01-01",toDate:"2025-12-31"})).success&&F()}catch(o){console.warn(`Failed to load GL balance for "${r.name}":`,o.message)}}),1500)}),Ft=(r,o)=>{const l=r.target.value,h=ct(l);o.quantity=h,typeof o.rate=="number"&&(o.projected=(o.quantity||0)*(o.rate||0)),F()},Dt=(r,o)=>{const l=r.target.value,h=ct(l);o.rate=h,typeof o.quantity=="number"&&(o.projected=(o.quantity||0)*(o.rate||0)),F()},Nt=(r,o)=>x(this,null,function*(){var l,h;if(confirm("Are you sure you want to delete this item?"))try{const u=(l=m.value)==null?void 0:l.categories.find(_=>_.id===r);if(u){const _=u.items.find(v=>v.id===o);if(_){if((_.projected>0||_.actual>0||_.currentPaid>0||_.comments&&_.comments.trim()!==""||_.party!==""||_.status!=="Not Started"||_.percentComplete>0)&&((h=m.value)!=null&&h.id)){console.log(`Item '${_.name}' has data, deleting from database...`);const q=yield N.deleteItem(m.value.id,_.lineId);q.success?console.log("Successfully deleted item from database"):console.warn("Failed to delete item from database:",q.error)}else console.log(`Item '${_.name}' has no data, removing locally only`);u.removeItem(o),m.value.updateTotals(),F(),T.success("Item deleted successfully")}}}catch(u){T.error(`Failed to delete item: ${u.message}`)}}),Lt=r=>x(this,null,function*(){var u;const o=(u=m.value)==null?void 0:u.categories.find(_=>_.id===r);if(!o)return;const l=o.items.length,h=l>0?`Are you sure you want to delete the category "${o.name}" and all ${l} items within it?`:`Are you sure you want to delete the category "${o.name}"?`;if(confirm(h))try{m.value&&(m.value.removeCategory(r),F(),T.success(`Category "${o.name}" deleted successfully`))}catch(_){T.error(`Failed to delete category: ${_.message}`)}}),At=()=>x(this,null,function*(){var r,o,l;if(confirm("Are you sure you want to restore all categories from API? This will replace your current categories and items."))try{const h=((r=m.value)==null?void 0:r.projectTitle)||"New Project Estimate",u=((o=m.value)==null?void 0:o.location)||"",_=(l=K.value)==null?void 0:l.name,v=yield N.createMergedEstimator(h,u,_);L.value=[v],m.value=v,F(),T.success("Categories restored successfully")}catch(h){T.error(`Failed to restore categories from API: ${h.message}`)}}),Gt=()=>{y.value="New Project Estimate",i.value="",p.value=!0},rt=()=>x(this,null,function*(){var h;const r=(y.value||"").trim()||"New Project Estimate",o=(i.value||"").trim()||"",l=(h=K.value)==null?void 0:h.name;try{const u=yield N.createMergedEstimator(r,o,l);L.value=[u],m.value=u,p.value=!1,y.value="",i.value="",F()}catch(u){console.error("Error creating estimator from API data:",u),T.error(`Failed to create estimator: ${u.message}`)}}),gt=()=>{p.value=!1,y.value="",i.value=""},Ot=()=>x(this,null,function*(){try{yield st(!0),T.success("Data refreshed successfully")}catch(r){T.error(`Failed to refresh data: ${r.message}`)}}),Rt=()=>{try{if(!m.value){T.error("No data to export");return}const r=N.exportData("csv"),o=new Blob([r],{type:"text/csv"}),l=window.URL.createObjectURL(o),h=document.createElement("a");h.href=l,h.download=`contractor_estimate_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(l),T.success("Data exported successfully")}catch(r){T.error(`Failed to export data: ${r.message}`)}},Vt=()=>{c.value=!0},Ut=()=>{c.value=!1},Bt=()=>{f.value=!0},nt=()=>{f.value=!1},Mt=(r,o)=>x(this,null,function*(){if(!m.value){T.error("Please create an estimator first");return}try{o==="create"&&(yield N.createItemGroup(r));const l=m.value.addCategory({name:r,order:m.value.categories.length+1});nt(),F(),o==="create"?T.success(`Category "${r}" added successfully and Category created`):T.success(`Category "${r}" added successfully from existing Category`)}catch(l){if(o==="create"){console.warn("Failed to create Category, adding category locally:",l.message);try{const h=m.value.addCategory({name:r,order:m.value.categories.length+1});nt(),F(),T.warning(`Category "${r}" added locally, but Cate creation failed: ${l.message}`)}catch(h){T.error(`Failed to add category: ${h.message}`)}}else T.error(`Failed to add category: ${l.message}`)}}),qt=()=>x(this,null,function*(){try{const r=yield N.getDefaultCompany();A.value=r}catch(r){console.warn("Failed to load default company:",r.message),A.value=null}}),Jt=()=>x(this,null,function*(){if(m.value)try{U.value=!0;const r=yield N.autoLoadGLBalancesForEstimator(m.value,{fromDate:"2025-01-01",toDate:"2025-12-31"});z.value=r,r.success&&r.successful>0?(F(),T.success(`GL balances loaded: ${r.successful} items updated`+(r.failed>0?`, ${r.failed} failed`:""))):r.success&&r.failed>0&&T.warning(`GL balance loading completed with ${r.failed} failures`)}catch(r){console.error("Error auto-loading GL balances:",r),T.warning("Failed to auto-load GL balances: "+r.message)}finally{U.value=!1}});wt(()=>x(this,null,function*(){var l,h,u,_,v;try{yield Zt()}catch(q){}yield N.testApiConnection();try{const q=yield fetch('/api/resource/Project?limit_page_length=1000&fields=["name","project_name"]');if(q.ok){const Xt=yield q.json();E.value=(Xt.data||[]).map(ft=>({name:ft.name,project_name:ft.project_name}))}}catch(q){}const r=((l=te)==null?void 0:l())||null;r&&r.name&&vt(r),d.value=((u=(h=K)==null?void 0:h.value)==null?void 0:u.name)||"",yield st();const o=(v=(_=K)==null?void 0:_.value)==null?void 0:v.project_name;o&&T.success(`Switched to project: ${o}`)}));const Ht=r=>x(this,null,function*(){try{const o=r.target.value;d.value=o;const l=E.value?E.value.find(h=>h.name===o):null;l&&(vt(l),T.success(`Switched to project: ${l.project_name||l.name}`)),yield st(!0)}catch(o){T.error("Failed to switch project")}});return(r,o)=>(j(),k("div",Ge,[C(ae,{onOpenSettings:Vt}),s("div",Oe,[s("div",Re,[s("div",{class:H(["bg-gradient-to-b from-white to-gray-50 border-r border-gray-200 min-h-screen flex flex-col shadow-sm transition-all duration-300",t.value?"w-14 p-2":"w-80 p-6"])},[s("button",{onClick:o[0]||(o[0]=l=>t.value=!t.value),class:"mb-4 flex items-center gap-2 px-2 py-1 bg-violet-100 hover:bg-violet-200 rounded transition-all dark:bg-violet-900/30 dark:hover:bg-violet-800/40"},[t.value?(j(),ot(g(pe),{key:1,class:"w-5 h-5 text-violet-700 dark:text-white"})):(j(),ot(g(ge),{key:0,class:"w-5 h-5 text-violet-700 dark:text-white"})),t.value?V("",!0):(j(),k("span",Ve,"Collapse"))]),C(se,{name:"fade"},{default:ee(()=>[R(s("div",null,[s("div",Ue,[s("div",Be,[s("div",Me,[C(g(re),{class:"w-7 h-7 mx-2 text-white"})]),o[4]||(o[4]=s("h1",{class:"text-2xl font-bold text-gray-900"},"Contractor Estimator",-1))]),o[7]||(o[7]=s("p",{class:"text-sm text-gray-500"},"Manage and track your construction project estimates",-1)),A.value?(j(),k("div",qe,[s("div",Je,[o[5]||(o[5]=s("div",{class:"w-2 h-2 bg-violet-500 rounded-full"},null,-1)),P(" Company: "+S(A.value.company_name)+" ("+S(A.value.abbr)+") ",1)])])):V("",!0),U.value?(j(),k("div",He,[s("div",Xe,[C(g(mt),{class:"w-3 h-3 animate-spin"}),o[6]||(o[6]=P(" Loading GL balances... ",-1))])])):V("",!0)]),s("div",ze,[s("h3",Ke,[C(g(fe),{class:"w-4 h-4 text-violet-600"}),o[8]||(o[8]=P(" Project ",-1))]),s("select",{value:d.value,onChange:o[1]||(o[1]=l=>Ht(l)),class:"w-full px-3 py-2 bg-white border border-violet-200 rounded-lg text-gray-800 focus:ring-2 focus:ring-violet-500 focus:border-violet-400 text-sm shadow-sm hover:border-violet-300 transition-colors"},[o[9]||(o[9]=s("option",{value:"",disabled:""},"Select Project",-1)),(j(!0),k(Q,null,Y(E.value,l=>(j(),k("option",{key:l.name,value:l.name},S(l.project_name||l.name),9,We))),128))],40,Qe)]),s("div",Ye,[s("div",Ze,[s("div",to,[e.value?(j(),k("div",oo,[C(g(le),{class:"w-4 h-4 text-green-600"}),o[11]||(o[11]=P(" All Saved ",-1))])):(j(),k("div",eo,[C(g(ne),{class:"w-4 h-4 text-red-600"}),o[10]||(o[10]=P(" Unsaved ",-1))]))]),!n.value&&!e.value?(j(),k("button",{key:0,disabled:n.value,onClick:Et,class:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-600 to-violet-700 text-white rounded-lg hover:from-violet-700 hover:to-violet-800 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105"},[C(g(he),{class:"w-4 h-4"}),o[12]||(o[12]=P(" Save ",-1))],8,so)):V("",!0),n.value?(j(),k("button",ao,[C(g(mt),{class:"w-4 h-4 animate-spin"}),o[13]||(o[13]=P(" Saving... ",-1))])):V("",!0)])]),s("div",ro,[s("h3",no,[C(g(X),{class:"w-4 h-4 text-violet-600"}),o[14]||(o[14]=P(" Quick Actions ",-1))]),s("div",lo,[s("button",{onClick:Ot,class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-violet-200 text-violet-700 rounded-lg hover:bg-violet-50 transition-all text-sm font-medium"},[C(g(ie),{class:"w-4 h-4"}),o[15]||(o[15]=P(" Refresh ",-1))]),s("button",{onClick:Rt,class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-green-200 text-green-700 rounded-lg hover:bg-green-50 transition-all text-sm font-medium"},[C(g(ce),{class:"w-4 h-4"}),o[16]||(o[16]=P(" Export ",-1))])]),s("div",io,[s("button",{onClick:Bt,class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-violet-200 text-violet-700 rounded-lg hover:bg-violet-50 transition-all text-sm font-medium"},[C(g(X),{class:"w-4 h-4"}),o[17]||(o[17]=P(" Add Category ",-1))]),s("button",{onClick:At,class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-orange-200 text-orange-700 rounded-lg hover:bg-orange-50 transition-all text-sm font-medium"},[C(g(ye),{class:"w-4 h-4"}),o[18]||(o[18]=P(" Restore ",-1))])])]),s("div",co,[s("h3",uo,[C(g(ve),{class:"w-5 h-5 text-violet-600"}),o[19]||(o[19]=P(" Project Summary ",-1))]),s("div",mo,[s("div",po,[o[20]||(o[20]=s("span",{class:"text-sm text-gray-600"},"Total Categories:",-1)),s("span",go,S(I.value),1)]),s("div",fo,[o[21]||(o[21]=s("span",{class:"text-sm text-gray-600"},"Total Items:",-1)),s("span",ho,S(b.value),1)]),s("div",yo,[o[22]||(o[22]=s("span",{class:"text-sm text-gray-600"},"Projected Total:",-1)),s("span",vo,S(g(D)(O.value)),1)]),s("div",xo,[o[23]||(o[23]=s("span",{class:"text-sm text-gray-600"},"Actual Total:",-1)),s("span",bo,S(g(D)(jt.value)),1)]),s("div",wo,[o[24]||(o[24]=s("span",{class:"text-sm text-gray-600"},"Variance:",-1)),s("span",{class:H(["font-semibold",pt.value>=0?"text-red-600":"text-green-600"])},S(g(D)(pt.value)),3)]),s("div",_o,[o[25]||(o[25]=s("span",{class:"text-sm text-gray-600"},"Current Paid:",-1)),s("span",Co,S(g(D)(Tt.value)),1)]),s("div",jo,[o[26]||(o[26]=s("span",{class:"text-sm text-gray-600"},"Amount Due:",-1)),s("span",To,S(g(D)(St.value)),1)])])])],512),[[oe,!t.value]])]),_:1})],2),s("div",So,[s("div",Eo,[s("div",ko,[C(g(it),{class:"w-3 h-3 text-white"})]),o[27]||(o[27]=s("h2",{class:"text-lg font-bold text-gray-800"},"Contractor Estimate Overview",-1))]),!m.value||m.value.categories.length===0?(j(),k("div",$o,[s("div",Po,[s("div",Io,[C(g(it),{class:"w-12 h-12 text-violet-600"})]),o[29]||(o[29]=s("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"No Estimate Data",-1)),o[30]||(o[30]=s("p",{class:"text-gray-600 mb-8 max-w-md mx-auto"}," Get started by creating your first contractor estimate. You can add categories, track costs, and monitor progress all in one place. ",-1)),s("button",{onClick:Gt,class:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-violet-600 to-violet-700 text-white rounded-xl hover:from-violet-700 hover:to-violet-800 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 font-medium"},[C(g(X),{class:"w-5 h-5"}),o[28]||(o[28]=P(" Create New Estimate ",-1))])])])):(j(),k("div",Fo,[s("div",Do,[s("table",No,[o[45]||(o[45]=s("thead",{class:"bg-violet-500 text-white shadow-lg"},[s("tr",{class:"border-b border-white/20"},[s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-16"},"Line ID"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-80"},"Category & Items"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-24"},"Qty"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-28"},"Unit Type"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Rate"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Projected Subtotal"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Actual Subtotal"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Variance"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-48"},"Party Responsible"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Status"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-24"},"% Complete"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Current Paid"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-32"},"Amount Due"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-48"},"Comments"),s("th",{class:"px-6 py-4 text-left text-sm font-bold text-white uppercase tracking-wider w-16"},"Actions")])],-1)),s("tbody",Lo,[(j(!0),k(Q,null,Y(m.value.categories,(l,h)=>(j(),k(Q,{key:`category-${l.id}`},[s("tr",Ao,[s("td",Go,[s("div",Oo,[s("div",Ro,[o[31]||(o[31]=s("div",{class:"w-4 h-4 bg-gradient-to-r from-violet-600 to-purple-600 rounded-full shadow-sm"},null,-1)),s("input",{value:l.name,onInput:u=>$t(u,l),type:"text",class:"font-bold text-lg bg-transparent border-0 focus:ring-2 focus:ring-violet-500 focus:bg-white focus:shadow-sm px-2 py-1 rounded transition-all duration-200 min-w-0 flex-1 text-violet-900",placeholder:"Category name"},null,40,Vo)]),s("div",Uo,[s("button",{onClick:u=>Pt(l.id),class:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-600 to-violet-700 text-white rounded-lg hover:from-violet-700 hover:to-violet-800 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105"},[C(g(X),{class:"w-4 h-4"}),o[32]||(o[32]=P(" Add Item ",-1))],8,Bo),s("button",{onClick:u=>Lt(l.id),class:"inline-flex items-center justify-center w-10 h-10 rounded-lg text-red-600 hover:text-white hover:bg-red-600 transition-all duration-200 shadow-sm hover:shadow-md",title:`Delete category: ${l.name}`},[C(g(xt),{class:"w-4 h-4"})],8,Mo)])])])]),s("tr",qo,[o[33]||(o[33]=s("td",{class:"px-6 py-3 text-sm text-violet-700 font-bold",colspan:"5"},[s("div",{class:"flex items-center gap-2"},[s("div",{class:"w-2 h-2 bg-violet-500 rounded-full"}),P(" SUBTOTAL ")])],-1)),s("td",Jo,S(g(D)(l.subtotals.projected)),1),s("td",Ho,S(g(D)(l.subtotals.actual)),1),s("td",{class:H(["px-6 py-3 text-sm font-bold text-right bg-gray-50/50",g(ut)(l.subtotals.variance)])},S(g(D)(l.subtotals.variance)),3),o[34]||(o[34]=s("td",{class:"px-6 py-3 text-sm text-gray-500 bg-gray-50/30"},null,-1)),o[35]||(o[35]=s("td",{class:"px-6 py-3 text-sm text-gray-500 bg-gray-50/30"},null,-1)),o[36]||(o[36]=s("td",{class:"px-6 py-3 text-sm text-gray-500 bg-gray-50/30"},null,-1)),s("td",Xo,S(g(D)(l.subtotals.currentPaid)),1),s("td",zo,S(g(D)(l.subtotals.amountDue)),1),o[37]||(o[37]=s("td",{class:"px-6 py-3 text-sm text-gray-500 bg-gray-50/30"},null,-1)),o[38]||(o[38]=s("td",{class:"px-6 py-3 text-sm text-gray-500 bg-gray-50/30"},null,-1))]),(j(!0),k(Q,null,Y(l.items,(u,_)=>(j(),k("tr",{key:`item-${l.id}-${u.id}`,class:"transition-all duration-200 h-12 align-middle hover:bg-slate-50/50 border-b border-gray-100"},[s("td",Ko,S(u.lineId||g(Ae)(h+1,_)),1),s("td",Qo,[R(s("input",{"onUpdate:modelValue":v=>u.name=v,type:"text",class:"w-full h-full px-4 py-0 border-0 bg-transparent text-sm focus:ring-2 focus:ring-violet-500 focus:bg-white focus:shadow-sm font-medium transition-all duration-200",placeholder:"Enter item name",onInput:v=>{F(),It(u)}},null,40,Wo),[[J,u.name]])]),s("td",Yo,[s("input",{value:g(W)(u.quantity),onInput:v=>Ft(v,u),type:"text",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-violet-500 focus:border-transparent",placeholder:"0"},null,40,Zo)]),s("td",ts,[s("input",{value:u.unitType,type:"text",readonly:"",class:"w-full h-full px-4 py-0 border-0 bg-transparent text-sm text-gray-600 cursor-not-allowed",placeholder:"UOM",tabindex:"-1"},null,8,es)]),s("td",os,[s("input",{value:g(W)(u.rate),onInput:v=>Dt(v,u),type:"text",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-violet-500 focus:border-transparent",placeholder:"0"},null,40,ss)]),s("td",as,[s("input",{value:g(W)(u.projected),onInput:v=>at(v,u,"projected"),type:"text",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"},null,40,rs)]),s("td",ns,[s("input",{value:g(W)(u.actual),onInput:v=>at(v,u,"actual"),type:"text",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"0"},null,40,ls)]),s("td",{class:H(["px-2 py-3 text-sm font-medium text-right",g(ut)(u.variance)])},S(g(D)(u.variance)),3),s("td",is,[R(s("input",{"onUpdate:modelValue":v=>u.party=v,type:"text",class:"w-full h-full px-4 py-0 border-0 bg-transparent text-sm focus:ring-2 focus:ring-violet-500 focus:bg-white focus:shadow-sm transition-all duration-200",placeholder:"Vendor/Contractor",onInput:F},null,40,cs),[[J,u.party]])]),s("td",us,[R(s("select",{"onUpdate:modelValue":v=>u.status=v,class:"w-full h-full px-4 py-0 border-0 bg-transparent text-sm focus:ring-2 focus:ring-violet-500 focus:bg-white focus:shadow-sm transition-all duration-200",onChange:F},[(j(!0),k(Q,null,Y(g(et),v=>(j(),k("option",{key:v,value:v},S(v),9,ms))),128))],40,ds),[[_t,u.status]])]),s("td",ps,[R(s("input",{"onUpdate:modelValue":v=>u.percentComplete=v,type:"number",min:"0",max:"100",step:"1",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-violet-500 focus:border-transparent",onInput:F},null,40,gs),[[J,u.percentComplete,void 0,{number:!0}]])]),s("td",fs,[s("input",{value:g(W)(u.currentPaid),onInput:v=>at(v,u,"currentPaid"),type:"text",class:"w-full h-full px-2 py-0 text-right border-0 bg-transparent rounded-none text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0"},null,40,hs)]),s("td",ys,S(g(D)(u.amountDue)),1),s("td",vs,[R(s("input",{"onUpdate:modelValue":v=>u.comments=v,type:"text",class:"w-full h-full px-4 py-0 border-0 bg-transparent text-sm focus:ring-2 focus:ring-violet-500 focus:bg-white focus:shadow-sm transition-all duration-200",placeholder:"Comments",onInput:F},null,40,xs),[[J,u.comments]])]),s("td",bs,[s("button",{type:"button",class:"inline-flex items-center justify-center w-8 h-8 rounded-md text-red-600 hover:text-white hover:bg-red-600 transition-colors",onClick:v=>Nt(l.id,u.id),title:"Delete item"},[C(g(xt),{class:"w-4 h-4"})],8,ws)])]))),128))],64))),128)),s("tr",_s,[o[39]||(o[39]=s("td",{class:"px-6 py-4 text-sm text-violet-800 font-bold",colspan:"5"},[s("div",{class:"flex items-center gap-2"},[s("div",{class:"w-3 h-3 bg-gradient-to-r from-violet-500 to-purple-500 rounded-full"}),P(" TOTALS ")])],-1)),s("td",Cs,S(g(D)(m.value.totals.projected)),1),s("td",js,S(g(D)(m.value.totals.actual)),1),s("td",{class:H(["px-6 py-4 text-sm font-bold text-right",g(ut)(m.value.totals.variance)])},S(g(D)(m.value.totals.variance)),3),o[40]||(o[40]=s("td",{class:"px-6 py-4 text-sm text-gray-600"},null,-1)),o[41]||(o[41]=s("td",{class:"px-6 py-4 text-sm text-gray-600"},null,-1)),o[42]||(o[42]=s("td",{class:"px-6 py-4 text-sm text-gray-600"},null,-1)),s("td",Ts,S(g(D)(m.value.totals.currentPaid)),1),s("td",Ss,S(g(D)(m.value.totals.amountDue)),1),o[43]||(o[43]=s("td",{class:"px-6 py-4 text-sm text-gray-600"},null,-1)),o[44]||(o[44]=s("td",{class:"px-6 py-4 text-sm text-gray-600"},null,-1))])])])])]))])])]),C(ue,{"is-visible":c.value,onClose:Ut},null,8,["is-visible"]),C(Le,{"is-visible":f.value,onClose:nt,onCreate:Mt},null,8,["is-visible"]),p.value?(j(),k("div",Es,[o[49]||(o[49]=s("div",{class:"absolute inset-0 bg-black/30"},null,-1)),s("div",ks,[s("div",$s,[s("div",Ps,[C(g(it),{class:"w-5 h-5 text-violet-600"}),o[46]||(o[46]=s("h3",{class:"text-base font-semibold text-gray-800"},"Create New Estimate",-1))]),s("button",{onClick:gt,class:"text-gray-400 hover:text-gray-600"},[C(g(Ct),{class:"w-5 h-5"})])]),s("div",Is,[s("div",null,[o[47]||(o[47]=s("label",{class:"text-sm font-medium text-gray-700"},"Project Title",-1)),R(s("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>y.value=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent",placeholder:"Enter project title",onKeyup:dt(rt,["enter"])},null,544),[[J,y.value]])]),s("div",null,[o[48]||(o[48]=s("label",{class:"text-sm font-medium text-gray-700"},"Location",-1)),R(s("input",{"onUpdate:modelValue":o[3]||(o[3]=l=>i.value=l),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent",placeholder:"Enter project location",onKeyup:dt(rt,["enter"])},null,544),[[J,i.value]])])]),s("div",{class:"px-5 py-4 border-t border-gray-200 flex items-center justify-end gap-2 bg-gray-50 rounded-b-xl"},[s("button",{onClick:gt,class:"px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-100"},"Cancel"),s("button",{onClick:rt,class:"px-4 py-2 rounded-md bg-gradient-to-r from-violet-600 to-violet-700 text-white hover:from-violet-700 hover:to-violet-800"},"Create")])])])):V("",!0)]))}},Xs=bt(Fs,[["__scopeId","data-v-2363da27"]]);export{Xs as default};
