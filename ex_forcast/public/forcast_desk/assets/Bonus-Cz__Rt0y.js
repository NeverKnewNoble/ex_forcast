var vt=Object.defineProperty;var ue=Object.getOwnPropertySymbols;var ft=Object.prototype.hasOwnProperty,bt=Object.prototype.propertyIsEnumerable;var ie=(l,a,n)=>a in l?vt(l,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[a]=n,de=(l,a)=>{for(var n in a||(a={}))ft.call(a,n)&&ie(l,n,a[n]);if(ue)for(var n of ue(a))bt.call(a,n)&&ie(l,n,a[n]);return l};var O=(l,a,n)=>new Promise((i,r)=>{var u=c=>{try{d(n.next(c))}catch(w){r(w)}},v=c=>{try{d(n.throw(c))}catch(w){r(w)}},d=c=>c.done?i(c.value):Promise.resolve(c.value).then(u,v);d((n=n.apply(l,a)).next())});import{h as S,X as Me,_ as pt,l as U,J as mt,p as $,m as xt,n as ht,q as j,I as yt,U as _t,c as y,b as t,e as C,t as ce,j as K,u as p,i as I,w as wt,T as Ct,F as k,d as B,v as _,x as M,o as h,B as G,L as Bt,M as ge,N as ve,Q as St,C as Tt}from"./index-BbtVxGeo.js";import{u as kt,C as Et,a as fe}from"./yearSettingsStore-CilQFo7d.js";import{c as W,d as Pt,_ as Mt,E as At,T as Dt,a as Vt,D as jt,R as be,X as Lt,S as Ft,B as Rt,F as Q,b as pe,f as qt}from"./SettingsModal-1hy0bolw.js";import{g as It}from"./index-BIXvTuUj.js";import"./advanced_settings-CxjuzcaQ.js";import{l as Nt}from"./data_service-BaNe30yv.js";import{ai as Ae,aj as D,o as ae,q as me,s as xe,t as he,u as ye,v as _e,w as we,x as Ce,f as $t,B as Yt,ab as Ot,ac as Be,ag as Se,ah as Ut}from"./LoadingState.vue_vue_type_style_index_0_scoped_3ea85f6c_lang-Cuz6ojxz.js";import{N as Ht,h as Jt,g as zt,a as Kt,c as Wt,d as Qt,j as Xt,k as Gt,l as Zt,m as eo,p as to,q as oo,t as ao,u as so,x as no,z as ro}from"./NoYearsSelectedState-CH23kWNU.js";import{u as lo}from"./useCalculationCache-D_UHbahk.js";import{P as uo,p as x,f as Z,b as L,u as io}from"./payroll_data_service-BzVD1VR-.js";import{c as X,a as co,C as go,T as vo}from"./cloneDeep-DsfYDpDt.js";import{L as fo}from"./loader-circle-C4xYbVfY.js";import{P as bo}from"./plus-x10FG7MU.js";import{F as po}from"./funnel-Bce4BdGF.js";import{C as mo}from"./chart-column-DM64PE73.js";import{U as xo}from"./users-DhiAcbUM.js";import"./createLucideIcon-BMj80q4R.js";import"./zap-CUuR70sR.js";class ho extends uo{constructor(){super(),this.bonusFields={bonus:{payroll_unique_id:null,fields:["bonus_percentage"]}},this.bonusValidationRules={required:["payroll_unique_id"],numeric:["bonus_percentage"],minValues:{bonus_percentage:0},maxValues:{bonus_percentage:100}}}transformBonusApiToFrontend(a,n,i=null,r=null){try{if(!a||!a.message)throw new Error("Invalid bonus API response structure");const u={};return Object.keys(a.message).forEach(v=>{if(i&&r){const c=parseInt(v),w=parseInt(i),E=parseInt(r);if(c<w||c>E)return}u[v]||(u[v]={});const d=a.message[v];d&&d.bonus&&Object.keys(d.bonus).forEach(c=>{const w=d.bonus[c];u[v][c]={bonusPercentage:w.bonus_percentage||0,payroll_unique_id:c}})}),{bonusData:u,projectName:n,totalBonusEntries:Object.keys(u).reduce((v,d)=>v+Object.keys(u[d]).length,0)}}catch(u){throw console.error("Error transforming bonus API to frontend:",u),new Error(`Failed to transform bonus API data: ${u.message}`)}}transformBonusFrontendToApi(a,n){try{if(!n)throw new Error("Project name is required");return{changes:a.map(r=>({year:r.year,bonus:Object.keys(r.bonus).reduce((u,v)=>(u[v]={bonus_percentage:parseFloat(r.bonus[v].bonus_percentage)||0},u),{})})),project:n}}catch(i){throw console.error("Error transforming bonus frontend to API:",i),new Error(`Failed to transform bonus frontend data: ${i.message}`)}}transformBonusItem(a,n){try{return a.payroll_unique_id?{id:a.unique_id||`bonus_${a.payroll_unique_id}_${n}`,payroll_unique_id:a.payroll_unique_id,year:n,unique_id:a.unique_id,bonusPercentage:a.bonus_percentage||0}:(console.warn("Bonus item missing payroll_unique_id:",a),null)}catch(i){return console.error("Error transforming bonus item:",i,a),null}}transformBonusRowToApiFormat(a,n,i){try{const r={payroll_unique_id:a.payroll_unique_id,year:n,bonus_percentage:parseFloat(a.bonusPercentage)||0};return a.unique_id&&(r.unique_id=a.unique_id),r}catch(r){return console.error("Error transforming bonus row to API format:",r,a),null}}validateBonusData(a,n="frontend"){const i=[],r=[];try{return n==="frontend"?this.validateBonusFrontendData(a,i,r):this.validateBonusApiData(a,i,r)}catch(u){return i.push(`Bonus validation error: ${u.message}`),{isValid:!1,errors:i,warnings:r}}}validateBonusFrontendData(a,n,i){return!a||typeof a!="object"?(n.push("Bonus data must be an object"),{isValid:!1,errors:n,warnings:i}):(Object.keys(a).forEach(r=>{if(!a[r]||typeof a[r]!="object"){n.push(`Year ${r}: Bonus data must be an object`);return}Object.keys(a[r]).forEach(u=>{const v=a[r][u];v.payroll_unique_id||n.push(`Row ${u}: payroll_unique_id is required`);const d=parseFloat(v.bonusPercentage);(isNaN(d)||d<0)&&n.push(`Row ${u}: bonus_percentage must be a positive number`),d>100&&n.push(`Row ${u}: bonus_percentage cannot exceed 100%`)})}),{isValid:n.length===0,errors:n,warnings:i})}validateBonusApiData(a,n,i){return a.message?(Object.keys(a.message).forEach(r=>{const u=a.message[r];if(!u||!u.bonus||typeof u.bonus!="object"){n.push(`Year ${r}: Bonus data must be an object with 'bonus' property`);return}Object.keys(u.bonus).forEach(v=>{const d=u.bonus[v];if(!d||typeof d!="object"){n.push(`Year ${r}, Row ${v}: Invalid bonus item structure`);return}isNaN(parseFloat(d.bonus_percentage))&&n.push(`Year ${r}, Row ${v}: Invalid bonus_percentage value`),parseFloat(d.bonus_percentage)>100&&n.push(`Year ${r}, Row ${v}: bonus_percentage cannot exceed 100%`)})}),{isValid:n.length===0,errors:n,warnings:i}):(n.push("Bonus API response must contain message property"),{isValid:!1,errors:n,warnings:i})}createDefaultBonusRow(a=null){const n={id:this.generateRowId(),year:new Date().getFullYear().toString(),bonusPercentage:0};return a&&(n.payroll_unique_id=a.unique_id),n}getBonusFieldDefinitions(){return this.bonusFields}getBonusValidationRules(){return this.bonusValidationRules}}const De=new ho,A=S({}),H=S([]),Te=S(!1),ke=S("");function ee(l,a=null,n=null){return O(this,null,function*(){try{const i=new URLSearchParams;l&&i.append("project",l),a&&i.append("fromYear",a.toString()),n&&i.append("toYear",n.toString());const r=`/api/v2/method/ex_forcast.api.call_and_save_bonus_data.bonus_data_display?${i.toString()}`,u=yield Me(r);if(u.error)throw new Error(u.error);const v=u.data||u,d=De.transformBonusApiToFrontend({message:v},l,a,n);return A.value=d.bonusData||{},d}catch(i){throw console.error("Error fetching bonus data:",i),new Error(`Failed to fetch bonus data: ${i.message}`)}})}function yo(l,a){return O(this,null,function*(){try{Te.value=!0,ke.value="";const n=De.transformBonusFrontendToApi(l,a),r=yield Me("/api/v2/method/ex_forcast.api.call_and_save_bonus_data.upsert_bonus_data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({changes:n.changes,project:a})});if(r.success===!1)throw new Error(r.error||"Failed to save bonus data");return H.value=[],r}catch(n){throw console.error("Error saving bonus changes:",n),ke.value=n.message,n}finally{Te.value=!1}})}function Ee(l,a,n,i){H.value=H.value.filter(r=>!(r.rowId===l&&r.fieldType===a&&r.year===n)),H.value.push({rowId:l,fieldType:a,year:n,newValue:i,timestamp:Date.now()})}function Pe(){return H.value.length>0}function se(){H.value=[]}function _o(){const l={};return H.value.forEach(a=>{l[a.year]||(l[a.year]={}),l[a.year][a.rowId]||(l[a.year][a.rowId]={}),a.fieldType==="bonus_percentage"&&(l[a.year][a.rowId].bonus_percentage=a.newValue)}),Object.keys(l).map(a=>({year:a,bonus:l[a]}))}function F(l,a){if(!A.value[a]||!A.value[a][l.id])return"0.00";const n=A.value[a][l.id].bonusPercentage||0;return Ae(n)}function wo(l,a,n,i){const r=F(l,n).replace(/[^\d.-]/g,"")/100,u=i(l.id,"count",n,a),v=l.salary||0,d=(u||0)*v*r;return D(d)}function Co(l,a,n,i){let r=0;const u=F(l,a).replace(/[^\d.-]/g,"")/100,v=l.salary||0;return n.forEach(d=>{const c=i(l.id,"count",a,d);r+=(c||0)*v*u}),D(r)}function Bo(l,a,n,i,r,u){const v=l.filter(c=>c.position==="Manager");let d=0;return v.forEach(c=>{const w=F(c,r).replace(/[^\d.-]/g,"")/100,E=u(c.id,"count",r,i),V=c.salary||0;d+=(E||0)*V*w}),D(d)}function So(l,a,n,i,r,u){const v=l.filter(c=>c.position==="Manager");let d=0;return v.forEach(c=>{const w=F(c,i).replace(/[^\d.-]/g,"")/100,E=c.salary||0;r.forEach(V=>{const J=u(c.id,"count",i,V);d+=(J||0)*E*w})}),D(d)}function To(l,a,n,i,r,u){const v=l.filter(c=>c.position!=="Manager");let d=0;return v.forEach(c=>{const w=F(c,r).replace(/[^\d.-]/g,"")/100,E=u(c.id,"count",r,i),V=c.salary||0;d+=(E||0)*V*w}),D(d)}function ko(l,a,n,i,r,u){const v=l.filter(c=>c.position!=="Manager");let d=0;return v.forEach(c=>{const w=F(c,i).replace(/[^\d.-]/g,"")/100,E=c.salary||0;r.forEach(V=>{const J=u(c.id,"count",i,V);d+=(J||0)*E*w})}),D(d)}function Eo(l,a,n,i,r,u){let v=0;return l.forEach(d=>{const c=F(d,r).replace(/[^\d.-]/g,"")/100,w=u(d.id,"count",r,i),E=d.salary||0;v+=(w||0)*E*c}),D(v)}function Po(l,a,n,i,r,u){let v=0;return l.forEach(d=>{const c=F(d,i).replace(/[^\d.-]/g,"")/100,w=d.salary||0;r.forEach(E=>{const V=u(d.id,"count",i,E);v+=(V||0)*w*c})}),D(v)}function Mo(l,a,n,i){if(!l||!Array.isArray(l)||l.length===0)return D(0);let r=0;return l.forEach(u=>{const v=F(u,n).replace(/[^\d.-]/g,"")/100,d=i(u.id,"count",n,a),c=u.salary||0;r+=(d||0)*c*v}),D(r)}function Ao(l,a,n,i){if(!l||!Array.isArray(l)||l.length===0)return D(0);let r=0;return l.forEach(u=>{const v=F(u,a).replace(/[^\d.-]/g,"")/100,d=u.salary||0;n.forEach(c=>{const w=i(u.id,"count",a,c);r+=(w||0)*d*v})}),D(r)}function Do(l,a,n,i,r){if(!l||!Array.isArray(l)||l.length===0||!a)return D(0);let u=0;return l.forEach(v=>{const d=F(v,i).replace(/[^\d.-]/g,"")/100,c=r(v.id,"count",i,n),w=v.salary||0;u+=(c||0)*w*d}),D(u/a)}function Vo(l,a,n,i,r){if(!l||!Array.isArray(l)||l.length===0||!a)return D(0);let u=0;return l.forEach(v=>{const d=F(v,n).replace(/[^\d.-]/g,"")/100,c=v.salary||0;i.forEach(w=>{const E=r(v.id,"count",n,w);u+=(E||0)*c*d})}),D(u/a)}const jo={class:"flex"},Lo={class:"flex-1 min-h-screen bg-gradient-to-br from-white to-violet-50"},Fo={class:"flex"},Ro={key:2,class:"text-violet-700 text-sm font-medium"},qo={class:"mb-8"},Io={class:"flex items-center gap-3 mb-2"},No={class:"w-12 h-12 bg-gradient-to-br from-violet-500 to-violet-600 rounded-xl flex items-center justify-center shadow-lg"},$o={class:"bg-white rounded-xl p-4 mb-6 border border-gray-200 shadow-sm"},Yo={class:"flex items-center justify-between"},Oo={class:"flex items-center gap-2"},Uo={key:0,class:"flex items-center gap-2 text-sm font-medium text-red-600 bg-red-50 px-3 py-2 rounded-lg border border-red-200"},Ho={key:1,class:"flex items-center gap-2 text-sm font-medium text-green-600 bg-green-50 px-3 py-2 rounded-lg border border-green-200"},Jo=["disabled"],zo={key:1,class:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg cursor-not-allowed"},Ko={key:0,class:"mt-2 text-xs text-red-500 flex items-center gap-1"},Wo={class:"mb-8"},Qo={class:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2"},Xo={class:"flex gap-2 mt-3"},Go={class:"flex-1"},Zo={class:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm"},ea={class:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"},ta={class:"space-y-4"},oa={class:"grid grid-cols-2 gap-3"},aa={class:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-1"},sa=["value"],na={class:"text-sm font-medium text-gray-700 mb-2 flex items-center gap-1"},ra=["value"],la={class:"flex gap-2"},ua={class:"mt-4"},ia={class:"bg-white rounded-xl p-5 border border-gray-200 shadow-sm"},da={class:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"},ca={class:"space-y-3"},ga={class:"relative"},va={class:"bg-gray-50 rounded-lg p-4 border border-gray-100"},fa={class:"text-xs text-gray-500 mt-2 text-center"},ba={class:"flex-1 p-4"},pa={class:"mb-4"},ma={class:"flex items-center gap-2"},xa={class:"w-6 h-6 bg-gradient-to-br from-violet-500 to-violet-600 rounded-lg flex items-center justify-center"},ha={key:1,class:"bg-white rounded-lg border border-violet-200 shadow-sm overflow-hidden md:max-w-[1800px] lg:max-w-[1800px] xl:max-w-[2000px] 2xl:max-w-[2000px]"},ya={class:"overflow-x-auto max-w-[100%] md:max-w-[1800px] lg:max-w-[1800px] xl:max-w-[2000px] 2xl:max-w-[2000px]"},_a={class:"min-w-full w-max"},wa={class:"w-full"},Ca={class:"bg-gradient-to-r from-violet-600 to-violet-700 text-white"},Ba={rowspan:"3",class:"px-3 py-2 text-left align-middle border-r border-violet-400 font-semibold text-sm"},Sa={class:"flex items-center gap-1"},Ta={rowspan:"3",class:"px-3 py-2 text-left align-middle border-r border-violet-400 font-semibold text-sm"},ka={class:"flex items-center gap-1"},Ea={rowspan:"3",class:"px-3 py-2 text-center align-middle border-r border-violet-400 font-semibold text-sm"},Pa={class:"flex items-center gap-1"},Ma={rowspan:"3",class:"px-3 py-2 text-center align-middle border-r border-violet-400 font-semibold text-sm"},Aa={class:"flex items-center gap-1"},Da={rowspan:"3",class:"px-3 py-2 text-center align-middle border-r border-violet-400 font-semibold text-sm"},Va={class:"flex items-center gap-1"},ja={key:0,colspan:"12",class:"px-2 py-2 text-center border-x-2 border-white font-semibold text-sm"},La={class:"flex items-center justify-center gap-1"},Fa={class:"font-semibold"},Ra={class:"bg-violet-500/90 text-xs"},qa={key:0,colspan:"12",class:"px-2 py-1 text-center border border-violet-300 font-medium"},Ia={class:"bg-violet-400/90 text-xs"},Na={class:"text-gray-700 bg-white text-sm"},$a={class:"bg-violet-100 border-b-2 border-violet-300"},Ya=["colspan"],Oa={class:"bg-violet-50 border-b border-violet-200"},Ua=["colspan"],Ha={class:"px-3 py-2 font-medium border-r border-violet-200 text-gray-700"},Ja={class:"px-3 py-2 font-medium border-r border-violet-200 text-gray-700"},za={class:"px-3 py-2 text-right border-r border-violet-200 font-mono text-sm"},Ka=["onInput","onFocus","onBlur"],Wa={class:"font-mono text-xs text-violet-700"},Qa={class:"font-mono text-xs"},Xa={class:"font-mono text-xs text-orange-700"},Ga={class:"font-mono text-xs text-orange-700"},Za={class:"border-b border-gray-300 bg-gradient-to-r from-violet-100 to-purple-100 shadow-sm"},es={colspan:3,class:"px-3 py-2.5 font-semibold border-r border-violet-300 text-violet-900"},ts={class:"flex items-center gap-2"},os={class:"px-3 py-2.5 text-right border-r border-violet-300"},as={class:"font-mono text-sm font-semibold text-violet-900"},ss={class:"font-mono text-xs text-violet-900"},ns={class:"font-mono text-xs text-orange-900"},rs={class:"px-2 py-1.5 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-semibold"},ls={class:"font-mono text-xs text-orange-900"},us={class:"border-b border-gray-300 bg-gradient-to-r from-violet-100 to-purple-100 shadow-sm"},is={colspan:3,class:"px-3 py-2.5 font-semibold border-r border-violet-300 text-violet-900"},ds={class:"flex items-center gap-2"},cs={class:"px-3 py-2.5 text-right border-r border-violet-300"},gs={class:"font-mono text-sm font-semibold text-violet-900"},vs={class:"font-mono text-xs text-violet-900"},fs={class:"font-mono text-xs text-orange-900"},bs={class:"px-2 py-1.5 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-semibold"},ps={class:"font-mono text-xs text-orange-900"},ms={class:"border-b-2 border-violet-400 bg-gradient-to-r from-violet-100 to-purple-100 shadow-sm"},xs={colspan:3,class:"px-3 py-3 font-bold border-r border-violet-300 text-violet-900"},hs={class:"flex items-center gap-2"},ys={class:"px-3 py-3 text-right border-r border-violet-300"},_s={class:"font-mono text-sm font-bold text-violet-900"},ws={class:"font-mono text-xs text-violet-900"},Cs={class:"font-mono text-xs text-orange-900"},Bs={class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},Ss={class:"font-mono text-xs text-orange-900"},Ts={class:"border-b-2 border-violet-400 bg-gradient-to-r from-violet-100 to-indigo-100 shadow-sm"},ks={colspan:3,class:"px-3 py-3 font-bold border-r border-violet-300 text-violet-900"},Es={class:"flex items-center gap-2"},Ps={class:"px-3 py-3 text-right border-r border-violet-300"},Ms={class:"font-mono text-sm font-bold text-violet-900"},As={class:"font-mono text-xs text-violet-900"},Ds={class:"font-mono text-xs text-orange-900"},Vs={class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},js={class:"font-mono text-xs text-orange-900"},Ls={class:"border-b-2 border-green-400 bg-gradient-to-r from-green-100 to-emerald-100 shadow-sm"},Fs={colspan:3,class:"px-3 py-3 font-bold border-r border-green-300 text-green-900"},Rs={class:"flex items-center gap-2"},qs={class:"px-3 py-3 text-right border-r border-green-300"},Is={class:"font-mono text-sm font-bold text-green-900"},Ns={class:"font-mono text-xs text-green-900"},$s={class:"font-mono text-xs text-orange-900"},Ys={class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},Os={class:"font-mono text-xs text-orange-900"},Us={__name:"Bonus",setup(l){const a=S([]),n=S("monthly"),i=S(!1),r=S({}),u=S(!1),v=S({}),d=S([]),c=S(!1),w=S(""),E=S(!1),V=S(!1),J=S(!1);S(""),S(""),S(""),S(!1),S(!1),S(!1),S(!1);const N=S(0),te=U(()=>me(N.value)),T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];lo();const oe=kt(),{fromYear:R,toYear:q,advancedModes:ne}=mt(oe),{setFromYear:Hs,setToYear:Js,setAdvancedModes:zs,clearYearSettings:Ks,getFilteredToYears:Ve}=oe,b=U(()=>It(R.value,q.value)),je=U(()=>Ve(a.value)),Le=U(()=>Jt(x.value)),re=U(()=>d.value.length>0||Pe());U(()=>{if(!b.value.length||!x.value.length)return 0;const s=b.value[0];let e=0;return x.value.forEach(o=>{T.forEach(f=>{const g=P(o.id,"count",s,f);e+=g||0})}),e}),U(()=>{if(!b.value.length||!x.value.length)return 0;const s=b.value[0];let e=0;return x.value.forEach(o=>{T.forEach(f=>{const g=P(o.id,"count",s,f),m=o.salary||0;e+=(g||0)*m})}),e}),$(b,()=>{b.value.forEach(s=>{ne.value[s]||oe.setAdvancedMode(s,n.value)}),window.__currentVisibleYears=b.value}),$(L,(s,e)=>{},{deep:!0,immediate:!0}),$(A,(s,e)=>{window.__bonusData=s},{deep:!0,immediate:!0}),$(x,(s,e)=>{if(!s||!Array.isArray(s)){x.value=[];return}s&&e&&s.forEach((o,f)=>{const g=e[f];if(g&&(o.salary!==g.salary||o.count!==g.count)&&b.value.length>0){const m=b.value[0];L.value[m]||(L.value[m]={}),L.value[m][o.id]||(L.value[m][o.id]={}),Ot(o.id,m,L),Be(o.id,m,L),L.value[m][o.id]._lastUpdate=Date.now(),o.salary!==g.salary&&T.forEach(z=>{const gt=(P(o.id,"count",m,z)||0)*(o.salary||0);Be(o.id,m,L),L.value[m][o.id].salary[z]=gt})}})},{deep:!0}),$(i,s=>{s&&(r.value=de({},ne.value))}),xt(()=>O(this,null,function*(){try{yield ht(),yield new Promise(e=>setTimeout(e,100)),a.value=yield Nt(),(!x.value||!Array.isArray(x.value))&&(x.value=[]),j.value&&(yield Z(j.value.project_name,R.value,q.value),yield ee(j.value.project_name,R.value,q.value),window.__currentVisibleYears=b.value,window.__bonusData=A.value),v.value=X(x.value),u.value=!0,J.value=!0;const s=localStorage.getItem("totalRooms");s&&(N.value=parseInt(s)||100),localStorage.getItem("showRefreshSuccess")==="true"&&(localStorage.removeItem("showRefreshSuccess"),W.success("Page refreshed successfully"))}catch(s){console.error("Error loading data:",s)}})),$(j,(s,e)=>O(this,null,function*(){if(s)try{yield Z(s.project_name,R.value,q.value),v.value=X(x.value),yield ee(s.project_name,R.value,q.value),window.__currentVisibleYears=b.value,window.__bonusData=A.value,d.value=[],se(),u.value=!0,w.value="",W.success(`Switched to project: ${s.project_name}`)}catch(o){console.error("Error reloading Payroll data for new project:",o),W.error("Failed to load project data. Please try again.")}else x.value=[],v.value=X(x.value),d.value=[],se(),u.value=!0,w.value=""}),{deep:!0}),$([R,q],(g,m)=>O(this,[g,m],function*([s,e],[o,f]){if(j.value&&s&&e&&(s!==o||e!==f))try{yield Z(j.value.project_name,s,e),yield ee(j.value.project_name,s,e),v.value=X(x.value),window.__currentVisibleYears=b.value,window.__bonusData=A.value,d.value=[],u.value=!0,w.value=""}catch(z){console.error("Error reloading Payroll data for new year range:",z),W.error("Failed to load data for selected year range. Please try again.")}}),{deep:!0});const Fe=()=>O(this,null,function*(){var s,e,o,f;try{c.value=!0,w.value="";let g=!1;if(d.value.length>0){const m=yield io(d.value,(s=j.value)==null?void 0:s.project_name);d.value=[],g=!0}if(Pe()){const m=_o();yield yo(m,(e=j.value)==null?void 0:e.project_name),se(),g=!0}if(!g){c.value=!1;return}yield Z((o=j.value)==null?void 0:o.project_name,R.value,q.value),yield ee((f=j.value)==null?void 0:f.project_name,R.value,q.value),v.value=X(x.value),window.__currentVisibleYears=b.value,window.__bonusData=A.value,u.value=!0,W.success("Changes saved successfully"),c.value=!1}catch(g){w.value=g.message||"Failed to save changes",W.error(w.value),c.value=!1}});$(u,s=>{s?window.removeEventListener("beforeunload",ae):window.addEventListener("beforeunload",ae)}),yt(()=>{window.removeEventListener("beforeunload",ae)}),$(N,s=>{localStorage.setItem("totalRooms",s.toString())}),setInterval(()=>{const s=localStorage.getItem(_t("totalNumberOfRooms"));if(s&&parseInt(s)>0){const e=parseInt(s);e!==N.value&&me.value&&(N.value=e,localStorage.setItem("totalRooms",e.toString()))}},1e3);function P(s,e,o,f){if(e==="count"&&f)return xe(s,o,f,x,L);if(e==="salary"&&f){const g=xe(s,o,f,x,L),m=x.value.find(z=>z.id===s);return m?(g||0)*(m.salary||0):0}return zt(x.value,L,s,e,o,f)}function Re(){return Kt(x.value)}function qe(s){return Xt(x.value,s)}function Y(s,e){return Gt(x.value,s,e)}function Ie(s,e){return Zt(x.value,s,e)}function Ne(s,e,o,f){return eo(x.value,s,e,o,f,P)}function $e(s,e){return to(x.value,s,e)}function Ye(s,e,o,f){return oo(x.value,s,e,o,f,P)}function Oe(s,e){return ao(x.value,s,e)}function Ue(s,e,o,f){return so(x.value,s,e,o,f,P)}function He(){return!x.value||!Array.isArray(x.value)?0:Wt(x.value)}function Je(s,e){return!x.value||!Array.isArray(x.value)?0:no(x.value,s,e,P)}function ze(){return!x.value||!Array.isArray(x.value)?0:Qt(x.value,N.value)}function Ke(s,e){return!x.value||!Array.isArray(x.value)?0:ro(x.value,s,e,P,N.value)}function le(s){return F(s,b.value[0])}function We(s,e){return wo(s,e,b.value[0],P)}function Qe(s,e,o,f){const g=parseFloat(e.target.textContent.replace(/[^\d.-]/g,""))||0,m=f[0];A.value[m]||(A.value[m]={}),A.value[m][s.id]||(A.value[m][s.id]={}),A.value[m][s.id].bonusPercentage=g,Ee(s.id,"bonus_percentage",m,g)}function Xe(s,e){e.target.textContent=le(s).replace(/[^\d.-]/g,"")}function Ge(s,e,o,f){const g=parseFloat(e.target.textContent.replace(/[^\d.-]/g,""))||0;e.target.textContent=Ae(g);const m=f[0];A.value[m]||(A.value[m]={}),A.value[m][s.id]||(A.value[m][s.id]={}),A.value[m][s.id].bonusPercentage=g,Ee(s.id,"bonus_percentage",m,g)}function Ze(s){return Co(s,b.value[0],T,P)}function et(s,e,o,f){return Bo(s,e,o,f,b.value[0],P)}function tt(s,e,o){return So(s,e,o,b.value[0],T,P)}function ot(s,e,o,f){return To(s,e,o,f,b.value[0],P)}function at(s,e,o){return ko(s,e,o,b.value[0],T,P)}function st(s,e,o,f){return Eo(s,e,o,f,b.value[0],P)}function nt(s,e,o){return Po(s,e,o,b.value[0],T,P)}function rt(s){return Mo(x.value,s,b.value[0],P)}function lt(){return Ao(x.value,b.value[0],T,P)}function ut(s,e,o){return Do(s,e,o,b.value[0],P)}function it(s,e){return Vo(s,e,b.value[0],T,P)}function dt(){V.value=!0}function ct(){V.value=!1}return(s,e)=>(h(),y(k,null,[t("div",jo,[C(Mt,{onOpenSettings:dt}),t("div",Lo,[t("div",Fo,[t("div",{class:ce(["bg-gradient-to-b from-white to-gray-50 border-r border-gray-200 min-h-screen flex flex-col shadow-sm transition-all duration-300",E.value?"w-14 p-2":"w-80 p-6"])},[t("button",{onClick:e[0]||(e[0]=o=>E.value=!E.value),class:"mb-4 flex items-center gap-2 px-2 py-1 bg-violet-100 hover:bg-violet-200 rounded transition-all"},[E.value?(h(),K(p(Et),{key:1,class:"w-5 h-5 text-violet-700"})):(h(),K(p(co),{key:0,class:"w-5 h-5 text-violet-700"})),E.value?I("",!0):(h(),y("span",Ro,"Collapse"))]),C(Ct,{name:"fade"},{default:wt(()=>[G(t("div",null,[t("div",qo,[t("div",Io,[t("div",No,[C(p(At),{class:"w-7 h-7 mx-2 text-white"})]),e[12]||(e[12]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Bonus",-1))]),e[13]||(e[13]=t("p",{class:"text-sm text-gray-500"},"Manage and configure your bonus data",-1))]),t("div",$o,[t("div",Yo,[t("div",Oo,[re.value?(h(),y("div",Uo,[C(p(Dt),{class:"w-4 h-4 text-red-600"}),e[14]||(e[14]=B(" Unsaved "))])):(h(),y("div",Ho,[C(p(Vt),{class:"w-4 h-4 text-green-600"}),e[15]||(e[15]=B(" All Saved "))]))]),!c.value&&re.value?(h(),y("button",{key:0,disabled:c.value,onClick:Fe,class:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-violet-600 to-violet-700 text-white rounded-lg hover:from-violet-700 hover:to-violet-800 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105"},[C(p(jt),{class:"w-4 h-4"}),e[16]||(e[16]=B(" Save "))],8,Jo)):I("",!0),c.value?(h(),y("button",zo,[C(p(fo),{class:"w-4 h-4 animate-spin"}),e[17]||(e[17]=B(" Saving... "))])):I("",!0)]),w.value?(h(),y("span",Ko,[C(p(go),{class:"w-3 h-3"}),B(" "+_(w.value),1)])):I("",!0)]),t("div",Wo,[t("h3",Qo,[C(p(bo),{class:"w-4 h-4 text-violet-600"}),e[18]||(e[18]=B(" Quick Actions "))]),t("div",Xo,[t("button",{onClick:e[1]||(e[1]=(...o)=>p(he)&&p(he)(...o)),class:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-violet-200 text-violet-700 rounded-lg hover:bg-violet-50 transition-all text-sm font-medium"},[C(p(be),{class:"w-4 h-4"}),e[19]||(e[19]=B(" Refresh "))])])]),t("div",Go,[t("div",Zo,[t("h3",ea,[C(p(po),{class:"w-5 h-5 text-violet-600"}),e[20]||(e[20]=B(" Year Range Filter "))]),t("div",ta,[t("div",oa,[t("div",null,[t("label",aa,[C(p(fe),{class:"w-3 h-3 text-gray-500"}),e[21]||(e[21]=B(" From Year "))]),G(t("select",{disabled:"","onUpdate:modelValue":e[2]||(e[2]=o=>ge(R)?R.value=o:null),class:"w-full px-3 py-2.5 rounded-lg border border-gray-300 focus:border-violet-500 focus:ring-2 focus:ring-violet-200 transition-all bg-gray-100 text-sm"},[e[22]||(e[22]=t("option",{value:""},"Select Year",-1)),(h(!0),y(k,null,M(a.value,o=>(h(),y("option",{key:"from-"+o,value:o},_(o),9,sa))),128))],512),[[ve,p(R)]])]),t("div",null,[t("label",na,[C(p(fe),{class:"w-3 h-3 text-gray-500"}),e[23]||(e[23]=B(" To Year "))]),G(t("select",{disabled:"","onUpdate:modelValue":e[3]||(e[3]=o=>ge(q)?q.value=o:null),class:"w-full px-3 py-2.5 rounded-lg border border-gray-300 focus:border-violet-500 focus:ring-2 focus:ring-violet-200 transition-all bg-gray-100 text-sm"},[e[24]||(e[24]=t("option",{value:""},"Select Year",-1)),(h(!0),y(k,null,M(je.value,o=>(h(),y("option",{key:"to-"+o,value:o},_(o),9,ra))),128))],512),[[ve,p(q)]])])]),t("div",la,[t("button",{onClick:e[4]||(e[4]=(...o)=>p(ye)&&p(ye)(...o)),class:"flex-1 flex items-center justify-center gap-2 px-3 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200 text-sm font-medium"},[C(p(Lt),{class:"w-4 h-4"}),e[25]||(e[25]=B(" Clear "))]),t("button",{disabled:"",onClick:e[5]||(e[5]=o=>i.value=!0),class:"flex-1 flex items-center justify-center gap-2 px-3 py-2.5 bg-gray-200 border border-violet-500 text-violet-700 rounded-lg hover:bg-violet-50 transition-all duration-200 text-sm font-medium"},[C(p(Ft),{class:"w-4 h-4"}),e[26]||(e[26]=B(" Advanced "))])])])]),t("div",ua,[t("div",ia,[t("h3",da,[C(p(Rt),{class:"w-5 h-5 text-violet-600"}),e[27]||(e[27]=B(" Total Number of Rooms "))]),t("div",ca,[t("div",null,[t("div",ga,[G(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>N.value=o),type:"number",disabled:"",min:"1",class:"w-full px-4 py-3 rounded-lg border bg-gray-100 border-gray-300 focus:border-violet-500 focus:ring-2 focus:ring-violet-200 transition-all text-lg font-semibold text-gray-900 rooms-input",placeholder:"Enter total number of rooms",onInput:e[7]||(e[7]=(...o)=>p(_e)&&p(_e)(...o)),onBlur:e[8]||(e[8]=(...o)=>p(we)&&p(we)(...o)),onKeyup:e[9]||(e[9]=St(o=>o.target.blur(),["enter"]))},null,544),[[Tt,N.value]]),e[28]||(e[28]=t("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3"},[t("span",{class:"text-gray-400 text-sm mr-8 font-medium"},"rooms")],-1))])]),t("div",va,[t("button",{onClick:e[10]||(e[10]=(...o)=>p(Ce)&&p(Ce)(...o)),class:ce(["w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg transition-all duration-200 text-sm font-medium shadow-sm",te.value?"bg-green-500 hover:bg-green-600 text-white shadow-green-200":"bg-violet-500 hover:bg-violet-600 text-white shadow-violet-200"])},[C(p(be),{class:"w-4 h-4"}),B(" "+_(te.value?"Synced":"Unsynced"),1)],2),t("p",fa,_(te.value?"Your total rooms are synchronized with the Room Revenue page":"Click to sync with the total rooms from Room Revenue page"),1)])])])])])],512),[[Bt,!E.value]])]),_:1})],2),t("div",ba,[p(j)?b.value.length&&J.value?(h(),y(k,{key:1},[t("div",pa,[t("div",ma,[t("div",xa,[C(p(vo),{class:"w-3 h-3 text-white"})]),e[29]||(e[29]=t("h2",{class:"text-lg font-bold text-gray-800"},"Bonus Overview",-1))])]),Le.value?(h(),y("div",ha,[t("div",ya,[t("div",_a,[t("table",wa,[t("thead",Ca,[t("tr",null,[t("th",Ba,[t("div",Sa,[C(p(Q),{class:"w-3 h-3"}),e[30]||(e[30]=B(" Position "))])]),t("th",Ta,[t("div",ka,[C(p(Q),{class:"w-3 h-3"}),e[31]||(e[31]=B(" Designation "))])]),t("th",Ea,[t("div",Pa,[C(p(Q),{class:"w-3 h-3"}),e[32]||(e[32]=B(" Salary "))])]),t("th",Ma,[t("div",Aa,[C(p(Q),{class:"w-3 h-3"}),e[33]||(e[33]=B(" Count "))])]),t("th",Da,[t("div",Va,[C(p(Q),{class:"w-3 h-3"}),e[34]||(e[34]=B(" Bonus % "))])]),b.value.length>0?(h(),y("th",ja,[t("div",La,[t("span",Fa,_(b.value[0]),1)])])):I("",!0),e[35]||(e[35]=t("th",{colspan:13,rowspan:2,class:"px-2 py-1 text-center border border-orange-300 font-medium bg-orange-500/90"}," Bonus Details ",-1))]),t("tr",Ra,[b.value.length>0?(h(),y("th",qa," Monthly Count ")):I("",!0)]),t("tr",Ia,[(h(),y(k,null,M(T,o=>t("th",{key:"count-"+o,class:"px-2 py-1 text-center border border-violet-300 min-w-[80px] font-medium"},_(o),1)),64)),(h(),y(k,null,M(T,o=>t("th",{key:"bonus-"+o,class:"px-2 py-1 text-center border border-orange-300 min-w-[80px] font-medium bg-orange-400/90"},_(o),1)),64)),e[36]||(e[36]=t("th",{class:"px-2 py-1 text-center border border-orange-300 min-w-[80px] font-medium bg-orange-400/90"}," Total ",-1))])]),t("tbody",Na,[(h(!0),y(k,null,M(Re(),o=>(h(),y(k,{key:o},[t("tr",$a,[t("td",{colspan:5+(b.value.length>0?25:0)+(b.value.length>1?b.value.length-1:0)+13,class:"px-3 py-2 font-bold text-violet-800 text-left"},_(o),9,Ya)]),(h(!0),y(k,null,M(qe(o),f=>(h(),y(k,{key:"location-"+f},[t("tr",Oa,[t("td",{colspan:5+(b.value.length>0?25:0)+(b.value.length>1?b.value.length-1:0)+13,class:"px-3 py-1.5 font-semibold text-violet-700 text-left text-sm"},_(f),9,Ua)]),(h(!0),y(k,null,M(Y(o,f),g=>(h(),y("tr",{key:g.id,class:"border-b border-gray-200 hover:bg-violet-50 transition-all duration-200"},[t("td",Ha,_(g.position),1),t("td",Ja,_(g.designation),1),(h(),y("td",{class:"px-3 py-2 text-right border-r border-violet-200 font-mono text-sm",key:g.id+"-salary"},_(p($t)(g.salary)),1)),t("td",za,_(g.count),1),(h(),y("td",{class:"px-3 py-2 text-right border-r border-violet-200 font-mono text-sm",contenteditable:"true",key:g.id+"-bonus-percentage",onInput:m=>Qe(g,m,u.value,b.value),onFocus:m=>Xe(g,m),onBlur:m=>Ge(g,m,u.value,b.value),onKeypress:e[11]||(e[11]=m=>p(Yt)(m))},[t("span",Wa,_(le(g)||"0.00")+"%",1)],40,Ka)),b.value.length>0?(h(),y(k,{key:0},M(T,m=>t("td",{key:"count-cell-"+m+"-"+(P(g.id,"count",b.value[0],m)||0),class:"px-2 py-1 text-right border border-violet-200 hover:bg-violet-50 outline-none focus:ring-2 focus:ring-violet-500 transition-all duration-200"},[t("span",Qa,_(P(g.id,"count",b.value[0],m)),1)])),64)):I("",!0),(h(),y(k,null,M(T,m=>t("td",{key:"bonus-cell-"+m+"-"+g.id,class:"px-2 py-1 text-right border border-orange-200 bg-orange-50"},[t("span",Xa,_(We(g,m)||"0.00"),1)])),64)),(h(),y("td",{class:"px-2 py-1 text-right border border-orange-200 bg-orange-50",key:g.id+"-bonus-total"},[t("span",Ga,_(Ze(g)||"0.00"),1)]))]))),128)),t("tr",Za,[t("td",es,[t("div",ts,[C(p(pe),{class:"w-4 h-4 text-violet-700"}),e[37]||(e[37]=B(" Sub-Total Management "))])]),t("td",os,[t("span",as,_(Ie(o,f)),1)]),e[38]||(e[38]=t("td",{class:"px-3 py-2.5 text-right border-r border-violet-300"},[t("span",{class:"font-mono text-sm font-semibold text-violet-900"})],-1)),b.value.length>0?(h(),y(k,{key:0},M(T,g=>t("td",{key:"subtotal-mgmt-count-"+g,class:"px-2 py-1.5 text-right border border-violet-300 bg-gradient-to-r from-violet-100 to-purple-100 font-semibold"},[t("span",ss,_(Ne(o,f,b.value[0],g)),1)])),64)):I("",!0),(h(),y(k,null,M(T,g=>t("td",{key:"subtotal-mgmt-bonus-"+g,class:"px-2 py-1.5 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-semibold"},[t("span",ns,_(et(Y(o,f),o,f,g)),1)])),64)),t("td",rs,[t("span",ls,_(tt(Y(o,f),o,f)),1)])]),t("tr",us,[t("td",is,[t("div",ds,[C(p(pe),{class:"w-4 h-4 text-violet-700"}),e[39]||(e[39]=B(" Sub-Total Non-Management "))])]),t("td",cs,[t("span",gs,_($e(o,f)),1)]),e[40]||(e[40]=t("td",{class:"px-3 py-2.5 text-right border-r border-violet-300"},[t("span",{class:"font-mono text-sm font-semibold text-violet-900"})],-1)),b.value.length>0?(h(),y(k,{key:0},M(T,g=>t("td",{key:"subtotal-nonmgmt-count-"+g,class:"px-2 py-1.5 text-right border border-violet-300 bg-gradient-to-r from-violet-100 to-purple-100 font-semibold"},[t("span",vs,_(Ye(o,f,b.value[0],g)),1)])),64)):I("",!0),(h(),y(k,null,M(T,g=>t("td",{key:"subtotal-nonmgmt-bonus-"+g,class:"px-2 py-1.5 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-semibold"},[t("span",fs,_(ot(Y(o,f),o,f,g)),1)])),64)),t("td",bs,[t("span",ps,_(at(Y(o,f),o,f)),1)])]),t("tr",ms,[t("td",xs,[t("div",hs,[C(p(mo),{class:"w-5 h-5 text-violet-700"}),e[41]||(e[41]=B(" Total "))])]),t("td",ys,[t("span",_s,_(Oe(o,f)),1)]),e[42]||(e[42]=t("td",{class:"px-3 py-3 text-right border-r border-violet-300"},[t("span",{class:"font-mono text-sm font-bold text-violet-900"})],-1)),b.value.length>0?(h(),y(k,{key:0},M(T,g=>t("td",{key:"total-count-"+g,class:"px-2 py-2 text-right border border-violet-300 bg-gradient-to-r from-violet-100 to-purple-100 font-bold"},[t("span",ws,_(Ue(o,f,b.value[0],g)),1)])),64)):I("",!0),(h(),y(k,null,M(T,g=>t("td",{key:"total-bonus-"+g,class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},[t("span",Cs,_(st(Y(o,f),o,f,g)),1)])),64)),t("td",Bs,[t("span",Ss,_(nt(Y(o,f),o,f)),1)])])],64))),128))],64))),128)),e[47]||(e[47]=t("tr",{class:"h-4 bg-gradient-to-r from-violet-100 to-indigo-100"},null,-1)),e[48]||(e[48]=t("tr",{class:"h-4 bg-gradient-to-r from-violet-100 to-indigo-100"},null,-1)),t("tr",Ts,[t("td",ks,[t("div",Es,[C(p(qt),{class:"w-5 h-5 text-violet-700"}),e[43]||(e[43]=B(" Total Hotel "))])]),t("td",Ps,[t("span",Ms,_(He()),1)]),e[44]||(e[44]=t("td",{class:"px-3 py-3 text-right border-r border-violet-300"},[t("span",{class:"font-mono text-sm font-bold text-violet-900"})],-1)),b.value.length>0?(h(),y(k,{key:0},M(T,o=>t("td",{key:"hotel-count-"+o,class:"px-2 py-2 text-right border border-violet-300 bg-gradient-to-r from-violet-100 to-indigo-100 font-bold"},[t("span",As,_(Je(b.value[0],o)),1)])),64)):I("",!0),(h(),y(k,null,M(T,o=>t("td",{key:"hotel-bonus-"+o,class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},[t("span",Ds,_(rt(o)),1)])),64)),t("td",Vs,[t("span",js,_(lt()),1)])]),t("tr",Ls,[t("td",Fs,[t("div",Rs,[C(p(xo),{class:"w-5 h-5 text-green-700"}),e[45]||(e[45]=B(" Employee/Room Ratio "))])]),t("td",qs,[t("span",Is,_(ze()),1)]),e[46]||(e[46]=t("td",{class:"px-3 py-3 text-right border-r border-green-300"},[t("span",{class:"font-mono text-sm font-bold text-green-900"})],-1)),b.value.length>0?(h(),y(k,{key:0},M(T,o=>t("td",{key:"ratio-count-"+o,class:"px-2 py-2 text-right border border-green-300 bg-gradient-to-r from-green-100 to-emerald-100 font-bold"},[t("span",Ns,_(Ke(b.value[0],o)),1)])),64)):I("",!0),(h(),y(k,null,M(T,o=>t("td",{key:"ratio-bonus-"+o,class:"px-2 py-2 text-right border border-orange-300 bg-gradient-to-r from-orange-100 to-orange-200 font-bold"},[t("span",$s,_(ut(p(x),N.value,o)),1)])),64)),t("td",Ys,[t("span",Os,_(it(p(x),N.value)),1)])])])])])])])):(h(),K(Ut,{key:0}))],64)):p(j)?(h(),K(Ht,{key:2,"from-year":p(R),"to-year":p(q)},null,8,["from-year","to-year"])):(h(),K(Se,{key:3})):(h(),K(Se,{key:0}))])])])]),C(Pt,{"is-visible":V.value,onClose:ct},null,8,["is-visible"])],64))}},pn=pt(Us,[["__scopeId","data-v-b53bdfec"]]);export{pn as default};
