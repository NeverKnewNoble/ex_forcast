var w=Object.defineProperty,M=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var D=(e,o,t)=>o in e?w(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,g=(e,o)=>{for(var t in o||(o={}))v.call(o,t)&&D(e,t,o[t]);if(_)for(var t of _(o))J.call(o,t)&&D(e,t,o[t]);return e},E=(e,o)=>M(e,A(o));var F=(e,o,t)=>new Promise((a,c)=>{var s=r=>{try{n(t.next(r))}catch(p){c(p)}},i=r=>{try{n(t.throw(r))}catch(p){c(p)}},n=r=>r.done?a(r.value):Promise.resolve(r.value).then(s,i);n((t=t.apply(e,o)).next())});import{h as f,n as L,I as S}from"./index-BwGj6WF3.js";function G(e,o){const t=parseInt(e),a=parseInt(o);if(!t||!a||t>a)return[];const c=[];for(let s=t;s<=a;s++)c.push(s);return c}const C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],j=["Jan-Mar","Apr-Jun","Jul-Sep","Oct-Dec"];function W(e){return e==="monthly"?C:j}const T={"Jan-Mar":["Jan","Feb","Mar"],"Apr-Jun":["Apr","May","Jun"],"Jul-Sep":["Jul","Aug","Sep"],"Oct-Dec":["Oct","Nov","Dec"]},q=f(!1),y=f({year:"",month:"",rows:[{department:"",department_location:"",expense:"",amount:0,amountDisplay:"",category:"",costType:""}]});function B(){y.value.rows.push({department:"",department_location:"",expense:"",amount:0,amountDisplay:"",category:"",costType:""})}function V(e){y.value.rows.length>1&&y.value.rows.splice(e,1)}function O(){y.value={year:"",month:"",rows:[{department:"",department_location:"",expense:"",amount:0,amountDisplay:"",category:"",costType:""}]}}function b(){O(),q.value=!1}const N=S({url:"frappe.client.insert",makeParams({doctype:e,doc:o}){return{doc:g({doctype:e},o)}}});function z(a){return F(this,arguments,function*({year:e,month:o,expenses:t}){const c=L.value;if(!c)throw new Error("No project selected. Please select a project first.");const s=t.map(n=>E(g({department:n.department,department_location:n.department_location,expense_name:n.expense,amount:n.amount},n.costType&&{cost_type:n.costType}),{is_default_expense:!1})),i={year:e,month:o,project:c.project_name,expense_items:s};try{return{success:!0,name:(yield N.submit({doctype:"Expense Assumptions",doc:i})).name}}catch(n){return console.error("Error creating expense document:",n),console.error("Error details:",{message:n.message,stack:n.stack,response:n.response}),{success:!1,error:n}}})}const d=f(new Set);function H(e){d.value.has(e)?d.value.delete(e):d.value.add(e)}function K(e){return d.value.has(e)}function Q(e,o){const t=e.find(a=>a.expense_name===o);return t?{code:t.code||"",costType:t.cost_type||"",hospitalityCategory:t.hospitality_category||""}:{code:"",costType:"",hospitalityCategory:""}}function k(e,o,t,a,c="monthly",s=null){var i,n,r;if(c==="quarterly"&&T[a]){const u=(((i=e==null?void 0:e[t])==null?void 0:i[a])||[]).find(m=>m.expense===o&&(!s||m.department===s));if(u)return parseFloat(u.amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});let l=0;for(const m of T[a]){const h=(((n=e==null?void 0:e[t])==null?void 0:n[m])||[]).find(x=>x.expense===o&&(!s||x.department===s));h&&(l+=parseFloat(h.amount)||0)}return l.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}else{const u=(((r=e==null?void 0:e[t])==null?void 0:r[a])||[]).find(l=>l.expense===o&&(!s||l.department===s));return u?parseFloat(u.amount).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"}}function U(e,o,t,a,c,s=null){const i=c(t);let n=0;for(const r of i){const p=k(e,o,t,r,a,s),u=parseFloat(p.toString().replace(/,/g,""));isNaN(u)||(n+=u)}return n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function X(e,o,t=[]){const a=new Map;t.forEach(s=>{const i=s.department||"Other",n=s.department_location||"Default";a.has(i)||a.set(i,new Map);const r=a.get(i);r.has(n)||r.set(n,new Map),r.get(n).set(s.expense,{expense:s.expense,isDefault:!0,costType:s.cost_type,code:s.code||"",rootType:s.root_type||""})}),o&&o.length>0&&o.forEach(s=>{const i=e[s]||{};for(const n in i)i[n].forEach(r=>{const p=r.department||"Other",u=r.department_location||"Other";a.has(p)||a.set(p,new Map);const l=a.get(p);l.has(u)||l.set(u,new Map);const m=l.get(u).get(r.expense);(!m||m.isDefault===!1)&&l.get(u).set(r.expense,{expense:r.expense,isDefault:!1,costType:r.cost_type||"",code:r.code||"",rootType:r["root type"]||""})})});const c=[];for(const[s,i]of a){const n={department:s,locations:[]};for(const[r,p]of i){const u=Array.from(p.values()).sort((l,m)=>l.isDefault&&!m.isDefault?-1:!l.isDefault&&m.isDefault?1:l.expense.localeCompare(m.expense));n.locations.push({location:r,expenses:u.map(l=>l.expense),expenseDetails:u})}n.locations.sort((r,p)=>r.location==="Default"?-1:p.location==="Default"?1:r.location.localeCompare(p.location)),c.push(n)}return c.sort((s,i)=>s.department.localeCompare(i.department)),c}function I(e,o,t){for(const a of t){const c=e[a]||{};for(const s in c){const i=c[s].find(n=>n.expense===o);if(i)return{code:i.code||"",costType:i.cost_type||"",rootType:i["root type"]||"",department:i.department||"",departmentLocation:i.department_location||""}}}return{code:"",costType:"",rootType:"",department:"",departmentLocation:""}}function Z(e,o,t,a=[]){const c=a.find(s=>s.expense===o);return c?{code:c.code||"",costType:c.cost_type||"",rootType:c.root_type||"",department:c.department||"",departmentLocation:c.department_location||"Default",isDefault:!0}:I(e,o,t)}f(!1);f({});export{W as a,G as b,z as c,X as d,U as e,b as f,k as g,y as h,K as i,B as j,Q as k,Z as l,O as m,C as n,T as q,V as r,q as s,H as t};
